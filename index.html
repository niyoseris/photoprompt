<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T4QFSLH6K0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-T4QFSLH6K0');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompy Prompt Generator</title>
    <meta name="description" content="Advanced prompt preparation tool for LLM Image Generation. Supports TOON and TONL formats.">
    <meta name="author" content="@niyoverse">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Clean Modern Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #ec4899;
            --accent: #06b6d4;
            --bg: #ffffff;
            --bg-card: #f8fafc;
            --bg-input: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --success: #10b981;
            --error: #ef4444;
        }
        
        body {
            background: var(--bg);
            min-height: 100vh;
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 14px;
        }
        
        h1, h2, h3 {
            font-weight: 600;
        }
        
        .glass-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .input-field {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            padding: 10px 14px;
            transition: all 0.2s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: #fff;
        }
        
        .btn-primary {
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 14px;
            padding: 12px 24px;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .output-box {
            background: #1e293b;
            border: none;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #e2e8f0;
            overflow: auto;
            max-height: 400px;
        }
        
        .output-box pre {
            white-space: pre;
            overflow-x: auto;
            overflow-y: auto;
            max-width: 100%;
        }
        
        .tab-btn {
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            padding: 8px 16px;
            transition: all 0.2s;
        }
        
        .tab-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
        }
        
        .tab-btn:hover:not(.active) {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .section-title {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }
        
        select option {
            background: #fff;
            color: var(--text-primary);
        }
        
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #94a3b8;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .copy-btn:hover {
            background: rgba(255,255,255,0.2);
            color: #fff;
        }
        
        .copy-btn.copied {
            background: var(--success);
            border-color: var(--success);
            color: #fff;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
        }
        
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-input);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        .preset-btn {
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .preset-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .lang-btn {
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            padding: 6px 12px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .lang-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .lang-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
        }
        
        .creator-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        .creator-link:hover {
            text-decoration: underline;
        }
        
        h1 {
            font-size: 28px !important;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        h2 {
            font-size: 16px;
            color: var(--text-primary);
        }
        
        /* Negative Prompt Tags */
        .negative-tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            min-height: 50px;
        }
        
        .negative-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #fff;
            border: 1px solid var(--error);
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 12px;
            color: var(--error);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .negative-tag:hover {
            background: #fef2f2;
        }
        
        .negative-tag.selected {
            background: var(--error);
            color: #fff;
        }
        
        .negative-tag .remove-tag {
            display: none;
            width: 16px;
            height: 16px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            font-size: 12px;
            line-height: 16px;
            text-align: center;
        }
        
        .negative-tag.custom .remove-tag {
            display: inline-block;
        }
        
        .negative-tag.custom .remove-tag:hover {
            background: rgba(255,255,255,0.5);
        }
        
        .add-tag-container {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .add-tag-input {
            flex: 1;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 13px;
        }
        
        .add-tag-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .add-tag-btn {
            background: var(--primary);
            border: none;
            border-radius: 6px;
            color: #fff;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .add-tag-btn:hover {
            background: var(--primary-light);
        }
        
        /* Symbol colors */
        .symbol-primary { color: var(--primary); }
        .symbol-secondary { color: var(--secondary); }
        .symbol-accent { color: var(--accent); }
        
        /* Custom Preset Items */
        .custom-preset-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .custom-preset-item:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }
        
        .custom-preset-item .preset-name {
            color: var(--text-primary);
        }
        
        .custom-preset-item .preset-actions {
            display: flex;
            gap: 4px;
            margin-left: 4px;
        }
        
        .custom-preset-item .preset-action-btn {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }
        
        .custom-preset-item .preset-action-btn:hover {
            background: var(--border);
        }
        
        .custom-preset-item .preset-action-btn.delete:hover {
            background: var(--error);
            color: #fff;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            transform: translateY(-20px);
            transition: transform 0.2s;
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .modal-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--bg-input);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.15s;
        }
        
        .modal-close:hover {
            background: var(--border);
            color: var(--text-primary);
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-btn-secondary {
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        
        .modal-btn-secondary:hover {
            background: var(--border);
        }
        
        .modal-btn-primary {
            background: var(--primary);
            border: none;
            color: #fff;
        }
        
        .modal-btn-primary:hover {
            background: var(--primary-light);
        }
        
        .modal-btn-danger {
            background: var(--error);
            border: none;
            color: #fff;
        }
        
        .modal-btn-danger:hover {
            background: #dc2626;
        }
        
        /* Toast animations */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Custom input field */
        .custom-input-wrapper {
            margin-top: 6px;
        }
        
        .custom-input {
            width: 100%;
            padding: 8px 12px;
            font-size: 12px;
            border: 1px dashed var(--border);
            border-radius: 6px;
            background: var(--bg);
            color: var(--text-secondary);
            transition: all 0.2s;
        }
        
        .custom-input:focus {
            outline: none;
            border-color: var(--primary);
            border-style: solid;
            background: #fff;
            color: var(--text-primary);
        }
        
        .custom-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
            font-style: italic;
        }
        
        /* Multi-select dropdown component */
        .multi-select-wrapper {
            position: relative;
        }
        
        .multi-select-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 14px;
            cursor: pointer;
            min-height: 48px;
            transition: all 0.2s;
        }
        
        .multi-select-trigger:hover {
            border-color: var(--primary);
        }
        
        .multi-select-trigger.active {
            border-color: var(--primary);
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .multi-select-trigger-text {
            flex: 1;
            font-size: 14px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .multi-select-trigger-text.has-selection {
            color: var(--text-primary);
        }
        
        .multi-select-trigger-arrow {
            font-size: 10px;
            transition: transform 0.2s;
            margin-left: 8px;
        }
        
        .multi-select-trigger.active .multi-select-trigger-arrow {
            transform: rotate(180deg);
        }
        
        .multi-select-badge {
            background: var(--primary);
            color: #fff;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 8px;
        }
        
        .multi-select-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #fff;
            border: 1px solid var(--primary);
            border-top: none;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            max-height: 400px;
            min-width: 350px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }
        
        .multi-select-dropdown.show {
            display: block;
        }
        
        .multi-select-search {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: #fff;
        }
        
        .multi-select-search input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
        }
        
        .multi-select-search input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .multi-select-options {
            padding: 8px;
        }
        
        .multi-select-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.15s;
        }
        
        .multi-select-item:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        
        .multi-select-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .multi-select-item label {
            cursor: pointer;
            flex: 1;
            color: var(--text-primary);
        }
        
        .multi-select-item.selected {
            background: rgba(99, 102, 241, 0.15);
        }
        
        .multi-select-item.hidden {
            display: none;
        }
        
        .multi-select-actions {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-top: 1px solid var(--border);
            background: var(--bg);
            position: sticky;
            bottom: 0;
        }
        
        .multi-select-actions button {
            font-size: 13px;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid var(--border);
            background: #fff;
            color: var(--text-secondary);
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .multi-select-actions button:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .multi-select-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border);
        }
        
        .multi-select-count {
            font-size: 11px;
            color: var(--text-secondary);
            background: var(--primary);
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .multi-select-clear {
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .multi-select-clear:hover {
            background: var(--border);
            color: var(--text-primary);
        }
        
        /* Multi-Person Styles */
        .person-panel {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            position: relative;
        }
        
        .person-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .person-panel-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--primary);
        }
        
        .person-count-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(99, 102, 241, 0.05);
            border-radius: 8px;
            border: 1px dashed var(--primary);
        }
        
        .person-count-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid var(--border);
            background: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }
        
        .person-count-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .person-count-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
        }
        
        .remove-person-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            background: var(--error);
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .remove-person-btn:hover {
            opacity: 1;
        }
        
        /* Preset Gallery Styles */
        .preset-gallery {
            margin-bottom: 20px;
        }
        
        .preset-category-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        .preset-category-tab {
            padding: 6px 14px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: #fff;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }
        
        .preset-category-tab:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .preset-category-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
        }
        
        .preset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            max-height: 280px;
            overflow-y: auto;
            padding: 4px;
        }
        
        .preset-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .preset-card:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .preset-card-icon {
            font-size: 24px;
            margin-bottom: 6px;
        }
        
        .preset-card-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .preset-card-desc {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .preset-card-credit {
            font-size: 9px;
            color: var(--primary);
            margin-top: 4px;
            font-style: italic;
            opacity: 0.8;
        }
        
        .preset-card.trending {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
            border-color: rgba(245, 87, 108, 0.3);
        }
        
        .preset-card.trending:hover {
            border-color: #f5576c;
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.15) 0%, rgba(245, 87, 108, 0.15) 100%);
        }
        
        .person-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            padding: 2px 6px;
            background: var(--primary);
            color: #fff;
            border-radius: 10px;
            margin-top: 6px;
        }
        
        /* Custom Fields */
        .add-custom-field-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            font-size: 11px;
            background: transparent;
            border: 1px dashed var(--border);
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }
        .add-custom-field-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }
        .remove-custom-field-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0 4px;
            font-size: 14px;
            margin-left: 4px;
        }
        .remove-custom-field-btn:hover {
            color: #ef4444;
        }
        .custom-field-item {
            background: rgba(99, 102, 241, 0.03);
            border: 1px dashed rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            padding: 12px;
        }
        .custom-fields-container {
            margin-top: 12px;
        }
    </style>
    <script src="presets.js"></script>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8 relative">
            <div class="absolute top-0 right-0 flex items-center gap-3">
                <!-- User auth area - will be populated by JS -->
            </div>
            <h1 class="mb-2" id="pageTitle">
                üì∏ <span data-i18n="page_title">Photo Prompt Generator</span>
            </h1>
            <p style="color: var(--text-secondary);" data-i18n="page_subtitle">A detailed prompt builder for LLM Image Generation</p>
            
            <!-- Mode Switch -->
            <div class="flex justify-center gap-2 mt-4">
                <button onclick="switchMode('photo')" id="modePhotoBtn" class="tab-btn active">üì∏ Photo Prompts</button>
                <button onclick="switchMode('llm')" id="modeLlmBtn" class="tab-btn">üöÄ Project Builder</button>
            </div>
        </header>

        <!-- Photo Mode Panel -->
        <div id="photoModePanel" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Input Panel -->
            <div class="glass-card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2>
                        <span data-i18n="prompt_settings">Prompt Settings</span>
                    </h2>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="loadPreset('cinematic')" class="preset-btn">
                            üé¨ <span data-i18n="cinematic_preset">Cinematic</span>
                        </button>
                        <button onclick="loadPreset('portrait')" class="preset-btn">
                            üë§ <span data-i18n="portrait_preset">Portrait</span>
                        </button>
                        <button onclick="randomizeAll()" class="preset-btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-color: #f5576c; color: #fff;">
                            üé≤ <span data-i18n="random_btn">Random</span>
                        </button>
                        <button onclick="clearForm()" class="preset-btn">
                            üóëÔ∏è <span data-i18n="clear_btn">Clear</span>
                        </button>
                    </div>
                </div>
                
                <!-- Custom Presets Section -->
                <div class="mb-6 p-4" style="background: var(--bg-input); border-radius: 8px; border: 1px solid var(--border);">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium" style="color: var(--text-secondary);">
                            üíæ <span data-i18n="my_presets">My Saved Presets</span>
                        </span>
                        <div class="flex gap-2">
                            <button onclick="exportPresets()" class="preset-btn" title="Export">
                                üì§ <span data-i18n="export_presets">Export</span>
                            </button>
                            <button onclick="document.getElementById('importFile').click()" class="preset-btn" title="Import">
                                üì• <span data-i18n="import_presets">Import</span>
                            </button>
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importPresets(event)">
                            <button onclick="openSavePresetModal()" class="preset-btn" style="background: var(--primary); color: #fff; border-color: var(--primary);">
                                ‚ûï <span data-i18n="save_preset">Save Preset</span>
                            </button>
                        </div>
                    </div>
                    <div id="customPresetsContainer" class="flex flex-wrap gap-2">
                        <!-- Custom presets will be rendered here -->
                        <span class="text-xs" style="color: var(--text-secondary);" data-i18n="no_presets">No saved presets yet</span>
                    </div>
                </div>
                
                <!-- Default Preset Gallery -->
                <div class="preset-gallery mb-6 p-4" style="background: var(--bg-input); border-radius: 8px; border: 1px solid var(--border);">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium" style="color: var(--text-secondary);">
                            üìö <span data-i18n="preset_gallery">Ready-to-Use Presets</span>
                        </span>
                        <button onclick="togglePresetGallery()" class="preset-btn" id="toggleGalleryBtn">
                            ‚ñº <span data-i18n="show_presets">Show</span>
                        </button>
                    </div>
                    <div id="presetGalleryContent" style="display: none;">
                        <div class="preset-category-tabs" id="presetCategoryTabs">
                            <button class="preset-category-tab active" onclick="filterPresetCategory('all')">üåü All</button>
                            <button class="preset-category-tab" onclick="filterPresetCategory('trending')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-color: #f5576c; color: #fff;">üî• Trending</button>
                            <button class="preset-category-tab" onclick="filterPresetCategory('portrait')">üë§ Portrait</button>
                            <button class="preset-category-tab" onclick="filterPresetCategory('landscape')">üèûÔ∏è Landscape</button>
                            <button class="preset-category-tab" onclick="filterPresetCategory('architecture')">üèõÔ∏è Architecture</button>
                            <button class="preset-category-tab" onclick="filterPresetCategory('food')">üçΩÔ∏è Food</button>
                            <button class="preset-category-tab" onclick="filterPresetCategory('wildlife')">ü¶Å Wildlife</button>
                            <button class="preset-category-tab" onclick="filterPresetCategory('product')">üì± Product</button>
                            <button class="preset-category-tab" onclick="filterPresetCategory('street')">üö∂ Street</button>
                            <button class="preset-category-tab" onclick="filterPresetCategory('fashion')">üëó Fashion</button>
                        </div>
                        <div class="preset-grid" id="presetGrid">
                            <!-- Presets will be rendered here -->
                        </div>
                    </div>
                </div>

                <form id="promptForm" class="space-y-4">
                    <!-- Hidden field to track current preset credit -->
                    <input type="hidden" id="currentPresetCredit" name="current_preset_credit" value="">
                    
                    <!-- Subject Section -->
                    <div class="mb-6">
                        <div class="section-title mb-3">
                            üñºÔ∏è <span data-i18n="subject_section">Subject</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="subject_type">Konu Tipi</label>
                                <select name="subject_type" id="subjectType" class="input-field w-full px-4 py-3" data-options="subject_type" onchange="updateContextualOptions()">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="style">Stil</label>
                                <select name="style" class="input-field w-full px-4 py-3" data-options="style">
                                </select>
                            </div>
                        </div>
                        
                        <!-- Contextual Sub-options (show/hide based on subject_type) -->
                        <div id="contextualOptions" class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4" style="display: none;">
                            <!-- Street Photography Options -->
                            <div class="form-group context-option" data-context="street">
                                <label class="form-label" data-i18n="street_type">Sokak Tipi</label>
                                <select name="street_type" class="input-field w-full px-4 py-3" data-options="street_type">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="street">
                                <label class="form-label" data-i18n="geographic_region">Coƒürafi B√∂lge</label>
                                <select name="geographic_region" class="input-field w-full px-4 py-3" data-options="geographic_region">
                                </select>
                            </div>
                            <!-- Landscape Options -->
                            <div class="form-group context-option" data-context="landscape">
                                <label class="form-label" data-i18n="landscape_type">Manzara Tipi</label>
                                <select name="landscape_type" class="input-field w-full px-4 py-3" data-options="landscape_type">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="landscape">
                                <label class="form-label" data-i18n="terrain">Arazi</label>
                                <div id="multiselect_terrain" class="multi-select-container" data-multiselect="terrain"></div>
                            </div>
                            <div class="form-group context-option" data-context="landscape">
                                <label class="form-label" data-i18n="natural_elements">Doƒüal √ñƒüeler</label>
                                <div id="multiselect_natural_elements" class="multi-select-container" data-multiselect="natural_elements"></div>
                            </div>
                            
                            <!-- Architecture Options -->
                            <div class="form-group context-option" data-context="architecture">
                                <label class="form-label" data-i18n="building_type">Bina Tipi</label>
                                <select name="building_type" class="input-field w-full px-4 py-3" data-options="building_type">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="architecture">
                                <label class="form-label" data-i18n="arch_style">Mimari Akƒ±m</label>
                                <select name="arch_style" class="input-field w-full px-4 py-3" data-options="arch_style">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="architecture">
                                <label class="form-label" data-i18n="arch_era">Mimari D√∂nem</label>
                                <select name="arch_era" class="input-field w-full px-4 py-3" data-options="arch_era">
                                </select>
                            </div>
                            
                            <!-- Food Options -->
                            <div class="form-group context-option" data-context="food">
                                <label class="form-label" data-i18n="cuisine_type">Mutfak</label>
                                <select name="cuisine_type" class="input-field w-full px-4 py-3" data-options="cuisine_type">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="food">
                                <label class="form-label" data-i18n="food_style">Yiyecek Stili</label>
                                <select name="food_style" class="input-field w-full px-4 py-3" data-options="food_style">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="food">
                                <label class="form-label" data-i18n="plating">Sunum</label>
                                <select name="plating" class="input-field w-full px-4 py-3" data-options="plating">
                                </select>
                            </div>
                            
                            <!-- Fashion Options -->
                            <div class="form-group context-option" data-context="fashion">
                                <label class="form-label" data-i18n="fashion_category">Moda Kategorisi</label>
                                <select name="fashion_category" class="input-field w-full px-4 py-3" data-options="fashion_category">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="fashion">
                                <label class="form-label" data-i18n="fashion_season">Sezon</label>
                                <select name="fashion_season" class="input-field w-full px-4 py-3" data-options="fashion_season">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="fashion">
                                <label class="form-label" data-i18n="fashion_brand_style">Marka Stili</label>
                                <select name="fashion_brand_style" class="input-field w-full px-4 py-3" data-options="fashion_brand_style">
                                </select>
                            </div>
                            <!-- Wildlife Options -->
                            <div class="form-group context-option" data-context="wildlife">
                                <label class="form-label" data-i18n="animal_type">Hayvan T√ºr√º</label>
                                <select name="animal_type" class="input-field w-full px-4 py-3" data-options="animal_type">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="wildlife">
                                <label class="form-label" data-i18n="habitat">Ya≈üam Alanƒ±</label>
                                <select name="habitat" class="input-field w-full px-4 py-3" data-options="habitat">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="wildlife">
                                <label class="form-label" data-i18n="animal_behavior">Davranƒ±≈ü</label>
                                <select name="animal_behavior" class="input-field w-full px-4 py-3" data-options="animal_behavior">
                                </select>
                            </div>
                            
                            <!-- Product Options -->
                            <div class="form-group context-option" data-context="product">
                                <label class="form-label" data-i18n="product_type">√úr√ºn Tipi</label>
                                <select name="product_type" class="input-field w-full px-4 py-3" data-options="product_type">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="product">
                                <label class="form-label" data-i18n="product_material">Malzeme</label>
                                <select name="product_material" class="input-field w-full px-4 py-3" data-options="product_material">
                                </select>
                            </div>
                            <div class="form-group context-option" data-context="product">
                                <label class="form-label" data-i18n="product_background">Arka Plan</label>
                                <select name="product_background" class="input-field w-full px-4 py-3" data-options="product_background">
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group mt-4">
                            <label class="form-label" data-i18n="subject_description">Subject Description</label>
                            <textarea name="subject_description" class="input-field w-full px-4 py-3" rows="3" 
                                data-i18n-placeholder="subject_placeholder"></textarea>
                        </div>
                        
                        <!-- Custom Fields for Subject -->
                        <div id="customFields_subject" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('subject')">
                            ‚ûï Add Custom Field
                        </button>
                    </div>

                    <!-- People/Characters Section -->
                    <div class="mb-6">
                        <div class="section-title mb-3">
                            üë• <span data-i18n="people_section">People / Characters</span>
                        </div>
                        
                        <!-- Include People Checkbox -->
                        <div class="p-4" style="background: var(--bg-input); border-radius: 8px; border: 1px solid var(--border);">
                            <label class="flex items-center gap-3 cursor-pointer mb-4">
                                <input type="checkbox" id="includePeopleCheckbox" onchange="togglePeopleSection()" 
                                    style="width: 20px; height: 20px; accent-color: var(--primary);">
                                <span class="font-medium" data-i18n="include_people">Include people in the photo</span>
                            </label>
                            
                            <!-- People Options (hidden by default) -->
                            <div id="peopleOptionsContainer" style="display: none;">
                                <!-- People Type Selection -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div class="form-group">
                                        <label class="form-label">People Type</label>
                                        <select id="peopleTypeSelect" class="input-field w-full px-4 py-3" onchange="togglePeopleType()">
                                            <option value="specific">Specific People (Detailed)</option>
                                            <option value="crowd">Crowd / Group (General)</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="crowdTypeContainer" style="display: none;">
                                        <label class="form-label">Crowd Type</label>
                                        <select name="crowd" class="input-field w-full px-4 py-3" data-options="crowd">
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Specific People Options -->
                                <div id="specificPeopleContainer">
                                    <!-- Person Count Selector -->
                                    <div class="person-count-selector mb-4">
                                        <span class="form-label" style="margin: 0; margin-right: 8px;">üë• Number of People:</span>
                                        <button type="button" class="person-count-btn active" onclick="setPersonCount(1)">1</button>
                                        <button type="button" class="person-count-btn" onclick="setPersonCount(2)">2</button>
                                        <button type="button" class="person-count-btn" onclick="setPersonCount(3)">3</button>
                                        <button type="button" class="person-count-btn" onclick="setPersonCount(4)">4+</button>
                                    </div>
                                    
                                    <!-- Multi-Person Container -->
                                    <div id="multiPersonContainer">
                                        <!-- Person panels will be dynamically generated here -->
                                    </div>
                                </div>
                                
                                <!-- Custom Fields for People Section -->
                                <div id="customFields_people" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4 mt-4"></div>
                                <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('people')">‚ûï Add Custom Field</button>
                            </div>
                        </div>
                    </div>

                    <!-- Era & Period Section -->
                    <div class="mb-6">
                        <div class="section-title mb-3">
                            ‚è∞ <span data-i18n="era_section">Era & Time</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="era">Era/Year</label>
                                <select name="era" class="input-field w-full px-4 py-3" data-options="era">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="time_of_day">Time of Day</label>
                                <select name="time_of_day" class="input-field w-full px-4 py-3" data-options="time_of_day">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="season">Season</label>
                                <select name="season" class="input-field w-full px-4 py-3" data-options="season">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_era" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('era')">‚ûï Add Custom Field</button>
                    </div>

                    <!-- Environment Section -->
                    <div class="mb-6">
                        <div class="section-title mb-3">
                            üìç <span data-i18n="environment_section">Environment & Location</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="location">Location Type</label>
                                <select name="location" class="input-field w-full px-4 py-3" data-options="location">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="setting">Setting</label>
                                <select name="setting" class="input-field w-full px-4 py-3" data-options="setting">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="crowd">Crowd Level</label>
                                <select name="crowd" class="input-field w-full px-4 py-3" data-options="crowd">
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="weather">Weather</label>
                                <select name="weather" class="input-field w-full px-4 py-3" data-options="weather">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="architecture">Architecture Style</label>
                                <select name="architecture" class="input-field w-full px-4 py-3" data-options="architecture">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_environment" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('environment')">‚ûï Add Custom Field</button>
                    </div>

                    <!-- Atmosphere Section -->
                    <div class="mb-6">
                        <div class="section-title mb-3">
                            üé® <span data-i18n="atmosphere_section">Atmosphere & Style</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="mood">Mood</label>
                                <select name="mood" class="input-field w-full px-4 py-3" data-options="mood">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="color_palette">Color Palette</label>
                                <select name="color_palette" class="input-field w-full px-4 py-3" data-options="color_palette">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="lighting">Lighting</label>
                                <select name="lighting" class="input-field w-full px-4 py-3" data-options="lighting">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_atmosphere" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('atmosphere')">‚ûï Add Custom Field</button>
                    </div>

                    <!-- Character & Clothing Section -->
                    <div class="mb-6" id="characterSection">
                        <div class="section-title mb-3">
                            üëï <span data-i18n="character_section">Character & Clothing</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="clothing_type">Clothing Type</label>
                                <select name="clothing_type" class="input-field w-full px-4 py-3" data-options="clothing_type">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="clothing_color">Clothing Color</label>
                                <select name="clothing_color" class="input-field w-full px-4 py-3" data-options="clothing_color">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="clothing_material">Fabric</label>
                                <select name="clothing_material" class="input-field w-full px-4 py-3" data-options="clothing_material">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="clothing_style">Clothing Style</label>
                                <select name="clothing_style" class="input-field w-full px-4 py-3" data-options="clothing_style">
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="age_group">Age Group</label>
                                <select name="age_group" class="input-field w-full px-4 py-3" data-options="age_group">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="expression">Expression</label>
                                <select name="expression" class="input-field w-full px-4 py-3" data-options="expression">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="pose">Pose</label>
                                <select name="pose" class="input-field w-full px-4 py-3" data-options="pose">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="clothing_era">Clothing Era</label>
                                <select name="clothing_era" class="input-field w-full px-4 py-3" data-options="clothing_era">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_character" class="custom-fields-container grid grid-cols-1 md:grid-cols-4 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('character')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Hair Section -->
                    <div class="mb-6" id="hairSection">
                        <div class="section-title mb-3">
                            üíá <span data-i18n="hair_section">Hair</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="hair_style">Hair Style</label>
                                <select name="hair_style" class="input-field w-full px-4 py-3" data-options="hair_style">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="hair_color">Hair Color</label>
                                <select name="hair_color" class="input-field w-full px-4 py-3" data-options="hair_color">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="hair_length">Hair Length</label>
                                <select name="hair_length" class="input-field w-full px-4 py-3" data-options="hair_length">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_hair" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('hair')">‚ûï Add Custom Field</button>
                        <!-- Hair Effect -->
                        <div class="grid grid-cols-1 md:grid-cols-1 gap-4 mt-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="hair_effect">Hair Effect</label>
                                <select name="hair_effect" class="input-field w-full px-4 py-3" data-options="hair_effect">
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Expression Section -->
                    <div class="mb-6" id="advancedExpressionSection">
                        <div class="section-title mb-3">
                            üëÅÔ∏è <span data-i18n="advanced_expression_section">Advanced Expression</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="eye_look">Eye Look</label>
                                <select name="eye_look" class="input-field w-full px-4 py-3" data-options="eye_look">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="eye_energy">Eye Energy</label>
                                <select name="eye_energy" class="input-field w-full px-4 py-3" data-options="eye_energy">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="eye_direction">Eye Direction</label>
                                <select name="eye_direction" class="input-field w-full px-4 py-3" data-options="eye_direction">
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="mouth_position">Mouth Position</label>
                                <select name="mouth_position" class="input-field w-full px-4 py-3" data-options="mouth_position">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="mouth_energy">Mouth Energy</label>
                                <select name="mouth_energy" class="input-field w-full px-4 py-3" data-options="mouth_energy">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_advanced_expression" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('advanced_expression')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Face & Makeup Section -->
                    <div class="mb-6" id="faceSection">
                        <div class="section-title mb-3">
                            üíÑ <span data-i18n="face_section">Face & Makeup</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="skin_type">Skin Type</label>
                                <select name="skin_type" class="input-field w-full px-4 py-3" data-options="skin_type">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="makeup_style">Makeup Style</label>
                                <select name="makeup_style" class="input-field w-full px-4 py-3" data-options="makeup_style">
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-1 gap-4 mt-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="face_features">Face Features</label>
                                <select name="face_features" class="input-field w-full px-4 py-3" data-options="face_features">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_face" class="custom-fields-container grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('face')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Advanced Body Section -->
                    <div class="mb-6" id="advancedBodySection">
                        <div class="section-title mb-3">
                            üßç <span data-i18n="advanced_body_section">Advanced Body & Skin</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="body_frame">Body Frame</label>
                                <select name="body_frame" class="input-field w-full px-4 py-3" data-options="body_frame">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="body_definition">Body Definition</label>
                                <select name="body_definition" class="input-field w-full px-4 py-3" data-options="body_definition">
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="skin_visible_areas">Visible Areas</label>
                                <select name="skin_visible_areas" class="input-field w-full px-4 py-3" data-options="skin_visible_areas">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="skin_tone">Skin Tone</label>
                                <select name="skin_tone" class="input-field w-full px-4 py-3" data-options="skin_tone">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="skin_texture">Skin Texture</label>
                                <select name="skin_texture" class="input-field w-full px-4 py-3" data-options="skin_texture">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="skin_lighting_effect">Skin Lighting</label>
                                <select name="skin_lighting_effect" class="input-field w-full px-4 py-3" data-options="skin_lighting_effect">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_advanced_body" class="custom-fields-container grid grid-cols-1 md:grid-cols-4 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('advanced_body')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Advanced Pose Section -->
                    <div class="mb-6" id="advancedPoseSection">
                        <div class="section-title mb-3">
                            ü§∏ <span data-i18n="advanced_pose_section">Advanced Pose</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="pose_position">Pose Position</label>
                                <select name="pose_position" class="input-field w-full px-4 py-3" data-options="pose_position">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="pose_base">Pose Base</label>
                                <select name="pose_base" class="input-field w-full px-4 py-3" data-options="pose_base">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="pose_energy">Pose Energy</label>
                                <select name="pose_energy" class="input-field w-full px-4 py-3" data-options="pose_energy">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_advanced_pose" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('advanced_pose')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Advanced Clothing Section -->
                    <div class="mb-6" id="advancedClothingSection">
                        <div class="section-title mb-3">
                            üëó <span data-i18n="advanced_clothing_section">Advanced Clothing</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="clothing_effect">Clothing Effect</label>
                                <select name="clothing_effect" class="input-field w-full px-4 py-3" data-options="clothing_effect">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="clothing_details">Clothing Details</label>
                                <select name="clothing_details" class="input-field w-full px-4 py-3" data-options="clothing_details">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_advanced_clothing" class="custom-fields-container grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('advanced_clothing')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Accessories Section -->
                    <div class="mb-6" id="accessoriesSection">
                        <div class="section-title mb-3">
                            üíç <span data-i18n="accessories_section">Accessories</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="eyewear">Eyewear</label>
                                <select name="eyewear" class="input-field w-full px-4 py-3" data-options="eyewear">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="earrings">Earrings</label>
                                <select name="earrings" class="input-field w-full px-4 py-3" data-options="earrings">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="necklace">Necklace</label>
                                <select name="necklace" class="input-field w-full px-4 py-3" data-options="necklace">
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="bracelet">Bracelet/Watch</label>
                                <select name="bracelet" class="input-field w-full px-4 py-3" data-options="bracelet">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="rings">Rings</label>
                                <select name="rings" class="input-field w-full px-4 py-3" data-options="rings">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="headwear">Headwear</label>
                                <select name="headwear" class="input-field w-full px-4 py-3" data-options="headwear">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_accessories" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('accessories')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Device & Props Section -->
                    <div class="mb-6" id="devicePropsSection">
                        <div class="section-title mb-3">
                            üì± <span data-i18n="device_props_section">Device & Props</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="device_type">Device Type</label>
                                <select name="device_type" class="input-field w-full px-4 py-3" data-options="device_type">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="device_details">Device Details</label>
                                <select name="device_details" class="input-field w-full px-4 py-3" data-options="device_details">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="prop_type">Prop Type</label>
                                <select name="prop_type" class="input-field w-full px-4 py-3" data-options="prop_type">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_device_props" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('device_props')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Optical Illusion Section -->
                    <div class="mb-6" id="opticalIllusionSection">
                        <div class="section-title mb-3">
                            ‚ú® <span data-i18n="optical_illusion_section">Optical Illusion Effects</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="illusion_type">Illusion Type</label>
                                <select name="illusion_type" class="input-field w-full px-4 py-3" data-options="illusion_type">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="illusion_device">Illusion Device</label>
                                <select name="illusion_device" class="input-field w-full px-4 py-3" data-options="illusion_device">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_optical_illusion" class="custom-fields-container grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('optical_illusion')">‚ûï Add Custom Field</button>
                    </div>

                    <!-- Objects Section -->
                    <div class="mb-6">
                        <div class="section-title mb-3">
                            üéØ <span>Objects & Props</span>
                        </div>
                        <div class="p-4" style="background: var(--bg-input); border-radius: 8px; border: 1px solid var(--border);">
                            <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
                                Add objects/props in the scene with their attributes and positions.
                            </p>
                            <div id="objectsContainer">
                                <!-- Objects will be rendered here -->
                            </div>
                            <button type="button" class="add-custom-field-btn" onclick="addObject()" style="margin-top: 8px;">
                                ‚ûï Add Object
                            </button>
                        </div>
                    </div>

                    <!-- Relationships Section -->
                    <div class="mb-6">
                        <div class="section-title mb-3">
                            üîó <span>Semantic Relationships</span>
                        </div>
                        <div class="p-4" style="background: var(--bg-input); border-radius: 8px; border: 1px solid var(--border);">
                            <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
                                Define how objects interact with each other (e.g., "Person is holding the coffee cup").
                            </p>
                            <div id="relationshipsContainer">
                                <!-- Relationships will be rendered here -->
                            </div>
                            <div class="flex gap-2 mt-2">
                                <input type="text" id="newRelationshipInput" class="input-field flex-1 px-3 py-2" 
                                    placeholder="e.g., Subject is sitting on the bench" style="font-size: 12px;">
                                <button type="button" class="btn-primary px-4 py-2" onclick="addRelationship()" style="font-size: 12px;">
                                    Add
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Section -->
                    <div class="mb-6">
                        <div class="section-title mb-3">
                            üì∑ <span data-i18n="technical_section">Technical Settings</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="camera_type">Camera/Lens</label>
                                <select name="camera_type" class="input-field w-full px-4 py-3" data-options="camera_type">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="camera_angle">Camera Angle</label>
                                <select name="camera_angle" class="input-field w-full px-4 py-3" data-options="camera_angle">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="camera_settings">Camera Settings</label>
                                <select name="camera_settings" class="input-field w-full px-4 py-3" data-options="camera_settings">
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="composition">Composition</label>
                                <select name="composition" class="input-field w-full px-4 py-3" data-options="composition">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="film_type">Film Type</label>
                                <select name="film_type" class="input-field w-full px-4 py-3" data-options="film_type">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="aspect_ratio">Aspect Ratio</label>
                                <select name="aspect_ratio" class="input-field w-full px-4 py-3" data-options="aspect_ratio">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_technical" class="custom-fields-container grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('technical')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Advanced Photography Section -->
                    <div class="mb-6" id="advancedPhotographySection">
                        <div class="section-title mb-3">
                            üé¨ <span data-i18n="advanced_photography_section">Advanced Photography</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="camera_style">Camera Style</label>
                                <select name="camera_style" class="input-field w-full px-4 py-3" data-options="camera_style">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="shot_type">Shot Type</label>
                                <select name="shot_type" class="input-field w-full px-4 py-3" data-options="shot_type">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="photo_texture">Photo Texture</label>
                                <select name="photo_texture" class="input-field w-full px-4 py-3" data-options="photo_texture">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="depth_of_field">Depth of Field</label>
                                <select name="depth_of_field" class="input-field w-full px-4 py-3" data-options="depth_of_field">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_advanced_photography" class="custom-fields-container grid grid-cols-1 md:grid-cols-4 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('advanced_photography')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Background Advanced Section -->
                    <div class="mb-6" id="backgroundAdvancedSection">
                        <div class="section-title mb-3">
                            üèûÔ∏è <span data-i18n="background_advanced_section">Background Advanced</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="background_elements">Background Elements</label>
                                <select name="background_elements" class="input-field w-full px-4 py-3" data-options="background_elements">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="background_atmosphere">Background Atmosphere</label>
                                <select name="background_atmosphere" class="input-field w-full px-4 py-3" data-options="background_atmosphere">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_background_advanced" class="custom-fields-container grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('background_advanced')">‚ûï Add Custom Field</button>
                    </div>
                    
                    <!-- Vibe & Aesthetic Section -->
                    <div class="mb-6" id="vibeAestheticSection">
                        <div class="section-title mb-3">
                            üåü <span data-i18n="vibe_aesthetic_section">Vibe & Aesthetic</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="vibe_energy">Vibe Energy</label>
                                <select name="vibe_energy" class="input-field w-full px-4 py-3" data-options="vibe_energy">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="vibe_aesthetic">Vibe Aesthetic</label>
                                <select name="vibe_aesthetic" class="input-field w-full px-4 py-3" data-options="vibe_aesthetic">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="vibe_authenticity">Vibe Authenticity</label>
                                <select name="vibe_authenticity" class="input-field w-full px-4 py-3" data-options="vibe_authenticity">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="vibe_intimacy">Vibe Intimacy</label>
                                <select name="vibe_intimacy" class="input-field w-full px-4 py-3" data-options="vibe_intimacy">
                                </select>
                            </div>
                        </div>
                        <div id="customFields_vibe_aesthetic" class="custom-fields-container grid grid-cols-1 md:grid-cols-4 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('vibe_aesthetic')">‚ûï Add Custom Field</button>
                    </div>

                    <!-- Quality Section -->
                    <div class="mb-6">
                        <div class="section-title mb-3">
                            ‚≠ê <span data-i18n="quality_section">Quality & Details</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" data-i18n="quality_modifiers">Quality Modifiers</label>
                                <select name="quality_modifiers" class="input-field w-full px-4 py-3" data-options="quality_modifiers">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="render_style">Render Style</label>
                                <select name="render_style" class="input-field w-full px-4 py-3" data-options="render_style">
                                </select>
                            </div>
                        </div>
                        <div class="form-group mt-4">
                            <label class="form-label" data-i18n="additional_details">Additional Details</label>
                            <textarea name="additional_details" class="input-field w-full px-4 py-3" rows="2" 
                                data-i18n-placeholder="additional_placeholder"></textarea>
                        </div>
                        <div class="form-group mt-4">
                            <label class="form-label" data-i18n="negative_prompt">Negative Prompt</label>
                            <div id="negativeTagsContainer" class="negative-tags-container">
                                <!-- Tags will be rendered here -->
                            </div>
                            <div class="add-tag-container">
                                <input type="text" id="newTagInput" class="add-tag-input" data-i18n-placeholder="add_negative_placeholder">
                                <button type="button" onclick="addCustomTag()" class="add-tag-btn">
                                    + <span data-i18n="add_btn">Add</span>
                                </button>
                            </div>
                        </div>
                        <div id="customFields_quality" class="custom-fields-container grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                        <button type="button" class="add-custom-field-btn" onclick="openCustomFieldModal('quality')">‚ûï Add Custom Field</button>
                    </div>

                    <button type="submit" class="btn-primary w-full py-4 text-white text-lg">
                        ‚ñ∂Ô∏è <span data-i18n="generate_btn">Generate Prompt</span>
                    </button>
                </form>
            </div>

            <!-- Output Panel -->
            <div class="glass-card p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    üíª 
                    <span data-i18n="generated_prompts">Generated Prompts</span>
                </h2>

                <!-- Tab Navigation -->
                <div class="flex flex-wrap gap-2 mb-4">
                    <button class="tab-btn px-4 py-2 active" data-tab="natural">
                        üìù <span data-i18n="natural_tab">Natural</span>
                    </button>
                    <button class="tab-btn px-4 py-2" data-tab="toon">
                        üé® TOON
                    </button>
                    <button class="tab-btn px-4 py-2" data-tab="tonl">
                        üìä TONL
                    </button>
                    <button class="tab-btn px-4 py-2" data-tab="json">
                        { } JSON
                    </button>
                </div>

                <!-- Output Boxes -->
                <div class="relative">
                    <div id="output-natural" class="output-content">
                        <div class="output-box p-4 min-h-96 relative">
                            <button class="copy-btn" onclick="copyToClipboard('natural')">
                                üìã <span class="copy-text" data-i18n="copy_btn">Copy</span>
                            </button>
                            <pre id="text-natural" class="whitespace-pre-wrap text-gray-300 mt-8" data-i18n="waiting_message">Fill out the form to generate a prompt...</pre>
                        </div>
                    </div>
                    <div id="output-toon" class="output-content hidden">
                        <div class="output-box p-4 min-h-96 relative">
                            <button class="copy-btn" onclick="copyToClipboard('toon')">
                                üìã <span class="copy-text" data-i18n="copy_btn">Copy</span>
                            </button>
                            <pre id="text-toon" class="whitespace-pre-wrap text-gray-300 mt-8" data-i18n="waiting_message">Fill out the form to generate a prompt...</pre>
                        </div>
                    </div>
                    <div id="output-tonl" class="output-content hidden">
                        <div class="output-box p-4 min-h-96 relative">
                            <button class="copy-btn" onclick="copyToClipboard('tonl')">
                                üìã <span class="copy-text" data-i18n="copy_btn">Copy</span>
                            </button>
                            <pre id="text-tonl" class="whitespace-pre-wrap text-gray-300 mt-8" data-i18n="waiting_message">Fill out the form to generate a prompt...</pre>
                        </div>
                    </div>
                    <div id="output-json" class="output-content hidden">
                        <div class="output-box p-4 min-h-96 relative">
                            <button class="copy-btn" onclick="copyToClipboard('json')">
                                üìã <span class="copy-text" data-i18n="copy_btn">Copy</span>
                            </button>
                            <pre id="text-json" class="whitespace-pre-wrap text-gray-300 mt-8" data-i18n="waiting_message">Fill out the form to generate a prompt...</pre>
                        </div>
                    </div>
                </div>

                <!-- Quick Tips -->
                <div class="mt-6 p-4 bg-indigo-900/30 rounded-xl border border-indigo-800/50">
                    <h3 class="text-sm font-semibold text-indigo-400 mb-2">
                        ‚≠ê <span data-i18n="tips_title">Tips</span>
                    </h3>
                    <ul class="text-xs text-gray-400 space-y-1">
                        <li>‚Ä¢ <strong>TOON:</strong> <span data-i18n="tip_toon">Token-Oriented Object Notation - Compact format optimized for LLMs</span></li>
                        <li>‚Ä¢ <strong>TONL:</strong> <span data-i18n="tip_tonl">Token-Optimized Notation Language - Structured data format</span></li>
                        <li>‚Ä¢ <strong>JSON:</strong> <span data-i18n="tip_json">Standard format for API integrations</span></li>
                        <li>‚Ä¢ <strong><span data-i18n="natural_tab">Natural</span>:</strong> <span data-i18n="tip_natural">Ready-to-use comma-separated format</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Project Builder Mode Panel -->
        <div id="llmModePanel" class="grid grid-cols-1 lg:grid-cols-2 gap-6" style="display: none;">
            <!-- Project Builder Input Panel -->
            <div class="glass-card p-6" style="max-height: 85vh; overflow-y: auto;">
                <div class="flex items-center justify-between mb-4">
                    <h2>üöÄ Project Builder for AI Agents</h2>
                    <button onclick="clearLlmForm()" class="preset-btn">üóëÔ∏è Clear</button>
                </div>
                
                <form id="llmPromptForm" class="space-y-4">
                    <!-- Project Overview -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üìã Project Overview</div>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="form-group">
                                <label class="form-label">Project Name <span class="text-xs text-gray-500">‚Äî The official name of your application</span></label>
                                <input type="text" name="project_name" class="input-field w-full" placeholder="e.g., TaskFlow Pro, HealthTracker AI">
                            </div>
                            <div class="form-group">
                                <label class="form-label">One-Line Description <span class="text-xs text-gray-500">‚Äî Elevator pitch in 1-2 sentences</span></label>
                                <input type="text" name="project_tagline" class="input-field w-full" placeholder="e.g., AI-powered task management for remote teams">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Problem Statement <span class="text-xs text-gray-500">‚Äî What problem does this solve?</span></label>
                                <textarea name="problem_statement" class="input-field w-full" rows="2" placeholder="Describe the pain point or gap in the market..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Proposed Solution <span class="text-xs text-gray-500">‚Äî How does your app solve it?</span></label>
                                <textarea name="proposed_solution" class="input-field w-full" rows="2" placeholder="Explain your unique approach to solving this problem..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Target Audience & Market -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üë• Target Audience & Market</div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Target Users <span class="text-xs text-gray-500">‚Äî Who will use this?</span></label>
                                <input type="text" name="target_users" class="input-field w-full" placeholder="e.g., Small business owners, Freelancers">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Market Size <span class="text-xs text-gray-500">‚Äî TAM/SAM/SOM if known</span></label>
                                <input type="text" name="market_size" class="input-field w-full" placeholder="e.g., $5B global market, 10M potential users">
                            </div>
                            <div class="form-group md:col-span-2">
                                <label class="form-label">Competitors <span class="text-xs text-gray-500">‚Äî Existing solutions in the market</span></label>
                                <input type="text" name="competitors" class="input-field w-full" placeholder="e.g., Notion, Asana, Monday.com">
                            </div>
                            <div class="form-group md:col-span-2">
                                <label class="form-label">Unique Value Proposition <span class="text-xs text-gray-500">‚Äî Why choose you over competitors?</span></label>
                                <textarea name="unique_value" class="input-field w-full" rows="2" placeholder="What makes your solution different and better?"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Stack -->
                    <div class="mb-6">
                        <div class="section-title mb-3">‚öôÔ∏è Technical Stack</div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Platform Type <span class="text-xs text-gray-500">‚Äî Primary deployment target</span></label>
                                <select name="platform_type" class="input-field w-full">
                                    <option value="">Select...</option>
                                    <option value="web_app">Web Application (SPA/SSR)</option>
                                    <option value="mobile_native">Native Mobile (iOS/Android)</option>
                                    <option value="mobile_hybrid">Hybrid Mobile (React Native/Flutter)</option>
                                    <option value="desktop">Desktop Application (Electron/Tauri)</option>
                                    <option value="api_backend">API/Backend Service</option>
                                    <option value="browser_extension">Browser Extension</option>
                                    <option value="cli_tool">CLI Tool</option>
                                    <option value="full_stack">Full-Stack (Web + API)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Frontend Framework <span class="text-xs text-gray-500">‚Äî UI technology</span></label>
                                <select name="frontend_framework" class="input-field w-full">
                                    <option value="">Select...</option>
                                    <option value="react">React</option>
                                    <option value="nextjs">Next.js</option>
                                    <option value="vue">Vue.js</option>
                                    <option value="nuxt">Nuxt.js</option>
                                    <option value="angular">Angular</option>
                                    <option value="svelte">Svelte/SvelteKit</option>
                                    <option value="react_native">React Native</option>
                                    <option value="flutter">Flutter</option>
                                    <option value="vanilla">Vanilla JS/HTML</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Backend Framework <span class="text-xs text-gray-500">‚Äî Server technology</span></label>
                                <select name="backend_framework" class="input-field w-full">
                                    <option value="">Select...</option>
                                    <option value="nodejs">Node.js (Express/Fastify)</option>
                                    <option value="python">Python (Flask/FastAPI/Django)</option>
                                    <option value="go">Go (Gin/Echo)</option>
                                    <option value="rust">Rust (Actix/Axum)</option>
                                    <option value="java">Java (Spring Boot)</option>
                                    <option value="csharp">C# (.NET)</option>
                                    <option value="ruby">Ruby (Rails)</option>
                                    <option value="php">PHP (Laravel)</option>
                                    <option value="serverless">Serverless Functions</option>
                                    <option value="supabase">Supabase (BaaS)</option>
                                    <option value="firebase">Firebase (BaaS)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Database <span class="text-xs text-gray-500">‚Äî Data storage</span></label>
                                <select name="database" class="input-field w-full">
                                    <option value="">Select...</option>
                                    <option value="postgresql">PostgreSQL</option>
                                    <option value="mysql">MySQL</option>
                                    <option value="mongodb">MongoDB</option>
                                    <option value="sqlite">SQLite</option>
                                    <option value="redis">Redis</option>
                                    <option value="dynamodb">DynamoDB</option>
                                    <option value="firestore">Firestore</option>
                                    <option value="supabase_db">Supabase (Postgres)</option>
                                    <option value="planetscale">PlanetScale</option>
                                    <option value="prisma">Prisma ORM</option>
                                </select>
                            </div>
                            <div class="form-group md:col-span-2">
                                <label class="form-label">Additional Technologies <span class="text-xs text-gray-500">‚Äî APIs, AI/ML, Auth, Payments, etc.</span></label>
                                <input type="text" name="additional_tech" class="input-field w-full" placeholder="e.g., OpenAI API, Stripe, Auth0, AWS S3, Twilio">
                            </div>
                            <div class="form-group md:col-span-2">
                                <label class="form-label">Deployment & Infrastructure <span class="text-xs text-gray-500">‚Äî Hosting and CI/CD</span></label>
                                <input type="text" name="deployment" class="input-field w-full" placeholder="e.g., Vercel, AWS, Docker, GitHub Actions">
                            </div>
                        </div>
                    </div>

                    <!-- Core Features (PRD) -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üéØ Core Features (PRD)</div>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="form-group">
                                <label class="form-label">MVP Features <span class="text-xs text-gray-500">‚Äî Must-have features for launch</span></label>
                                <textarea name="mvp_features" class="input-field w-full" rows="4" placeholder="- User authentication (email, OAuth)&#10;- Dashboard with key metrics&#10;- CRUD operations for main entities&#10;- Basic search and filtering"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Future Features <span class="text-xs text-gray-500">‚Äî Nice-to-have for v2+</span></label>
                                <textarea name="future_features" class="input-field w-full" rows="3" placeholder="- Team collaboration&#10;- Advanced analytics&#10;- Mobile app&#10;- API for integrations"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- User Flow -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üîÑ User Flow</div>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="form-group">
                                <label class="form-label">Onboarding Flow <span class="text-xs text-gray-500">‚Äî How users get started</span></label>
                                <textarea name="onboarding_flow" class="input-field w-full" rows="3" placeholder="1. Landing page ‚Üí Sign up&#10;2. Email verification&#10;3. Profile setup wizard&#10;4. First project creation"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Core User Journey <span class="text-xs text-gray-500">‚Äî Main workflow for key tasks</span></label>
                                <textarea name="user_journey" class="input-field w-full" rows="3" placeholder="1. Login ‚Üí Dashboard&#10;2. Create new task/project&#10;3. Configure settings&#10;4. Monitor progress&#10;5. Export/Share results"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Business Model -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üí∞ Business Model & Monetization</div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Revenue Model <span class="text-xs text-gray-500">‚Äî How you'll make money</span></label>
                                <select name="revenue_model" class="input-field w-full">
                                    <option value="">Select...</option>
                                    <option value="freemium">Freemium (Free + Paid tiers)</option>
                                    <option value="subscription">Subscription (Monthly/Yearly)</option>
                                    <option value="one_time">One-time Purchase</option>
                                    <option value="usage_based">Usage-based/Pay-as-you-go</option>
                                    <option value="marketplace">Marketplace/Commission</option>
                                    <option value="advertising">Ad-supported</option>
                                    <option value="enterprise">Enterprise/B2B Sales</option>
                                    <option value="open_source">Open Source + Services</option>
                                    <option value="hybrid">Hybrid Model</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pricing Tiers <span class="text-xs text-gray-500">‚Äî Example pricing structure</span></label>
                                <input type="text" name="pricing_tiers" class="input-field w-full" placeholder="e.g., Free, Pro ($9/mo), Team ($29/mo)">
                            </div>
                            <div class="form-group md:col-span-2">
                                <label class="form-label">Key Metrics to Track <span class="text-xs text-gray-500">‚Äî KPIs for success</span></label>
                                <input type="text" name="key_metrics" class="input-field w-full" placeholder="e.g., MAU, MRR, Churn Rate, LTV, CAC">
                            </div>
                        </div>
                    </div>

                    <!-- Design & UX -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üé® Design & UX Requirements</div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">UI Style <span class="text-xs text-gray-500">‚Äî Visual approach</span></label>
                                <select name="ui_style" class="input-field w-full">
                                    <option value="">Select...</option>
                                    <option value="minimal">Minimal & Clean</option>
                                    <option value="modern">Modern & Bold</option>
                                    <option value="corporate">Corporate & Professional</option>
                                    <option value="playful">Playful & Colorful</option>
                                    <option value="dark">Dark Mode First</option>
                                    <option value="glassmorphism">Glassmorphism</option>
                                    <option value="material">Material Design</option>
                                    <option value="ios">iOS/Apple Style</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">UI Component Library <span class="text-xs text-gray-500">‚Äî Pre-built components</span></label>
                                <select name="ui_library" class="input-field w-full">
                                    <option value="">Select...</option>
                                    <option value="tailwind">Tailwind CSS</option>
                                    <option value="shadcn">shadcn/ui</option>
                                    <option value="chakra">Chakra UI</option>
                                    <option value="mui">Material UI (MUI)</option>
                                    <option value="antd">Ant Design</option>
                                    <option value="radix">Radix UI</option>
                                    <option value="bootstrap">Bootstrap</option>
                                    <option value="custom">Custom CSS</option>
                                </select>
                            </div>
                            <div class="form-group md:col-span-2">
                                <label class="form-label">Accessibility Requirements <span class="text-xs text-gray-500">‚Äî a11y considerations</span></label>
                                <input type="text" name="accessibility" class="input-field w-full" placeholder="e.g., WCAG 2.1 AA, Screen reader support, Keyboard navigation">
                            </div>
                        </div>
                    </div>

                    <!-- Testing & QA -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üß™ Testing & QA</div>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="form-group">
                                <label class="form-label">Test Strategy <span class="text-xs text-gray-500">‚Äî How will the app be tested?</span></label>
                                <textarea name="test_strategy" class="input-field w-full" rows="2" placeholder="e.g., Unit tests for business logic, E2E tests for critical flows, Manual QA for edge cases"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Test Coverage Requirements <span class="text-xs text-gray-500">‚Äî Minimum coverage targets</span></label>
                                <input type="text" name="test_coverage" class="input-field w-full" placeholder="e.g., 80% unit test coverage, 100% for payment flows">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Testing Tools <span class="text-xs text-gray-500">‚Äî Frameworks and tools</span></label>
                                <input type="text" name="testing_tools" class="input-field w-full" placeholder="e.g., Jest, Cypress, Playwright, React Testing Library">
                            </div>
                        </div>
                    </div>

                    <!-- Security -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üîí Security Requirements</div>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="form-group">
                                <label class="form-label">Authentication Method <span class="text-xs text-gray-500">‚Äî How users will sign in</span></label>
                                <input type="text" name="auth_method" class="input-field w-full" placeholder="e.g., Email/Password, OAuth (Google, GitHub), Magic Links, SSO">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Security Measures <span class="text-xs text-gray-500">‚Äî Required security features</span></label>
                                <textarea name="security_measures" class="input-field w-full" rows="2" placeholder="e.g., HTTPS only, Rate limiting, Input validation, SQL injection prevention, XSS protection"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Compliance Requirements <span class="text-xs text-gray-500">‚Äî Regulatory compliance</span></label>
                                <input type="text" name="compliance" class="input-field w-full" placeholder="e.g., GDPR, HIPAA, SOC 2, PCI-DSS">
                            </div>
                        </div>
                    </div>

                    <!-- Additional Context -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üìù Additional Context</div>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="form-group">
                                <label class="form-label">Technical Constraints <span class="text-xs text-gray-500">‚Äî Limitations or requirements</span></label>
                                <textarea name="constraints" class="input-field w-full" rows="2" placeholder="e.g., Must work offline, Max 100ms response time, GDPR compliant"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Reference Projects <span class="text-xs text-gray-500">‚Äî Similar apps for inspiration</span></label>
                                <input type="text" name="references" class="input-field w-full" placeholder="e.g., Notion for UI, Stripe for UX, Linear for speed">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Additional Notes <span class="text-xs text-gray-500">‚Äî Any other important details</span></label>
                                <textarea name="additional_notes" class="input-field w-full" rows="2" placeholder="Anything else the AI developer should know..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Fields -->
                    <div class="mb-6">
                        <div class="section-title mb-3 flex justify-between items-center">
                            <span>‚úèÔ∏è Custom Fields</span>
                            <button type="button" onclick="addCustomField()" class="text-xs btn-secondary">+ Add Field</button>
                        </div>
                        <div id="customFieldsContainer" class="space-y-3">
                            <!-- Custom fields will be added here -->
                        </div>
                    </div>

                    <!-- Output Format -->
                    <div class="mb-6">
                        <div class="section-title mb-3">üìÑ Output Format</div>
                        <div class="flex flex-wrap gap-2">
                            <button type="button" onclick="setProjectOutputFormat('natural')" class="tab-btn active" data-format="natural">Natural</button>
                            <button type="button" onclick="setProjectOutputFormat('markdown')" class="tab-btn" data-format="markdown">Markdown</button>
                            <button type="button" onclick="setProjectOutputFormat('toon')" class="tab-btn" data-format="toon">TOON</button>
                            <button type="button" onclick="setProjectOutputFormat('tonl')" class="tab-btn" data-format="tonl">TONL</button>
                            <button type="button" onclick="setProjectOutputFormat('json')" class="tab-btn" data-format="json">JSON</button>
                        </div>
                        <input type="hidden" name="output_format" id="projectOutputFormat" value="natural">
                    </div>

                    <button type="submit" class="btn-primary w-full flex items-center justify-center gap-2">
                        ‚ö° Generate Project Brief
                    </button>
                </form>

                <!-- Preset Actions -->
                <div class="mt-4 pt-4 border-t flex flex-wrap gap-2" style="border-color: var(--border);">
                    <button onclick="saveProjectPreset()" class="btn-secondary text-sm">üíæ Save Preset</button>
                    <button onclick="loadProjectPreset()" class="btn-secondary text-sm">üìÇ Load Preset</button>
                    <button onclick="exportProjectPreset()" class="btn-secondary text-sm">üì§ Export</button>
                    <button onclick="importProjectPreset()" class="btn-secondary text-sm">üì• Import</button>
                </div>
            </div>

            <!-- Project Output Panel -->
            <div class="glass-card p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center">üíª Generated Project Brief</h2>
                
                <div class="output-box p-4 relative" style="max-height: 70vh; overflow-y: auto;">
                    <button onclick="copyLlmOutput()" class="copy-btn" id="copyLlmBtn">üìã Copy</button>
                    <pre id="llmOutputText" class="whitespace-pre-wrap text-gray-300">Fill out the form to generate a comprehensive project brief for your AI coding agent...</pre>
                </div>

                <!-- Quick Tips -->
                <div class="mt-6 p-4 bg-indigo-900/30 rounded-xl border border-indigo-800/50">
                    <h3 class="text-sm font-semibold text-indigo-400 mb-2">üí° Tips for Best Results</h3>
                    <ul class="text-xs text-gray-400 space-y-1">
                        <li>‚Ä¢ <strong>Be Specific:</strong> The more detail you provide, the better the AI can help</li>
                        <li>‚Ä¢ <strong>MVP First:</strong> Focus on core features before nice-to-haves</li>
                        <li>‚Ä¢ <strong>User Flow:</strong> Think through how users will actually use the app</li>
                        <li>‚Ä¢ <strong>Tech Stack:</strong> Choose technologies you're comfortable with</li>
                        <li>‚Ä¢ <strong>Constraints:</strong> Mention any hard requirements upfront</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>
                <span data-i18n="footer_text">Photo Prompt Generator</span> | 
                <span data-i18n="created_by">Created by</span>: 
                <a href="https://twitter.com/niyoverse" target="_blank" rel="noopener noreferrer" class="creator-link">
                    <i class="fab fa-twitter mr-1"></i>@niyoverse
                </a>
            </p>
            <p class="mt-1 text-xs text-gray-600">
                <span data-i18n="formats_credit">Formats</span>: 
                <a href="https://github.com/toon-format/toon" target="_blank" rel="noopener noreferrer" class="creator-link">TOON</a> | 
                <a href="https://github.com/tonl-dev/tonl" target="_blank" rel="noopener noreferrer" class="creator-link">TONL</a>
            </p>
        </footer>
    </div>

    <!-- Save Preset Modal -->
    <div id="savePresetModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üíæ <span data-i18n="save_preset_title">Save Preset</span></h3>
                <button class="modal-close" onclick="closeModal('savePresetModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" data-i18n="preset_name">Preset Name</label>
                    <input type="text" id="presetNameInput" class="input-field w-full" placeholder="E.g.: Sunset Landscape" maxlength="30">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('savePresetModal')" data-i18n="cancel">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="saveCustomPreset()" data-i18n="save">Save</button>
            </div>
        </div>
    </div>

    <!-- Edit Preset Modal -->
    <div id="editPresetModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è <span data-i18n="edit_preset_title">Edit Preset</span></h3>
                <button class="modal-close" onclick="closeModal('editPresetModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" data-i18n="preset_name">Preset Name</label>
                    <input type="text" id="editPresetNameInput" class="input-field w-full" maxlength="30">
                    <input type="hidden" id="editPresetId">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('editPresetModal')" data-i18n="cancel">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="updateCustomPreset()" data-i18n="update">Update</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirm Modal -->
    <div id="deletePresetModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üóëÔ∏è <span data-i18n="delete_preset_title">Delete Preset</span></h3>
                <button class="modal-close" onclick="closeModal('deletePresetModal')">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary);" data-i18n="delete_confirm">Are you sure you want to delete this preset?</p>
                <input type="hidden" id="deletePresetId">
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('deletePresetModal')" data-i18n="cancel">Cancel</button>
                <button class="modal-btn modal-btn-danger" onclick="confirmDeletePreset()" data-i18n="delete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Custom Field Modal -->
    <div id="customFieldModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Add Custom Field</h3>
                <button class="modal-close" onclick="closeCustomFieldModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group mb-4">
                    <label class="form-label">Field Name (internal)</label>
                    <input type="text" id="customFieldName" class="input-field w-full px-4 py-3" 
                        placeholder="e.g., my_custom_field">
                </div>
                <div class="form-group mb-4">
                    <label class="form-label">Display Label</label>
                    <input type="text" id="customFieldLabel" class="input-field w-full px-4 py-3" 
                        placeholder="e.g., My Custom Field">
                </div>
                <div class="form-group mb-4">
                    <label class="form-label">Field Type</label>
                    <select id="customFieldType" class="input-field w-full px-4 py-3" onchange="toggleCustomFieldOptions()">
                        <option value="text">Text Input</option>
                        <option value="select">Dropdown Select</option>
                    </select>
                </div>
                <div class="form-group mb-4" id="customFieldOptionsContainer" style="display: none;">
                    <label class="form-label">Options (comma-separated)</label>
                    <textarea id="customFieldOptions" class="input-field w-full px-4 py-3" rows="3" 
                        placeholder="option1, option2, option3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeCustomFieldModal()">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="saveNewCustomField()">Add Field</button>
            </div>
        </div>
    </div>

    <!-- Info Footer -->
    <footer style="background: var(--bg-secondary); border-top: 1px solid var(--border); padding: 20px; margin-top: 40px;">
        <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: flex-end; align-items: center;">
            <div style="font-size: 13px; color: var(--text-secondary);">
                <span style="font-weight: 600; color: var(--text-primary);">Status:</span>
                <span id="backendStatus" style="margin-left: 8px;">
                    <span style="color: #ef4444;">‚óè Checking...</span>
                </span>
            </div>
        </div>
    </footer>

    <script>
        // ==================== TRANSLATIONS ====================
        const translations = {
            tr: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "LLM Image Generation i√ßin detaylƒ± prompt hazƒ±rlama aracƒ±",
                prompt_settings: "Prompt Ayarlarƒ±",
                subject_section: "Konu",
                atmosphere_section: "Atmosfer & Stil",
                technical_section: "Teknik Ayarlar",
                quality_section: "Kalite & Detaylar",
                era_section: "D√∂nem & Zaman",
                environment_section: "Ortam & Mekan",
                character_section: "Karakter & Kƒ±yafet",
                subject_type: "Konu Tipi",
                subject_description: "Konu A√ßƒ±klamasƒ±",
                style: "Stil",
                mood: "Ruh Hali",
                color_palette: "Renk Paleti",
                lighting: "Aydƒ±nlatma",
                camera_type: "Kamera/Lens",
                camera_angle: "Kamera A√ßƒ±sƒ±",
                camera_settings: "Kamera Ayarlarƒ±",
                composition: "Kompozisyon",
                quality_modifiers: "Kalite Modifikat√∂rleri",
                additional_details: "Ek Detaylar",
                negative_prompt: "Negatif Prompt",
                era: "D√∂nem/Yƒ±l",
                time_of_day: "G√ºn√ºn Zamanƒ±",
                season: "Mevsim",
                location: "Mekan Tipi",
                setting: "Ortam",
                crowd: "Kalabalƒ±k",
                weather: "Hava Durumu",
                architecture: "Mimari Stil",
                clothing_style: "Kƒ±yafet Stili",
                clothing_era: "Kƒ±yafet D√∂nemi",
                age_group: "Ya≈ü Grubu",
                hair_style: "Sa√ß Stili",
                expression: "ƒ∞fade",
                pose: "Poz",
                film_type: "Film Tipi",
                aspect_ratio: "En Boy Oranƒ±",
                render_style: "Render Stili",
                // Contextual options - Street
                street_type: "Sokak Tipi",
                geographic_region: "Coƒürafi B√∂lge",
                // Contextual options - Landscape
                landscape_type: "Manzara Tipi",
                terrain: "Arazi",
                natural_elements: "Doƒüal √ñƒüeler",
                // Contextual options - Portrait
                ethnicity: "Etnisite",
                body_type: "V√ºcut Tipi",
                gender: "Cinsiyet",
                // Contextual options - Architecture
                building_type: "Bina Tipi",
                arch_style: "Mimari Akƒ±m",
                arch_era: "Mimari D√∂nem",
                // Contextual options - Food
                cuisine_type: "Mutfak",
                food_style: "Yiyecek Stili",
                plating: "Sunum",
                // Contextual options - Fashion
                fashion_category: "Moda Kategorisi",
                fashion_season: "Sezon",
                fashion_brand_style: "Marka Stili",
                // Contextual options - Wildlife
                animal_type: "Hayvan T√ºr√º",
                habitat: "Ya≈üam Alanƒ±",
                animal_behavior: "Davranƒ±≈ü",
                // Contextual options - Product
                product_type: "√úr√ºn Tipi",
                product_material: "Malzeme",
                product_background: "Arka Plan",
                // New sections
                hair_section: "Sa√ß",
                face_section: "Y√ºz & Makyaj",
                accessories_section: "Aksesuarlar",
                // New fields
                clothing_type: "Kƒ±yafet Tipi",
                clothing_color: "Kƒ±yafet Rengi",
                clothing_material: "Kuma≈ü",
                hair_color: "Sa√ß Rengi",
                hair_length: "Sa√ß Uzunluƒüu",
                skin_type: "Cilt Tipi",
                makeup_style: "Makyaj Stili",
                eyewear: "G√∂zl√ºk",
                earrings: "K√ºpe",
                necklace: "Kolye",
                bracelet: "Bileklik/Saat",
                rings: "Y√ºz√ºk",
                headwear: "≈ûapka/Ba≈ülƒ±k",
                select_placeholder: "Se√ßiniz...",
                subject_placeholder: "Ana konuyu detaylƒ± a√ßƒ±klayƒ±n... √ñrn: A young woman with flowing red hair, wearing a vintage dress",
                additional_placeholder: "Ekstra detaylar, √∂zel istekler...",
                negative_placeholder: "ƒ∞stemediƒüiniz √∂ƒüeler...",
                generate_btn: "Prompt Olu≈ütur",
                copy_btn: "Kopyala",
                copied_btn: "Kopyalandƒ±!",
                clear_btn: "Temizle",
                cinematic_preset: "Sinematik",
                portrait_preset: "Portre",
                generated_prompts: "Olu≈üturulan Promptlar",
                natural_tab: "Doƒüal",
                waiting_message: "Prompt olu≈üturmak i√ßin formu doldurun...",
                tips_title: "ƒ∞pu√ßlarƒ±",
                tip_toon: "Token-Oriented Object Notation - LLM i√ßin optimize edilmi≈ü kompakt format",
                tip_tonl: "Token-Optimized Notation Language - Yapƒ±landƒ±rƒ±lmƒ±≈ü veri formatƒ±",
                tip_json: "API entegrasyonlarƒ± i√ßin standart format",
                tip_natural: "Direkt kullanƒ±ma hazƒ±r virg√ºlle ayrƒ±lmƒ±≈ü format",
                footer_text: "Photo Prompt Generator",
                created_by: "Yapƒ±mcƒ±",
                formats_credit: "Formatlar",
                add_btn: "Ekle",
                add_negative_placeholder: "Yeni negatif prompt ekle...",
                custom_input_placeholder: "veya √∂zel deƒüer girin...",
                // Preset translations
                my_presets: "Kayƒ±tlƒ± Presetlerim",
                save_preset: "Preset Kaydet",
                no_presets: "Hen√ºz kayƒ±tlƒ± preset yok",
                save_preset_title: "Preset Kaydet",
                edit_preset_title: "Preset D√ºzenle",
                delete_preset_title: "Preset Sil",
                preset_name: "Preset Adƒ±",
                cancel: "ƒ∞ptal",
                save: "Kaydet",
                update: "G√ºncelle",
                delete: "Sil",
                delete_confirm: "Bu preseti silmek istediƒüinizden emin misiniz?",
                preset_saved: "Preset kaydedildi!",
                preset_updated: "Preset g√ºncellendi!",
                preset_deleted: "Preset silindi!",
                export_presets: "Dƒ±≈üa Aktar",
                import_presets: "ƒ∞√ße Aktar",
                presets_exported: "Presetler dƒ±≈üa aktarƒ±ldƒ±!",
                presets_imported: "Presetler i√ße aktarƒ±ldƒ±!",
                import_error: "ƒ∞√ße aktarma hatasƒ±. Ge√ßersiz dosya formatƒ±.",
                // Option translations - comprehensive Turkish labels
                options: {
                    // Subject types
                    portrait: "Portre", landscape: "Manzara", "still life": "Nat√ºrmort", abstract: "Soyut",
                    architecture: "Mimari", wildlife: "Yaban Hayatƒ±", street: "Sokak", product: "√úr√ºn",
                    food: "Yiyecek", fashion: "Moda", macro: "Makro", aerial: "Havadan", underwater: "Su Altƒ±",
                    sports: "Spor", documentary: "Belgesel", "fine art": "G√ºzel Sanat",
                    // Styles
                    photorealistic: "Foto-ger√ßek√ßi", cinematic: "Sinematik", anime: "Anime", cartoon: "Karikat√ºr",
                    "oil painting": "Yaƒülƒ± Boya", watercolor: "Suluboya", "digital art": "Dijital Sanat",
                    "3D render": "3D Render", sketch: "Eskiz", vintage: "Vintage", minimalist: "Minimalist",
                    surreal: "S√ºrreal", fantasy: "Fantastik", "sci-fi": "Bilim Kurgu", noir: "Noir",
                    impressionist: "Empresyonist", "pop art": "Pop Art", "art nouveau": "Art Nouveau",
                    baroque: "Barok", renaissance: "R√∂nesans",
                    // Era
                    prehistoric: "Tarih √ñncesi", "ancient egypt": "Antik Mƒ±sƒ±r", "ancient greece": "Antik Yunan",
                    "ancient rome": "Antik Roma", medieval: "Orta√ßaƒü", "1700s": "1700'ler",
                    "victorian era": "Viktorya D√∂nemi", "1920s art deco": "1920'ler Art Deco",
                    "1930s depression": "1930'lar Buhran", "1940s wartime": "1940'lar Sava≈ü",
                    "1950s retro": "1950'ler Retro", "1960s mod": "1960'lar Mod", "1970s disco": "1970'ler Disko",
                    "1980s synthwave": "1980'ler Synthwave", "1990s grunge": "1990'lar Grunge",
                    "2000s Y2K": "2000'ler Y2K", "2010s modern": "2010'lar Modern",
                    "2020s contemporary": "2020'ler √áaƒüda≈ü", "cyberpunk future": "Siberpunk Gelecek",
                    "post-apocalyptic": "Post-Apokaliptik", "far future": "Uzak Gelecek",
                    // Time of day
                    dawn: "≈ûafak", sunrise: "G√ºn Doƒüumu", "early morning": "Erken Sabah", morning: "Sabah",
                    midday: "√ñƒülen", afternoon: "√ñƒüleden Sonra", "golden hour": "Altƒ±n Saat", sunset: "G√ºn Batƒ±mƒ±",
                    dusk: "Alacakaranlƒ±k", "blue hour": "Mavi Saat", twilight: "Ak≈üam Karanlƒ±ƒüƒ±",
                    evening: "Ak≈üam", night: "Gece", midnight: "Gece Yarƒ±sƒ±", "late night": "Gece Ge√ß",
                    // Season
                    spring: "ƒ∞lkbahar", summer: "Yaz", autumn: "Sonbahar", winter: "Kƒ±≈ü",
                    "rainy season": "Yaƒümur Mevsimi", "dry season": "Kurak Mevsim", monsoon: "Muson",
                    // Location
                    indoor: "ƒ∞√ß Mekan", outdoor: "Dƒ±≈ü Mekan", studio: "St√ºdyo", urban: "Kentsel",
                    rural: "Kƒ±rsal", suburban: "Banliy√∂", beach: "Sahil", mountain: "Daƒü", forest: "Orman",
                    desert: "√á√∂l", space: "Uzay", rooftop: "√áatƒ±", underground: "Yeraltƒ±", industrial: "End√ºstriyel",
                    // Crowd
                    empty: "Bo≈ü", solitary: "Yalnƒ±z", couple: "√áift", "small group": "K√º√ß√ºk Grup",
                    "moderate crowd": "Orta Kalabalƒ±k", "busy crowd": "Yoƒüun Kalabalƒ±k",
                    "packed crowd": "Tƒ±klƒ±m Tƒ±klƒ±m", "festival crowd": "Festival Kalabalƒ±ƒüƒ±",
                    // Weather
                    "clear sky": "A√ßƒ±k Hava", "partly cloudy": "Par√ßalƒ± Bulutlu", overcast: "Kapalƒ±",
                    "light rain": "Hafif Yaƒümur", "heavy rain": "≈ûiddetli Yaƒümur", thunderstorm: "Fƒ±rtƒ±na",
                    snow: "Kar", blizzard: "Tipi", fog: "Sis", mist: "Pus", haze: "Duman",
                    windy: "R√ºzgarlƒ±", sandstorm: "Kum Fƒ±rtƒ±nasƒ±", rainbow: "G√∂kku≈üaƒüƒ±",
                    // Lighting
                    "natural light": "Doƒüal I≈üƒ±k", "studio lighting": "St√ºdyo I≈üƒ±ƒüƒ±", dramatic: "Dramatik",
                    soft: "Yumu≈üak", backlit: "Arka I≈üƒ±k", "rim light": "Kenar I≈üƒ±ƒüƒ±", neon: "Neon",
                    candlelight: "Mum I≈üƒ±ƒüƒ±", moonlight: "Ay I≈üƒ±ƒüƒ±", "harsh sunlight": "Sert G√ºne≈ü",
                    volumetric: "Hacimsel", chiaroscuro: "I≈üƒ±k-G√∂lge", "split lighting": "B√∂l√ºnm√º≈ü I≈üƒ±k",
                    "butterfly lighting": "Kelebek I≈üƒ±k", "rembrandt lighting": "Rembrandt I≈üƒ±k",
                    // Mood
                    peaceful: "Huzurlu", mysterious: "Gizemli", joyful: "Ne≈üeli", melancholic: "Melankolik",
                    energetic: "Enerjik", romantic: "Romantik", eerie: "√úrk√ºt√ºc√º", nostalgic: "Nostaljik",
                    epic: "Epik", serene: "Sakin", tense: "Gergin", whimsical: "Tuhaf", dark: "Karanlƒ±k",
                    hopeful: "Umutlu", lonely: "Yalnƒ±z", chaotic: "Kaotik", dreamy: "R√ºya Gibi",
                    intense: "Yoƒüun", playful: "Oyuncu",
                    // Color palette
                    vibrant: "Canlƒ±", muted: "Soluk", monochrome: "Tek Renk", "warm tones": "Sƒ±cak Tonlar",
                    "cool tones": "Soƒüuk Tonlar", pastel: "Pastel", "earth tones": "Toprak Tonlarƒ±",
                    "black and white": "Siyah Beyaz", sepia: "Sepya", "high contrast": "Y√ºksek Kontrast",
                    desaturated: "D√º≈ü√ºk Doygunluk", complementary: "Tamamlayƒ±cƒ±", analogous: "Analog",
                    triadic: "√ú√ßl√º", "jewel tones": "M√ºcevher Tonlarƒ±", "autumn colors": "Sonbahar Renkleri",
                    "ocean blues": "Okyanus Mavisi",
                    // Character
                    casual: "G√ºnl√ºk", formal: "Resmi", business: "ƒ∞≈ü", streetwear: "Sokak Giyim",
                    "haute couture": "Haute Couture", bohemian: "Bohem", punk: "Punk", gothic: "Gotik",
                    preppy: "Preppy", sporty: "Sportif", elegant: "Zarif", rugged: "Sert",
                    military: "Askeri", traditional: "Geleneksel", futuristic: "F√ºt√ºristik",
                    "fantasy armor": "Fantezi Zƒ±rh", "royal attire": "Kraliyet Kƒ±yafeti",
                    // Age groups
                    infant: "Bebek", toddler: "Y√ºr√ºmeye Ba≈ülayan", child: "√áocuk", teenager: "Ergen",
                    "young adult": "Gen√ß Yeti≈ükin", adult: "Yeti≈ükin", "middle-aged": "Orta Ya≈ülƒ±",
                    elderly: "Ya≈ülƒ±", ageless: "Ya≈üsƒ±z",
                    // Expressions
                    neutral: "N√∂tr", smiling: "G√ºl√ºmseyen", laughing: "G√ºlen", serious: "Ciddi",
                    contemplative: "D√º≈ü√ºnceli", surprised: "≈ûa≈ükƒ±n", angry: "Kƒ±zgƒ±n", sad: "√úzg√ºn",
                    fearful: "Korkmu≈ü", determined: "Kararlƒ±", curious: "Meraklƒ±", confident: "Kendinden Emin",
                    // Poses
                    standing: "Ayakta", sitting: "Oturan", "lying down": "Uzanmƒ±≈ü", walking: "Y√ºr√ºyen",
                    running: "Ko≈üan", jumping: "Zƒ±playan", dancing: "Dans Eden", leaning: "Yaslanmƒ±≈ü",
                    crouching: "√á√∂melmi≈ü", kneeling: "Diz √á√∂km√º≈ü", "action pose": "Aksiyon Pozu",
                    relaxed: "Rahat", "formal pose": "Resmi Poz", candid: "Doƒüal",
                    "profile view": "Profil", "three-quarter view": "3/4 G√∂r√ºn√ºm", "back view": "Arkadan",
                    // Camera angles
                    "eye level": "G√∂z Hizasƒ±", "low angle": "Al√ßak A√ßƒ±", "high angle": "Y√ºksek A√ßƒ±",
                    "bird's eye": "Ku≈ü Bakƒ±≈üƒ±", "worm's eye": "Solucan Bakƒ±≈üƒ±", "dutch angle": "Dutch A√ßƒ±",
                    "over the shoulder": "Omuz √úst√º", "close-up": "Yakƒ±n Plan",
                    "extreme close-up": "A≈üƒ±rƒ± Yakƒ±n", "wide shot": "Geni≈ü Plan", "medium shot": "Orta Plan",
                    "full body shot": "Tam Boy", "cowboy shot": "Kovboy Plan", "POV shot": "Bakƒ±≈ü A√ßƒ±sƒ±",
                    // Camera settings
                    "shallow depth of field": "Sƒ±ƒü Alan Derinliƒüi", "deep focus": "Derin Odak", bokeh: "Bokeh",
                    "motion blur": "Hareket Bulanƒ±klƒ±ƒüƒ±", "long exposure": "Uzun Pozlama",
                    "tilt-shift": "Tilt-Shift", "fish-eye": "Balƒ±k G√∂z√º", macro: "Makro",
                    "telephoto compression": "Telefoto", "wide angle distortion": "Geni≈ü A√ßƒ± Distorsiyon",
                    "f/1.4 aperture": "f/1.4 Diyafram", "f/8 aperture": "f/8 Diyafram",
                    "fast shutter": "Hƒ±zlƒ± Enstantane", "slow shutter": "Yava≈ü Enstantane",
                    // Composition
                    "rule of thirds": "√ú√ßler Kuralƒ±", centered: "Merkezli", symmetrical: "Simetrik",
                    "leading lines": "Y√∂nlendirici √áizgiler", framing: "√áer√ßeveleme",
                    "negative space": "Negatif Alan", "golden ratio": "Altƒ±n Oran", diagonal: "Diyagonal",
                    layered: "Katmanlƒ±", "fill the frame": "Kadrajƒ± Doldur", patterns: "Desenler",
                    juxtaposition: "Yan Yana Koyma", "foreground interest": "√ñn Plan ƒ∞lgisi",
                    // Quality
                    "8K": "8K", "ultra detailed": "Ultra Detaylƒ±", hyperrealistic: "Hiper-ger√ßek√ßi",
                    masterpiece: "Ba≈üyapƒ±t", professional: "Profesyonel", "award-winning": "√ñd√ºll√º",
                    "high resolution": "Y√ºksek √á√∂z√ºn√ºrl√ºk", "sharp focus": "Keskin Odak",
                    "intricate details": "ƒ∞nce Detaylar", photographic: "Fotografik",
                    "studio quality": "St√ºdyo Kalitesi", "magazine cover": "Dergi Kapaƒüƒ±",
                    editorial: "Edit√∂ryal", "gallery quality": "Galeri Kalitesi",
                    // Gender
                    female: "Kadƒ±n", male: "Erkek", androgynous: "Androjen", "non-binary": "Non-Binary",
                    // Body types
                    slim: "ƒ∞nce", athletic: "Atletik", muscular: "Kaslƒ±", average: "Ortalama",
                    curvy: "Dolgun", "plus size": "B√ºy√ºk Beden", petite: "Minyon", tall: "Uzun",
                    "model physique": "Model Fiziƒüi"
                }
            },
            en: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "Advanced prompt preparation tool for LLM Image Generation",
                prompt_settings: "Prompt Settings",
                subject_section: "Subject",
                atmosphere_section: "Atmosphere & Style",
                technical_section: "Technical Settings",
                quality_section: "Quality & Details",
                era_section: "Era & Time",
                environment_section: "Environment & Location",
                character_section: "Character & Clothing",
                subject_type: "Subject Type",
                subject_description: "Subject Description",
                style: "Style",
                mood: "Mood",
                color_palette: "Color Palette",
                lighting: "Lighting",
                camera_type: "Camera/Lens",
                camera_angle: "Camera Angle",
                camera_settings: "Camera Settings",
                composition: "Composition",
                quality_modifiers: "Quality Modifiers",
                additional_details: "Additional Details",
                negative_prompt: "Negative Prompt",
                era: "Era/Year",
                time_of_day: "Time of Day",
                season: "Season",
                location: "Location Type",
                setting: "Setting",
                crowd: "Crowd Level",
                weather: "Weather",
                architecture: "Architecture Style",
                clothing_style: "Clothing Style",
                clothing_era: "Clothing Era",
                age_group: "Age Group",
                hair_style: "Hair Style",
                expression: "Expression",
                pose: "Pose",
                film_type: "Film Type",
                aspect_ratio: "Aspect Ratio",
                render_style: "Render Style",
                // Contextual options - Street
                street_type: "Street Type",
                geographic_region: "Geographic Region",
                // Contextual options - Landscape
                landscape_type: "Landscape Type",
                terrain: "Terrain",
                natural_elements: "Natural Elements",
                // Contextual options - Portrait
                ethnicity: "Ethnicity",
                body_type: "Body Type",
                gender: "Gender",
                // Contextual options - Architecture
                building_type: "Building Type",
                arch_style: "Architectural Style",
                arch_era: "Architectural Era",
                // Contextual options - Food
                cuisine_type: "Cuisine",
                food_style: "Food Style",
                plating: "Plating",
                // Contextual options - Fashion
                fashion_category: "Fashion Category",
                fashion_season: "Season",
                fashion_brand_style: "Brand Style",
                // Contextual options - Wildlife
                animal_type: "Animal Type",
                habitat: "Habitat",
                animal_behavior: "Behavior",
                // Contextual options - Product
                product_type: "Product Type",
                product_material: "Material",
                product_background: "Background",
                // New sections
                hair_section: "Hair",
                face_section: "Face & Makeup",
                accessories_section: "Accessories",
                // New fields
                clothing_type: "Clothing Type",
                clothing_color: "Clothing Color",
                clothing_material: "Fabric",
                hair_color: "Hair Color",
                hair_length: "Hair Length",
                skin_type: "Skin Type",
                makeup_style: "Makeup Style",
                eyewear: "Eyewear",
                earrings: "Earrings",
                necklace: "Necklace",
                bracelet: "Bracelet/Watch",
                rings: "Rings",
                headwear: "Headwear",
                select_placeholder: "Select...",
                subject_placeholder: "Describe the main subject in detail... E.g: A young woman with flowing red hair, wearing a vintage dress",
                additional_placeholder: "Extra details, special requests...",
                negative_placeholder: "Elements you don't want...",
                generate_btn: "Generate Prompt",
                copy_btn: "Copy",
                copied_btn: "Copied!",
                clear_btn: "Clear",
                cinematic_preset: "Cinematic",
                portrait_preset: "Portrait",
                generated_prompts: "Generated Prompts",
                natural_tab: "Natural",
                waiting_message: "Fill out the form to generate a prompt...",
                tips_title: "Tips",
                tip_toon: "Token-Oriented Object Notation - Compact format optimized for LLMs",
                tip_tonl: "Token-Optimized Notation Language - Structured data format",
                tip_json: "Standard format for API integrations",
                tip_natural: "Ready-to-use comma-separated format",
                footer_text: "Photo Prompt Generator",
                created_by: "Created by",
                formats_credit: "Formats",
                add_btn: "Add",
                add_negative_placeholder: "Add new negative prompt...",
                custom_input_placeholder: "or enter custom value...",
                // Preset translations
                my_presets: "My Saved Presets",
                save_preset: "Save Preset",
                no_presets: "No saved presets yet",
                save_preset_title: "Save Preset",
                edit_preset_title: "Edit Preset",
                delete_preset_title: "Delete Preset",
                preset_name: "Preset Name",
                cancel: "Cancel",
                save: "Save",
                update: "Update",
                delete: "Delete",
                delete_confirm: "Are you sure you want to delete this preset?",
                preset_saved: "Preset saved!",
                preset_updated: "Preset updated!",
                preset_deleted: "Preset deleted!",
                export_presets: "Export",
                import_presets: "Import",
                presets_exported: "Presets exported!",
                presets_imported: "Presets imported!",
                import_error: "Import error. Invalid file format.",
                options: {}
            },
            // German
            de: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "Detailliertes Prompt-Erstellungstool f√ºr LLM-Bildgenerierung",
                prompt_settings: "Prompt-Einstellungen",
                subject_section: "Motiv",
                atmosphere_section: "Atmosph√§re & Stil",
                technical_section: "Technische Einstellungen",
                quality_section: "Qualit√§t & Details",
                era_section: "Epoche & Zeit",
                environment_section: "Umgebung & Ort",
                character_section: "Charakter & Kleidung",
                subject_type: "Motivtyp",
                subject_description: "Motivbeschreibung",
                style: "Stil",
                mood: "Stimmung",
                color_palette: "Farbpalette",
                lighting: "Beleuchtung",
                camera_type: "Kamera/Objektiv",
                camera_angle: "Kamerawinkel",
                camera_settings: "Kameraeinstellungen",
                composition: "Komposition",
                quality_modifiers: "Qualit√§tsmodifikatoren",
                additional_details: "Zus√§tzliche Details",
                negative_prompt: "Negativer Prompt",
                era: "Epoche/Jahr",
                time_of_day: "Tageszeit",
                season: "Jahreszeit",
                location: "Standorttyp",
                setting: "Umgebung",
                crowd: "Menschenmenge",
                weather: "Wetter",
                architecture: "Architekturstil",
                clothing_style: "Kleidungsstil",
                clothing_era: "Kleidungsepoche",
                age_group: "Altersgruppe",
                hair_style: "Frisur",
                expression: "Ausdruck",
                pose: "Pose",
                film_type: "Filmtyp",
                aspect_ratio: "Seitenverh√§ltnis",
                render_style: "Render-Stil",
                select_placeholder: "Ausw√§hlen...",
                description_placeholder: "Detaillierte Beschreibung...",
                negative_placeholder: "Unerw√ºnschte Elemente...",
                generate_btn: "Prompt Generieren",
                copy_btn: "Kopieren",
                copied_btn: "Kopiert!",
                clear_btn: "L√∂schen",
                cinematic_preset: "Filmisch",
                portrait_preset: "Portr√§t",
                generated_prompts: "Generierte Prompts",
                natural_tab: "Nat√ºrlich",
                waiting_message: "F√ºllen Sie das Formular aus, um einen Prompt zu generieren...",
                my_presets: "Meine Presets",
                save_preset: "Preset Speichern",
                no_presets: "Noch keine Presets gespeichert",
                save_preset_title: "Preset Speichern",
                edit_preset_title: "Preset Bearbeiten",
                delete_preset_title: "Preset L√∂schen",
                preset_name: "Preset-Name",
                cancel: "Abbrechen",
                save: "Speichern",
                update: "Aktualisieren",
                delete: "L√∂schen",
                delete_confirm: "M√∂chten Sie dieses Preset wirklich l√∂schen?",
                preset_saved: "Preset gespeichert!",
                preset_updated: "Preset aktualisiert!",
                preset_deleted: "Preset gel√∂scht!",
                export_presets: "Exportieren",
                import_presets: "Importieren",
                presets_exported: "Presets exportiert!",
                presets_imported: "Presets importiert!",
                import_error: "Importfehler. Ung√ºltiges Dateiformat.",
                custom_input_placeholder: "oder eigenen Wert eingeben...",
                options: {}
            },
            // French
            fr: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "Outil de cr√©ation de prompts d√©taill√©s pour la g√©n√©ration d'images LLM",
                prompt_settings: "Param√®tres du Prompt",
                subject_section: "Sujet",
                atmosphere_section: "Atmosph√®re & Style",
                technical_section: "Param√®tres Techniques",
                quality_section: "Qualit√© & D√©tails",
                era_section: "√âpoque & Temps",
                environment_section: "Environnement & Lieu",
                character_section: "Personnage & V√™tements",
                subject_type: "Type de Sujet",
                subject_description: "Description du Sujet",
                style: "Style",
                mood: "Ambiance",
                color_palette: "Palette de Couleurs",
                lighting: "√âclairage",
                camera_type: "Appareil/Objectif",
                camera_angle: "Angle de Cam√©ra",
                camera_settings: "Param√®tres Cam√©ra",
                composition: "Composition",
                quality_modifiers: "Modificateurs de Qualit√©",
                additional_details: "D√©tails Suppl√©mentaires",
                negative_prompt: "Prompt N√©gatif",
                era: "√âpoque/Ann√©e",
                time_of_day: "Moment de la Journ√©e",
                season: "Saison",
                location: "Type de Lieu",
                setting: "D√©cor",
                crowd: "Foule",
                weather: "M√©t√©o",
                select_placeholder: "S√©lectionner...",
                description_placeholder: "Description d√©taill√©e...",
                negative_placeholder: "√âl√©ments ind√©sirables...",
                generate_btn: "G√©n√©rer le Prompt",
                copy_btn: "Copier",
                copied_btn: "Copi√©!",
                clear_btn: "Effacer",
                cinematic_preset: "Cin√©matique",
                portrait_preset: "Portrait",
                generated_prompts: "Prompts G√©n√©r√©s",
                natural_tab: "Naturel",
                waiting_message: "Remplissez le formulaire pour g√©n√©rer un prompt...",
                my_presets: "Mes Presets",
                save_preset: "Enregistrer Preset",
                no_presets: "Aucun preset enregistr√©",
                preset_saved: "Preset enregistr√©!",
                preset_updated: "Preset mis √† jour!",
                preset_deleted: "Preset supprim√©!",
                export_presets: "Exporter",
                import_presets: "Importer",
                presets_exported: "Presets export√©s!",
                presets_imported: "Presets import√©s!",
                import_error: "Erreur d'importation. Format de fichier invalide.",
                custom_input_placeholder: "ou entrez une valeur personnalis√©e...",
                cancel: "Annuler",
                save: "Enregistrer",
                update: "Mettre √† jour",
                delete: "Supprimer",
                options: {}
            },
            // Spanish
            es: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "Herramienta de creaci√≥n de prompts detallados para generaci√≥n de im√°genes LLM",
                prompt_settings: "Configuraci√≥n del Prompt",
                subject_section: "Sujeto",
                atmosphere_section: "Atm√≥sfera y Estilo",
                technical_section: "Configuraci√≥n T√©cnica",
                quality_section: "Calidad y Detalles",
                era_section: "√âpoca y Tiempo",
                environment_section: "Entorno y Ubicaci√≥n",
                character_section: "Personaje y Ropa",
                subject_type: "Tipo de Sujeto",
                subject_description: "Descripci√≥n del Sujeto",
                style: "Estilo",
                mood: "Estado de √Ånimo",
                color_palette: "Paleta de Colores",
                lighting: "Iluminaci√≥n",
                camera_type: "C√°mara/Lente",
                camera_angle: "√Ångulo de C√°mara",
                select_placeholder: "Seleccionar...",
                description_placeholder: "Descripci√≥n detallada...",
                generate_btn: "Generar Prompt",
                copy_btn: "Copiar",
                copied_btn: "¬°Copiado!",
                clear_btn: "Limpiar",
                cinematic_preset: "Cinematogr√°fico",
                portrait_preset: "Retrato",
                generated_prompts: "Prompts Generados",
                waiting_message: "Complete el formulario para generar un prompt...",
                my_presets: "Mis Presets",
                save_preset: "Guardar Preset",
                no_presets: "Sin presets guardados",
                preset_saved: "¬°Preset guardado!",
                export_presets: "Exportar",
                import_presets: "Importar",
                custom_input_placeholder: "o ingrese valor personalizado...",
                cancel: "Cancelar",
                save: "Guardar",
                delete: "Eliminar",
                options: {}
            },
            // Italian
            it: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "Strumento di creazione prompt dettagliati per generazione immagini LLM",
                prompt_settings: "Impostazioni Prompt",
                subject_section: "Soggetto",
                atmosphere_section: "Atmosfera e Stile",
                technical_section: "Impostazioni Tecniche",
                subject_type: "Tipo di Soggetto",
                style: "Stile",
                select_placeholder: "Seleziona...",
                generate_btn: "Genera Prompt",
                copy_btn: "Copia",
                copied_btn: "Copiato!",
                clear_btn: "Cancella",
                cinematic_preset: "Cinematografico",
                portrait_preset: "Ritratto",
                my_presets: "I Miei Preset",
                save_preset: "Salva Preset",
                export_presets: "Esporta",
                import_presets: "Importa",
                custom_input_placeholder: "o inserisci valore personalizzato...",
                cancel: "Annulla",
                save: "Salva",
                options: {}
            },
            // Portuguese
            pt: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "Ferramenta de cria√ß√£o de prompts detalhados para gera√ß√£o de imagens LLM",
                prompt_settings: "Configura√ß√µes do Prompt",
                subject_section: "Assunto",
                atmosphere_section: "Atmosfera e Estilo",
                subject_type: "Tipo de Assunto",
                style: "Estilo",
                select_placeholder: "Selecionar...",
                generate_btn: "Gerar Prompt",
                copy_btn: "Copiar",
                copied_btn: "Copiado!",
                clear_btn: "Limpar",
                cinematic_preset: "Cinematogr√°fico",
                portrait_preset: "Retrato",
                my_presets: "Meus Presets",
                save_preset: "Salvar Preset",
                export_presets: "Exportar",
                import_presets: "Importar",
                custom_input_placeholder: "ou insira valor personalizado...",
                cancel: "Cancelar",
                save: "Salvar",
                options: {}
            },
            // Russian
            ru: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π LLM",
                prompt_settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü—Ä–æ–º–ø—Ç–∞",
                subject_section: "–û–±—ä–µ–∫—Ç",
                atmosphere_section: "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –∏ –°—Ç–∏–ª—å",
                technical_section: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∏",
                subject_type: "–¢–∏–ø –û–±—ä–µ–∫—Ç–∞",
                style: "–°—Ç–∏–ª—å",
                mood: "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
                lighting: "–û—Å–≤–µ—â–µ–Ω–∏–µ",
                select_placeholder: "–í—ã–±—Ä–∞—Ç—å...",
                generate_btn: "–°–æ–∑–¥–∞—Ç—å –ü—Ä–æ–º–ø—Ç",
                copy_btn: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
                copied_btn: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!",
                clear_btn: "–û—á–∏—Å—Ç–∏—Ç—å",
                cinematic_preset: "–ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π",
                portrait_preset: "–ü–æ—Ä—Ç—Ä–µ—Ç",
                my_presets: "–ú–æ–∏ –ü—Ä–µ—Å–µ—Ç—ã",
                save_preset: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ü—Ä–µ—Å–µ—Ç",
                export_presets: "–≠–∫—Å–ø–æ—Ä—Ç",
                import_presets: "–ò–º–ø–æ—Ä—Ç",
                custom_input_placeholder: "–∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –∑–Ω–∞—á–µ–Ω–∏–µ...",
                cancel: "–û—Ç–º–µ–Ω–∞",
                save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
                options: {}
            },
            // Japanese
            ja: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "LLMÁîªÂÉèÁîüÊàê„ÅÆ„Åü„ÇÅ„ÅÆË©≥Á¥∞„Éó„É≠„É≥„Éó„Éà‰ΩúÊàê„ÉÑ„Éº„É´",
                prompt_settings: "„Éó„É≠„É≥„Éó„ÉàË®≠ÂÆö",
                subject_section: "Ë¢´ÂÜô‰Ωì",
                atmosphere_section: "Èõ∞Âõ≤Ê∞ó„Å®„Çπ„Çø„Ç§„É´",
                technical_section: "ÊäÄË°ìË®≠ÂÆö",
                subject_type: "Ë¢´ÂÜô‰Ωì„Çø„Ç§„Éó",
                style: "„Çπ„Çø„Ç§„É´",
                mood: "„É†„Éº„Éâ",
                lighting: "ÁÖßÊòé",
                select_placeholder: "ÈÅ∏Êäû...",
                generate_btn: "„Éó„É≠„É≥„Éó„ÉàÁîüÊàê",
                copy_btn: "„Ç≥„Éî„Éº",
                copied_btn: "„Ç≥„Éî„ÉºÂÆå‰∫Ü!",
                clear_btn: "„ÇØ„É™„Ç¢",
                cinematic_preset: "„Ç∑„Éç„Éû„ÉÜ„Ç£„ÉÉ„ÇØ",
                portrait_preset: "„Éù„Éº„Éà„É¨„Éº„Éà",
                my_presets: "„Éû„Ç§„Éó„É™„Çª„ÉÉ„Éà",
                save_preset: "„Éó„É™„Çª„ÉÉ„Éà‰øùÂ≠ò",
                export_presets: "„Ç®„ÇØ„Çπ„Éù„Éº„Éà",
                import_presets: "„Ç§„É≥„Éù„Éº„Éà",
                custom_input_placeholder: "„Åæ„Åü„ÅØ„Ç´„Çπ„Çø„É†ÂÄ§„ÇíÂÖ•Âäõ...",
                cancel: "„Ç≠„É£„É≥„Çª„É´",
                save: "‰øùÂ≠ò",
                options: {}
            },
            // Chinese
            zh: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "LLMÂõæÂÉèÁîüÊàêÁöÑËØ¶ÁªÜÊèêÁ§∫ËØçÂàõÂª∫Â∑•ÂÖ∑",
                prompt_settings: "ÊèêÁ§∫ËØçËÆæÁΩÆ",
                subject_section: "‰∏ªÈ¢ò",
                atmosphere_section: "Ê∞õÂõ¥‰∏éÈ£éÊ†º",
                technical_section: "ÊäÄÊúØËÆæÁΩÆ",
                subject_type: "‰∏ªÈ¢òÁ±ªÂûã",
                style: "È£éÊ†º",
                mood: "ÊÉÖÁª™",
                lighting: "ÂÖâÁ∫ø",
                select_placeholder: "ÈÄâÊã©...",
                generate_btn: "ÁîüÊàêÊèêÁ§∫ËØç",
                copy_btn: "Â§çÂà∂",
                copied_btn: "Â∑≤Â§çÂà∂!",
                clear_btn: "Ê∏ÖÈô§",
                cinematic_preset: "ÁîµÂΩ±ÊÑü",
                portrait_preset: "ËÇñÂÉè",
                my_presets: "ÊàëÁöÑÈ¢ÑËÆæ",
                save_preset: "‰øùÂ≠òÈ¢ÑËÆæ",
                export_presets: "ÂØºÂá∫",
                import_presets: "ÂØºÂÖ•",
                custom_input_placeholder: "ÊàñËæìÂÖ•Ëá™ÂÆö‰πâÂÄº...",
                cancel: "ÂèñÊ∂à",
                save: "‰øùÂ≠ò",
                options: {}
            },
            // Korean
            ko: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "LLM Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±ÏùÑ ÏúÑÌïú ÏÉÅÏÑ∏ ÌîÑÎ°¨ÌîÑÌä∏ ÏûëÏÑ± ÎèÑÍµ¨",
                prompt_settings: "ÌîÑÎ°¨ÌîÑÌä∏ ÏÑ§Ï†ï",
                subject_section: "Ï£ºÏ†ú",
                atmosphere_section: "Î∂ÑÏúÑÍ∏∞ & Ïä§ÌÉÄÏùº",
                technical_section: "Í∏∞Ïà† ÏÑ§Ï†ï",
                subject_type: "Ï£ºÏ†ú Ïú†Ìòï",
                style: "Ïä§ÌÉÄÏùº",
                mood: "Î∂ÑÏúÑÍ∏∞",
                lighting: "Ï°∞Î™Ö",
                select_placeholder: "ÏÑ†ÌÉù...",
                generate_btn: "ÌîÑÎ°¨ÌîÑÌä∏ ÏÉùÏÑ±",
                copy_btn: "Î≥µÏÇ¨",
                copied_btn: "Î≥µÏÇ¨Îê®!",
                clear_btn: "ÏßÄÏö∞Í∏∞",
                cinematic_preset: "ÏãúÎÑ§ÎßàÌã±",
                portrait_preset: "Ïù∏Î¨º",
                my_presets: "ÎÇ¥ ÌîÑÎ¶¨ÏÖã",
                save_preset: "ÌîÑÎ¶¨ÏÖã Ï†ÄÏû•",
                export_presets: "ÎÇ¥Î≥¥ÎÇ¥Í∏∞",
                import_presets: "Í∞ÄÏ†∏Ïò§Í∏∞",
                custom_input_placeholder: "ÎòêÎäî ÏÇ¨Ïö©Ïûê ÏßÄÏ†ï Í∞í ÏûÖÎ†•...",
                cancel: "Ï∑®ÏÜå",
                save: "Ï†ÄÏû•",
                options: {}
            },
            // Arabic
            ar: {
                page_title: "Photo Prompt Generator",
                page_subtitle: "ÿ£ÿØÿßÿ© ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàÿ¨Ÿáÿßÿ™ ŸÖŸÅÿµŸÑÿ© ŸÑÿ™ŸàŸÑŸäÿØ ÿµŸàÿ± LLM",
                prompt_settings: "ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸàÿ¨Ÿá",
                subject_section: "ÿßŸÑŸÖŸàÿ∂Ÿàÿπ",
                atmosphere_section: "ÿßŸÑÿ£ÿ¨Ÿàÿßÿ° ŸàÿßŸÑÿ£ÿ≥ŸÑŸàÿ®",
                technical_section: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ™ŸÇŸÜŸäÿ©",
                subject_type: "ŸÜŸàÿπ ÿßŸÑŸÖŸàÿ∂Ÿàÿπ",
                style: "ÿßŸÑÿ£ÿ≥ŸÑŸàÿ®",
                mood: "ÿßŸÑŸÖÿ≤ÿßÿ¨",
                lighting: "ÿßŸÑÿ•ÿ∂ÿßÿ°ÿ©",
                select_placeholder: "ÿßÿÆÿ™ÿ±...",
                generate_btn: "ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàÿ¨Ÿá",
                copy_btn: "ŸÜÿ≥ÿÆ",
                copied_btn: "ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ!",
                clear_btn: "ŸÖÿ≥ÿ≠",
                cinematic_preset: "ÿ≥ŸäŸÜŸÖÿßÿ¶Ÿä",
                portrait_preset: "ÿµŸàÿ±ÿ© ÿ¥ÿÆÿµŸäÿ©",
                my_presets: "ÿ•ÿπÿØÿßÿØÿßÿ™Ÿä ÿßŸÑŸÖÿ≥ÿ®ŸÇÿ©",
                save_preset: "ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØ",
                export_presets: "ÿ™ÿµÿØŸäÿ±",
                import_presets: "ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ",
                custom_input_placeholder: "ÿ£Ÿà ÿ£ÿØÿÆŸÑ ŸÇŸäŸÖÿ© ŸÖÿÆÿµÿµÿ©...",
                cancel: "ÿ•ŸÑÿ∫ÿßÿ°",
                save: "ÿ≠ŸÅÿ∏",
                options: {}
            }
        };

        // ==================== OPTIONS DATA ====================
        const promptOptions = {
            // Subject
            subject_type: ["portrait", "landscape", "still life", "abstract", "architecture", "wildlife", "street", "product", "food", "fashion", "macro", "aerial", "underwater", "sports", "documentary", "fine art"],
            style: ["photorealistic", "cinematic", "anime", "cartoon", "oil painting", "watercolor", "digital art", "3D render", "sketch", "vintage", "minimalist", "surreal", "fantasy", "sci-fi", "noir", "impressionist", "pop art", "art nouveau", "baroque", "renaissance"],
            
            // Era & Time
            era: ["prehistoric", "ancient egypt", "ancient greece", "ancient rome", "medieval", "renaissance", "1700s", "victorian era", "1920s art deco", "1930s depression", "1940s wartime", "1950s retro", "1960s mod", "1970s disco", "1980s synthwave", "1990s grunge", "2000s Y2K", "2010s modern", "2020s contemporary", "cyberpunk future", "post-apocalyptic", "far future"],
            time_of_day: ["dawn", "sunrise", "early morning", "morning", "midday", "afternoon", "golden hour", "sunset", "dusk", "blue hour", "twilight", "evening", "night", "midnight", "late night"],
            season: ["spring", "summer", "autumn", "winter", "rainy season", "dry season", "monsoon"],
            
            // Environment
            location: ["indoor", "outdoor", "studio", "urban", "rural", "suburban", "beach", "mountain", "forest", "desert", "underwater", "space", "rooftop", "underground", "industrial"],
            setting: ["city street", "countryside", "beach", "mountain peak", "forest clearing", "desert dunes", "snowy landscape", "tropical island", "ancient ruins", "modern office", "cozy cafe", "luxury hotel", "abandoned building", "futuristic city", "medieval castle", "japanese garden", "european plaza", "american suburb", "asian market", "african savanna"],
            crowd: ["empty", "solitary", "couple", "small group", "moderate crowd", "busy crowd", "packed crowd", "festival crowd"],
            weather: ["clear sky", "partly cloudy", "overcast", "light rain", "heavy rain", "thunderstorm", "snow", "blizzard", "fog", "mist", "haze", "windy", "sandstorm", "rainbow"],
            architecture: ["modern", "classical", "gothic", "art deco", "brutalist", "victorian", "colonial", "japanese traditional", "minimalist", "industrial", "futuristic", "organic", "mediterranean", "scandinavian"],
            
            // Atmosphere
            lighting: ["natural light", "golden hour", "blue hour", "studio lighting", "dramatic", "soft", "backlit", "rim light", "neon", "candlelight", "moonlight", "overcast", "harsh sunlight", "volumetric", "chiaroscuro", "split lighting", "butterfly lighting", "rembrandt lighting"],
            mood: ["peaceful", "dramatic", "mysterious", "joyful", "melancholic", "energetic", "romantic", "eerie", "nostalgic", "epic", "serene", "tense", "whimsical", "dark", "hopeful", "lonely", "chaotic", "dreamy", "intense", "playful"],
            color_palette: ["vibrant", "muted", "monochrome", "warm tones", "cool tones", "pastel", "neon", "earth tones", "black and white", "sepia", "high contrast", "desaturated", "complementary", "analogous", "triadic", "jewel tones", "autumn colors", "ocean blues"],
            
            // Character & Clothing
            clothing_style: ["casual", "formal", "business", "streetwear", "haute couture", "vintage", "bohemian", "minimalist", "punk", "gothic", "preppy", "sporty", "elegant", "rugged", "military", "traditional", "futuristic", "fantasy armor", "royal attire"],
            clothing_type: ["t-shirt", "hoodie", "sweater", "blazer", "jacket", "coat", "dress", "gown", "suit", "jeans", "pants", "skirt", "shorts", "tank top", "blouse", "shirt", "cardigan", "vest", "robe", "uniform", "swimwear", "lingerie", "athletic wear"],
            clothing_color: ["white", "black", "navy blue", "red", "burgundy", "pink", "coral", "orange", "yellow", "green", "olive", "teal", "purple", "lavender", "brown", "tan", "beige", "cream", "grey", "heather grey", "multicolor", "pastel", "neon", "metallic", "denim blue"],
            clothing_material: ["cotton", "silk", "satin", "velvet", "lace", "leather", "denim", "wool", "cashmere", "fleece", "linen", "chiffon", "tulle", "sequins", "mesh", "jersey", "tweed", "corduroy", "suede", "faux fur", "PVC", "latex"],
            clothing_era: ["ancient", "medieval", "renaissance", "baroque", "victorian", "edwardian", "1920s flapper", "1940s wartime", "1950s rockabilly", "1960s mod", "1970s hippie", "1980s power suit", "1990s grunge", "2000s Y2K", "contemporary", "futuristic"],
            age_group: ["infant", "toddler", "child", "teenager", "young adult", "adult", "middle-aged", "elderly", "ageless"],
            hair_style: ["long flowing", "short cropped", "bob cut", "pixie cut", "curly", "straight", "wavy", "braided", "ponytail", "bun", "dreadlocks", "mohawk", "bald", "afro", "vintage waves", "messy", "slicked back", "middle part", "side part", "wet look", "beach waves", "tight low bun", "high ponytail", "space buns", "half up half down"],
            hair_color: ["black", "dark brown", "medium brown", "light brown", "auburn", "ginger red", "strawberry blonde", "golden blonde", "platinum blonde", "silver grey", "white", "blue", "pink", "purple", "green", "ombre", "highlights", "balayage", "two-tone", "rainbow"],
            hair_length: ["bald", "buzz cut", "very short", "short", "ear length", "chin length", "shoulder length", "mid-back", "waist length", "very long"],
            expression: ["neutral", "smiling", "laughing", "serious", "contemplative", "surprised", "angry", "sad", "fearful", "determined", "curious", "peaceful", "intense", "playful", "mysterious", "confident", "relaxed", "candid", "gentle smile", "seductive", "stoic"],
            pose: ["standing", "sitting", "lying down", "walking", "running", "jumping", "dancing", "leaning", "crouching", "kneeling", "action pose", "relaxed", "formal pose", "candid", "profile view", "three-quarter view", "back view", "selfie pose", "hand on face", "arms crossed", "hands in pockets"],
            
            // Face & Makeup
            skin_type: ["fair", "light", "medium", "olive", "tan", "dark", "deep", "porcelain", "sun-kissed", "freckled", "clear", "textured", "glowing", "matte"],
            makeup_style: ["no makeup", "natural minimal", "clean girl aesthetic", "soft glam", "full glam", "smoky eye", "bold lip", "editorial", "avant-garde", "vintage", "korean beauty", "dewy skin", "matte finish", "bronzed", "rosy blush", "glossy lips", "graphic liner"],
            
            // Accessories
            eyewear: ["none", "prescription glasses", "round glasses", "square glasses", "cat eye glasses", "aviator glasses", "reading glasses", "tortoise shell frames", "wire frame glasses", "sunglasses", "aviator sunglasses", "wayfarers", "oversized sunglasses", "sport sunglasses", "mirrored sunglasses"],
            earrings: ["none", "stud earrings", "small hoops", "large hoops", "drop earrings", "chandelier earrings", "pearl earrings", "diamond studs", "huggie hoops", "ear cuffs", "ear stack", "tassel earrings", "statement earrings", "gold hoops", "silver hoops"],
            necklace: ["none", "thin chain", "pendant necklace", "choker", "layered chains", "statement necklace", "pearl necklace", "locket", "collar necklace", "beaded necklace", "charm necklace", "tennis necklace", "cross pendant", "nameplate", "dainty gold chain"],
            bracelet: ["none", "chain bracelet", "bangle", "cuff bracelet", "charm bracelet", "beaded bracelet", "watch", "tennis bracelet", "leather wrap", "friendship bracelet", "smart watch", "luxury watch"],
            rings: ["none", "wedding band", "engagement ring", "statement ring", "stackable rings", "signet ring", "class ring", "cocktail ring", "thin gold band", "silver band", "multiple rings"],
            headwear: ["none", "baseball cap", "beanie", "fedora", "bucket hat", "sun hat", "beret", "headband", "hair clips", "tiara", "crown", "veil", "turban", "bandana", "visor"],
            
            // Technical
            camera_type: ["Canon 5D Mark IV", "Nikon D850", "Sony A7R IV", "Hasselblad H6D", "Leica M10", "Fujifilm GFX", "Phase One", "iPhone 15 Pro", "vintage Polaroid", "Kodak Brownie", "35mm film camera", "medium format", "large format 4x5", "drone camera", "GoPro action cam", "ARRI cinema camera", "RED cinema camera", "vintage Rolleiflex"],
            camera_angle: ["eye level", "low angle", "high angle", "bird's eye", "worm's eye", "dutch angle", "over the shoulder", "close-up", "extreme close-up", "wide shot", "medium shot", "full body shot", "cowboy shot", "POV shot"],
            camera_settings: ["shallow depth of field", "deep focus", "bokeh", "motion blur", "long exposure", "tilt-shift", "fish-eye", "macro", "telephoto compression", "wide angle distortion", "f/1.4 aperture", "f/8 aperture", "fast shutter", "slow shutter"],
            composition: ["rule of thirds", "centered", "symmetrical", "leading lines", "framing", "negative space", "golden ratio", "diagonal", "layered", "minimalist", "fill the frame", "patterns", "juxtaposition", "foreground interest"],
            film_type: ["digital", "Kodak Portra 400", "Kodak Ektar 100", "Fujifilm Pro 400H", "Ilford HP5", "Kodak Tri-X", "Cinestill 800T", "Kodachrome", "Velvia 50", "instant film", "infrared film", "cross-processed"],
            aspect_ratio: ["1:1 square", "4:3 standard", "3:2 classic", "16:9 widescreen", "21:9 ultrawide", "2.39:1 anamorphic", "9:16 vertical", "4:5 instagram"],
            
            // Quality
            quality_modifiers: ["8K", "ultra detailed", "hyperrealistic", "masterpiece", "professional", "award-winning", "high resolution", "sharp focus", "intricate details", "photographic", "studio quality", "magazine cover", "editorial", "gallery quality"],
            render_style: ["photorealistic", "ray traced", "path traced", "physically based rendering", "unreal engine 5", "octane render", "cinema 4D", "V-Ray", "Arnold render", "real-time rendering"],
            
            // ==================== CONTEXTUAL OPTIONS ====================
            
            // Street Photography
            street_type: ["busy downtown", "quiet alley", "night market", "bazaar", "shopping district", "residential street", "historic district", "industrial area", "waterfront", "subway entrance", "bus stop", "crosswalk", "sidewalk cafe", "graffiti alley", "chinatown", "little italy"],
            geographic_region: ["tokyo japan", "new york usa", "paris france", "london uk", "istanbul turkey", "mumbai india", "rio brazil", "cairo egypt", "moscow russia", "sydney australia", "hong kong", "singapore", "dubai uae", "amsterdam netherlands", "rome italy", "barcelona spain", "berlin germany", "bangkok thailand", "seoul korea", "havana cuba", "marrakech morocco", "venice italy"],
            
            // Landscape
            landscape_type: ["mountain range", "ocean coastline", "rolling hills", "flat plains", "river valley", "volcanic", "glacial", "canyon", "waterfall", "lake reflection", "aurora borealis", "starry night sky", "sunrise panorama", "sunset silhouette", "stormy seascape", "misty forest", "autumn foliage", "spring bloom", "winter wonderland", "tropical paradise"],
            terrain: ["rocky", "sandy", "grassy", "muddy", "snowy", "icy", "volcanic rock", "coral reef", "sand dunes", "moss covered", "wildflower meadow", "bamboo forest", "pine forest", "jungle", "tundra", "savanna", "wetland", "cliff face", "cave entrance"],
            natural_elements: ["waterfall", "river", "lake", "ocean waves", "clouds", "fog", "rainbow", "lightning", "northern lights", "milky way", "full moon", "shooting stars", "sun rays", "reflections", "mist", "dew drops", "frost", "icicles", "autumn leaves", "cherry blossoms"],
            
            // Portrait
            ethnicity: ["caucasian", "african", "east asian", "south asian", "middle eastern", "latin american", "native american", "pacific islander", "mixed ethnicity", "nordic", "mediterranean", "slavic"],
            body_type: ["slim", "athletic", "muscular", "average", "curvy", "plus size", "petite", "tall", "model physique"],
            gender: ["female", "male", "androgynous", "non-binary"],
            
            // Architecture
            building_type: ["skyscraper", "cathedral", "mosque", "temple", "palace", "castle", "mansion", "cottage", "apartment building", "office tower", "factory", "warehouse", "bridge", "tower", "monument", "museum", "theater", "stadium", "train station", "airport", "lighthouse", "windmill"],
            arch_style: ["art deco", "art nouveau", "bauhaus", "brutalist", "classical", "colonial", "contemporary", "deconstructivist", "futuristic", "gothic", "high-tech", "islamic", "japanese", "minimalist", "modernist", "neoclassical", "organic", "postmodern", "renaissance", "romanesque", "victorian"],
            arch_era: ["ancient", "medieval", "renaissance", "baroque", "industrial revolution", "early 20th century", "mid-century modern", "1980s postmodern", "contemporary", "futuristic concept"],
            
            // Food
            cuisine_type: ["french", "italian", "japanese", "chinese", "indian", "mexican", "thai", "korean", "turkish", "greek", "spanish", "american", "middle eastern", "vietnamese", "brazilian", "moroccan", "ethiopian", "peruvian", "fusion"],
            food_style: ["fine dining", "street food", "comfort food", "healthy", "vegan", "raw", "grilled", "fried", "baked", "dessert", "breakfast", "brunch", "appetizer", "main course", "tapas", "sushi", "pastry", "cocktails"],
            plating: ["minimalist plating", "rustic presentation", "fine dining arrangement", "deconstructed", "stacked", "scattered", "circular", "linear", "artistic drizzle", "garnished", "family style", "bento box", "tapas plates", "cheese board"],
            
            // Fashion
            fashion_category: ["haute couture", "ready-to-wear", "streetwear", "sportswear", "evening wear", "bridal", "swimwear", "lingerie", "outerwear", "accessories", "footwear", "jewelry", "eyewear", "bags", "menswear", "womenswear", "unisex", "kids fashion"],
            fashion_season: ["spring/summer", "fall/winter", "resort", "pre-fall", "cruise collection", "holiday collection"],
            fashion_brand_style: ["luxury minimalist", "avant-garde", "bohemian chic", "urban street", "preppy classic", "romantic feminine", "edgy punk", "sporty athleisure", "vintage inspired", "sustainable eco", "maximalist bold", "androgynous"],
            
            // Wildlife
            animal_type: ["big cat", "elephant", "bear", "wolf", "deer", "horse", "bird of prey", "songbird", "parrot", "penguin", "whale", "dolphin", "shark", "sea turtle", "octopus", "butterfly", "bee", "spider", "snake", "lizard", "frog", "primate", "fox", "rabbit"],
            habitat: ["african savanna", "amazon rainforest", "arctic tundra", "coral reef", "deep ocean", "mountain peak", "temperate forest", "desert", "wetlands", "grasslands", "bamboo forest", "mangrove", "cave", "urban environment"],
            animal_behavior: ["hunting", "resting", "playing", "feeding", "migrating", "mating display", "caring for young", "swimming", "flying", "running", "climbing", "camouflaged", "alert", "sleeping"],
            
            // Product
            product_type: ["electronics", "cosmetics", "jewelry", "watch", "perfume", "shoes", "bags", "furniture", "kitchenware", "tech gadgets", "automotive", "sports equipment", "musical instruments", "books", "beverages", "skincare", "eyewear"],
            product_material: ["metal", "glass", "wood", "leather", "fabric", "plastic", "ceramic", "stone", "crystal", "gold", "silver", "rose gold", "matte black", "brushed aluminum", "carbon fiber", "marble"],
            product_background: ["white seamless", "black seamless", "gradient", "textured surface", "marble slab", "wooden table", "concrete", "fabric backdrop", "nature setting", "lifestyle context", "reflective surface", "floating", "hanging", "studio setup"],
            
            // ==================== ADVANCED EXPRESSION OPTIONS ====================
            
            // Eye Expression
            eye_look: ["alluring", "playful", "intense", "soft", "dreamy", "piercing", "innocent", "seductive", "mysterious", "confident", "shy", "bold", "gentle", "fierce", "warm", "cold", "inviting", "distant"],
            eye_energy: ["confident", "direct", "subtle", "powerful", "calm", "energetic", "focused", "relaxed", "intense", "gentle", "magnetic", "hypnotic"],
            eye_direction: ["looking at viewer", "looking away", "looking up", "looking down", "side glance", "closed eyes", "half-closed", "upward gaze", "downward gaze", "distant gaze"],
            
            // Mouth Expression
            mouth_position: ["blowing a kiss", "pouting", "slight smile", "wide smile", "lips parted", "closed lips", "smirking", "pursed lips", "open mouth", "biting lip", "tongue out", "neutral"],
            mouth_energy: ["chic", "charming", "sensual", "innocent", "playful", "serious", "mysterious", "warm", "inviting", "reserved"],
            
            // Face Features
            face_features: ["high nose bridge", "double eyelids", "defined jawline", "high cheekbones", "soft features", "angular features", "button nose", "full lips", "thin lips", "strong brow", "delicate features", "symmetric face"],
            
            // Hair Effects
            hair_effect: ["realistic shine", "wind-blown", "wet look", "silky smooth", "natural texture", "voluminous", "sleek", "tousled", "flowing movement", "static", "backlit glow", "sun-kissed highlights"],
            
            // ==================== ADVANCED BODY OPTIONS ====================
            
            body_frame: ["petite", "small", "medium", "tall", "proportionally realistic", "elongated", "compact"],
            body_definition: ["defined waist", "athletic build", "soft curves", "toned", "slender", "muscular definition", "natural"],
            
            // Skin Details
            skin_visible_areas: ["face only", "face and hands", "face and neck", "upper body", "full body", "partial"],
            skin_tone: ["fair", "light", "medium", "olive", "tan", "dark", "deep", "porcelain", "sun-kissed", "fair caucasian", "warm undertone", "cool undertone", "neutral undertone"],
            skin_texture: ["ultra-realistic", "visible pores", "natural imperfections", "smooth", "flawless", "textured", "dewy", "matte", "glowing", "natural skin texture"],
            skin_lighting_effect: ["soft daylight", "warm glow", "cool tones", "dramatic shadows", "rim light", "diffused", "natural ambient", "studio lighting", "golden hour glow"],
            
            // ==================== ADVANCED POSE OPTIONS ====================
            
            pose_position: ["standing", "sitting", "lying", "crouching", "leaning", "emerging", "stepping out", "floating", "suspended", "dynamic"],
            pose_base: ["static", "dynamic", "fluid", "rigid", "relaxed", "tense", "graceful", "powerful"],
            pose_energy: ["energetic", "calm", "powerful", "delicate", "confident", "shy", "bold", "subtle", "vibrant", "serene"],
            
            // ==================== ADVANCED CLOTHING OPTIONS ====================
            
            clothing_effect: ["high-quality textile", "realistic fabric texture", "designer quality", "couture finish", "vintage texture", "modern crisp", "soft drape", "structured"],
            clothing_details: ["visible stitching", "brand details", "texture emphasis", "material contrast", "layered look", "minimalist", "ornate details"],
            
            // ==================== PHOTOGRAPHY ADVANCED OPTIONS ====================
            
            camera_style: ["DSLR photography", "mirrorless", "medium format", "large format", "smartphone", "instant camera", "film camera", "cinema camera", "macro lens", "telephoto", "wide angle"],
            shot_type: ["composite photography", "portrait", "fashion editorial", "street photography", "studio shot", "environmental portrait", "conceptual", "documentary", "fine art"],
            photo_texture: ["sharp pixels", "film grain", "clean digital", "vintage grain", "noise texture", "smooth gradient", "high detail", "soft focus areas"],
            depth_of_field: ["shallow DOF", "deep focus", "selective focus", "bokeh background", "tilt-shift", "everything sharp", "foreground blur", "background blur"],
            
            // ==================== BACKGROUND ADVANCED OPTIONS ====================
            
            background_elements: ["park bench", "street lamp", "trees", "buildings", "water feature", "furniture", "vehicles", "signage", "natural elements", "architectural details", "props"],
            background_atmosphere: ["cinematic", "realistic", "dreamy", "moody", "bright", "dark", "misty", "clear", "hazy", "vibrant"],
            
            // ==================== VIBE & AESTHETIC OPTIONS ====================
            
            vibe_energy: ["sophisticated", "viral", "edgy", "classic", "modern", "retro", "futuristic", "organic", "minimal", "maximal", "luxurious", "casual"],
            vibe_aesthetic: ["OOTD breakdown", "fashion forward", "street style", "editorial", "lifestyle", "artistic", "commercial", "avant-garde", "minimalist", "maximalist"],
            vibe_authenticity: ["photorealistic", "hyper-realistic", "stylized", "artistic interpretation", "documentary style", "candid feel", "posed perfection"],
            vibe_intimacy: ["POV", "voyeuristic", "direct engagement", "distant observation", "intimate close-up", "environmental context"],
            
            // ==================== DEVICE & PROP OPTIONS ====================
            
            device_type: ["smartphone", "tablet", "laptop", "camera", "vintage camera", "polaroid", "mirror", "frame", "screen", "monitor"],
            device_details: ["active screen", "camera UI visible", "app interface", "blank screen", "reflection", "cracked screen", "pristine condition"],
            prop_type: ["text overlay", "annotation arrows", "handwritten notes", "stickers", "frames", "borders", "UI elements", "graphic elements"],
            
            // ==================== OPTICAL ILLUSION OPTIONS ====================
            
            illusion_type: ["pop-out effect", "breaking frame", "3D emergence", "depth illusion", "perspective trick", "mirror illusion", "screen escape", "dimensional break"],
            illusion_device: ["smartphone screen", "tablet screen", "photo frame", "mirror", "window", "portal", "canvas", "magazine page"]
        };

        // Default negative prompts (built-in)
        const DEFAULT_NEGATIVE_TAGS = [
            "blurry", "low quality", "distorted", "deformed", "ugly", 
            "bad anatomy", "bad proportions", "duplicate", "watermark", 
            "signature", "text", "logo", "cropped", "out of frame",
            "worst quality", "jpeg artifacts", "mutation", "extra limbs"
        ];

        // ==================== STATE ====================
        let currentLang = 'en';
        
        // Multi-person state
        let personCount = 1;
        let personsData = [{}]; // Array of person data objects
        
        // Objects state
        let sceneObjects = [];
        
        // Relationships state
        let semanticRelationships = [];
        
        // Custom fields state: { sectionName: [{ name, label, type, options }] }
        function loadCustomFields() {
            try {
                const saved = localStorage.getItem('customFields');
                return saved ? JSON.parse(saved) : {};
            } catch (e) {
                console.error('Error loading custom fields:', e);
                return {};
            }
        }
        
        function saveCustomFields() {
            try {
                localStorage.setItem('customFields', JSON.stringify(customFields));
            } catch (e) {
                console.error('Error saving custom fields:', e);
            }
        }
        
        let customFields = loadCustomFields();
        
        // Negative prompts state: { tag: boolean (selected or not), isCustom: boolean }
        let negativePrompts = loadNegativePrompts();
        
        function loadNegativePrompts() {
            const saved = localStorage.getItem('negativePrompts');
            if (saved) {
                return JSON.parse(saved);
            }
            // Initialize with defaults (all selected)
            const defaults = {};
            DEFAULT_NEGATIVE_TAGS.forEach(tag => {
                defaults[tag] = { selected: true, isCustom: false };
            });
            return defaults;
        }
        
        function saveNegativePrompts() {
            localStorage.setItem('negativePrompts', JSON.stringify(negativePrompts));
        }
        
        function getSelectedNegativePrompts() {
            return Object.entries(negativePrompts)
                .filter(([_, data]) => data.selected)
                .map(([tag, _]) => tag);
        }
        
        function renderNegativeTags() {
            const container = document.getElementById('negativeTagsContainer');
            container.innerHTML = '';
            
            Object.entries(negativePrompts).forEach(([tag, data]) => {
                const tagEl = document.createElement('div');
                tagEl.className = `negative-tag ${data.selected ? 'selected' : ''} ${data.isCustom ? 'custom' : ''}`;
                tagEl.innerHTML = `
                    <span class="tag-text">${tag}</span>
                    <span class="remove-tag" onclick="event.stopPropagation(); removeTag('${tag}')">√ó</span>
                `;
                tagEl.onclick = () => toggleTag(tag);
                container.appendChild(tagEl);
            });
        }
        
        function toggleTag(tag) {
            if (negativePrompts[tag]) {
                negativePrompts[tag].selected = !negativePrompts[tag].selected;
                saveNegativePrompts();
                renderNegativeTags();
            }
        }
        
        function addCustomTag() {
            const input = document.getElementById('newTagInput');
            const tag = input.value.trim().toLowerCase();
            
            if (tag && !negativePrompts[tag]) {
                negativePrompts[tag] = { selected: true, isCustom: true };
                saveNegativePrompts();
                renderNegativeTags();
                input.value = '';
            }
        }
        
        function removeTag(tag) {
            if (negativePrompts[tag] && negativePrompts[tag].isCustom) {
                delete negativePrompts[tag];
                saveNegativePrompts();
                renderNegativeTags();
            }
        }

        // ==================== RESET ALL FIELDS ====================
        
        // Complete reset of all form fields and states
        function resetAllFields() {
            // 1. Reset the form
            document.getElementById('promptForm').reset();
            
            // 2. Clear ALL multi-select states
            Object.keys(multiSelectState).forEach(key => {
                multiSelectState[key] = [];
            });
            
            // 3. Clear all custom input values
            document.querySelectorAll('.custom-input').forEach(input => {
                input.value = '';
            });
            
            // 4. Clear all text inputs and textareas
            document.querySelectorAll('#promptForm textarea, #promptForm input[type="text"]').forEach(el => {
                el.value = '';
            });
            
            // 5. Reset scene objects
            sceneObjects = [];
            renderObjects();
            
            // 6. Reset semantic relationships
            semanticRelationships = [];
            renderRelationships();
            
            // 7. Reset person data
            includePeople = false;
            peopleType = 'specific';
            personCount = 1;
            personsData = [{}];
            const checkbox = document.getElementById('includePeopleCheckbox');
            if (checkbox) checkbox.checked = false;
            const peopleContainer = document.getElementById('peopleOptionsContainer');
            if (peopleContainer) peopleContainer.style.display = 'none';
            
            // 8. Hide contextual options
            const contextualContainer = document.getElementById('contextualOptions');
            if (contextualContainer) contextualContainer.style.display = 'none';
            document.querySelectorAll('.context-option').forEach(opt => {
                opt.style.display = 'none';
            });
            
            // 9. Re-render all multi-selects to show empty state
            document.querySelectorAll('.multi-select-wrapper').forEach(wrapper => {
                const selectName = wrapper.dataset.multiselect;
                const optionKey = wrapper.dataset.options;
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
            });
        }

        // ==================== CUSTOM PRESETS CRUD ====================
        
        // Load custom presets from localStorage
        function loadCustomPresets() {
            const saved = localStorage.getItem('customPresets');
            return saved ? JSON.parse(saved) : [];
        }
        
        // Save custom presets to localStorage
        function saveCustomPresetsToStorage(presets) {
            localStorage.setItem('customPresets', JSON.stringify(presets));
        }
        
        // Render custom presets in the UI
        function renderCustomPresets() {
            const container = document.getElementById('customPresetsContainer');
            const presets = loadCustomPresets();
            const t = translations[currentLang];
            
            if (presets.length === 0) {
                container.innerHTML = `<span class="text-xs" style="color: var(--text-secondary);" data-i18n="no_presets">${t.no_presets}</span>`;
                return;
            }
            
            container.innerHTML = presets.map(preset => `
                <div class="custom-preset-item" onclick="loadCustomPreset('${preset.id}')">
                    <span class="preset-name">üé® ${preset.name}</span>
                    <div class="preset-actions">
                        <button class="preset-action-btn" onclick="event.stopPropagation(); openEditPresetModal('${preset.id}')" title="D√ºzenle">‚úèÔ∏è</button>
                        <button class="preset-action-btn delete" onclick="event.stopPropagation(); openDeletePresetModal('${preset.id}')" title="Sil">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Get current form data as preset data
        function getCurrentFormData() {
            const form = document.getElementById('promptForm');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                if (value) data[key] = value;
            });
            
            // Get current subject type to filter contextual fields
            const currentSubjectTypes = multiSelectState['subject_type'] || [];
            const currentSubjectType = currentSubjectTypes[0] || '';
            const relevantContextFields = contextualFieldsMap[currentSubjectType] || [];
            
            // Include multi-select values, filtering out irrelevant contextual fields
            Object.keys(multiSelectState).forEach(key => {
                if (multiSelectState[key] && multiSelectState[key].length > 0) {
                    // Skip contextual fields that don't belong to current subject type
                    if (allContextualFields.includes(key) && !relevantContextFields.includes(key)) {
                        return; // Skip this field
                    }
                    data[key + '_multi'] = multiSelectState[key];
                }
            });
            // Include multi-person data
            if (includePeople && peopleType === 'specific' && personsData.length > 0) {
                data.persons = personsData;
                data.person_count = personCount;
            }
            // Include custom fields configuration (so they can be restored)
            if (Object.keys(customFields).length > 0) {
                data._customFieldsConfig = customFields;
            }
            // Include scene objects
            if (sceneObjects.length > 0) {
                data._sceneObjects = sceneObjects;
            }
            // Include semantic relationships
            if (semanticRelationships.length > 0) {
                data._semanticRelationships = semanticRelationships;
            }
            return data;
        }
        
        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Open save preset modal
        function openSavePresetModal() {
            document.getElementById('presetNameInput').value = '';
            openModal('savePresetModal');
            document.getElementById('presetNameInput').focus();
        }
        
        // Save new custom preset
        function saveCustomPreset() {
            const name = document.getElementById('presetNameInput').value.trim();
            if (!name) {
                alert('Please enter a name');
                return;
            }
            
            const presets = loadCustomPresets();
            const newPreset = {
                id: Date.now().toString(),
                name: name,
                data: getCurrentFormData(),
                createdAt: new Date().toISOString()
            };
            
            presets.push(newPreset);
            saveCustomPresetsToStorage(presets);
            renderCustomPresets();
            closeModal('savePresetModal');
            
            // Show success notification
            showNotification(translations[currentLang].preset_saved);
        }
        
        // Load custom preset
        function loadCustomPreset(presetId) {
            const presets = loadCustomPresets();
            const preset = presets.find(p => p.id === presetId);
            
            if (!preset) return;
            
            // Complete reset of all fields first
            resetAllFields();
            
            // Load custom fields configuration if present
            if (preset.data._customFieldsConfig) {
                Object.assign(customFields, preset.data._customFieldsConfig);
                saveCustomFields();
                renderAllCustomFields();
            }
            
            // Load preset data into form
            Object.entries(preset.data).forEach(([key, value]) => {
                if (key === '_customFieldsConfig' || key === 'persons' || key === 'person_count') return;
                
                if (key.endsWith('_multi')) {
                    // Handle multi-select arrays
                    const realKey = key.replace('_multi', '');
                    multiSelectState[realKey] = Array.isArray(value) ? value : [value];
                } else {
                    // For text inputs and custom fields
                    const element = document.querySelector(`textarea[name="${key}"], input[type="text"][name="${key}"], select[name="${key}"]`);
                    if (element) {
                        element.value = value;
                    }
                }
            });
            
            // Handle multi-person data
            if (preset.data.persons && preset.data.persons.length > 0) {
                includePeople = true;
                peopleType = 'specific';
                personCount = preset.data.person_count || preset.data.persons.length;
                personsData = preset.data.persons.map(p => ({...p}));
                
                const checkbox = document.getElementById('includePeopleCheckbox');
                if (checkbox) checkbox.checked = true;
                const container = document.getElementById('peopleOptionsContainer');
                if (container) container.style.display = 'block';
                document.getElementById('specificPeopleContainer').style.display = 'block';
                document.getElementById('crowdTypeContainer').style.display = 'none';
                
                document.querySelectorAll('.person-count-btn').forEach((btn, idx) => {
                    btn.classList.toggle('active', idx + 1 === personCount || (personCount >= 4 && idx === 3));
                });
                
                setTimeout(() => renderPersonPanels(), 100);
            }
            
            // Load scene objects
            if (preset.data._sceneObjects && preset.data._sceneObjects.length > 0) {
                sceneObjects = preset.data._sceneObjects.map(obj => ({...obj}));
                renderObjects();
            } else {
                sceneObjects = [];
                renderObjects();
            }
            
            // Load semantic relationships
            if (preset.data._semanticRelationships && preset.data._semanticRelationships.length > 0) {
                semanticRelationships = preset.data._semanticRelationships
                    .map(normalizeSemanticRelationship)
                    .filter(rel => rel);
                renderRelationships();
            } else {
                semanticRelationships = [];
                renderRelationships();
            }
            
            // Re-render all multi-selects
            document.querySelectorAll('.multi-select-wrapper').forEach(wrapper => {
                const selectName = wrapper.dataset.multiselect;
                const optionKey = wrapper.dataset.options;
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
            });
            
            // Update contextual options based on loaded subject_type
            updateContextualOptions();
            
            showNotification(`Preset loaded: ${preset.name}`);
        }
        
        // Open edit preset modal
        function openEditPresetModal(presetId) {
            const presets = loadCustomPresets();
            const preset = presets.find(p => p.id === presetId);
            
            if (!preset) return;
            
            document.getElementById('editPresetId').value = presetId;
            document.getElementById('editPresetNameInput').value = preset.name;
            openModal('editPresetModal');
            document.getElementById('editPresetNameInput').focus();
        }
        
        // Update custom preset
        function updateCustomPreset() {
            const presetId = document.getElementById('editPresetId').value;
            const newName = document.getElementById('editPresetNameInput').value.trim();
            
            if (!newName) {
                alert('L√ºtfen bir isim girin');
                return;
            }
            
            const presets = loadCustomPresets();
            const presetIndex = presets.findIndex(p => p.id === presetId);
            
            if (presetIndex === -1) return;
            
            // Update name and data
            presets[presetIndex].name = newName;
            presets[presetIndex].data = getCurrentFormData();
            presets[presetIndex].updatedAt = new Date().toISOString();
            
            saveCustomPresetsToStorage(presets);
            renderCustomPresets();
            closeModal('editPresetModal');
            
            showNotification(translations[currentLang].preset_updated);
        }
        
        // Open delete confirmation modal
        function openDeletePresetModal(presetId) {
            document.getElementById('deletePresetId').value = presetId;
            openModal('deletePresetModal');
        }
        
        // Confirm delete preset
        function confirmDeletePreset() {
            const presetId = document.getElementById('deletePresetId').value;
            const presets = loadCustomPresets();
            const filteredPresets = presets.filter(p => p.id !== presetId);
            
            saveCustomPresetsToStorage(filteredPresets);
            renderCustomPresets();
            closeModal('deletePresetModal');
            
            showNotification(translations[currentLang].preset_deleted);
        }
        
        // Show notification toast
        function showNotification(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--primary);
                color: #fff;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1001;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }
        
        // Export presets to JSON file
        function exportPresets() {
            const presets = loadCustomPresets();
            if (presets.length === 0) {
                showNotification(translations[currentLang].no_presets || 'No presets to export');
                return;
            }
            
            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                presets: presets
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `photo-prompt-presets-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(translations[currentLang].presets_exported || 'Presets exported!');
        }
        
        // Import presets from JSON file
        function importPresets(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    // Validate the import data
                    if (!importData.presets || !Array.isArray(importData.presets)) {
                        throw new Error('Invalid format');
                    }
                    
                    // Get existing presets
                    const existingPresets = loadCustomPresets();
                    
                    // Merge presets (avoid duplicates by name or ID)
                    const mergedPresets = [...existingPresets];
                    const existingIds = new Set(existingPresets.map(p => p.id));
                    const existingNames = new Set(existingPresets.map(p => p.name.toLowerCase()));
                    
                    let skipped = 0;
                    importData.presets.forEach(preset => {
                        // Skip if preset with same name already exists
                        if (existingNames.has(preset.name.toLowerCase())) {
                            skipped++;
                            return;
                        }
                        // Generate new ID if ID already exists
                        if (existingIds.has(preset.id)) {
                            preset.id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                        }
                        mergedPresets.push(preset);
                        existingNames.add(preset.name.toLowerCase());
                        existingIds.add(preset.id);
                    });
                    
                    // Save merged presets
                    saveCustomPresetsToStorage(mergedPresets);
                    renderCustomPresets();
                    
                    showNotification(translations[currentLang].presets_imported || 'Presets imported!');
                } catch (error) {
                    console.error('Import error:', error);
                    showNotification(translations[currentLang].import_error || 'Import error. Invalid file format.');
                }
            };
            
            reader.readAsText(file);
            // Reset file input so same file can be imported again
            event.target.value = '';
        }

        // ==================== CUSTOM FIELDS SUPPORT ====================
        
        let currentCustomFieldSection = '';
        
        function openCustomFieldModal(sectionName) {
            currentCustomFieldSection = sectionName;
            document.getElementById('customFieldModal').classList.add('active');
            document.getElementById('customFieldName').value = '';
            document.getElementById('customFieldLabel').value = '';
            document.getElementById('customFieldType').value = 'text';
            document.getElementById('customFieldOptionsContainer').style.display = 'none';
            document.getElementById('customFieldOptions').value = '';
        }
        
        function closeCustomFieldModal() {
            document.getElementById('customFieldModal').classList.remove('active');
        }
        
        function toggleCustomFieldOptions() {
            const type = document.getElementById('customFieldType').value;
            document.getElementById('customFieldOptionsContainer').style.display = 
                type === 'select' ? 'block' : 'none';
        }
        
        function saveNewCustomField() {
            const name = document.getElementById('customFieldName').value.trim().toLowerCase().replace(/\s+/g, '_');
            const label = document.getElementById('customFieldLabel').value.trim();
            const type = document.getElementById('customFieldType').value;
            const optionsStr = document.getElementById('customFieldOptions').value.trim();
            
            if (!name || !label) {
                showNotification('Please fill in field name and label', 'error');
                return;
            }
            
            if (!customFields[currentCustomFieldSection]) {
                customFields[currentCustomFieldSection] = [];
            }
            
            // Check for duplicate
            if (customFields[currentCustomFieldSection].some(f => f.name === name)) {
                showNotification('A field with this name already exists', 'error');
                return;
            }
            
            const field = { name, label, type };
            if (type === 'select' && optionsStr) {
                field.options = optionsStr.split(',').map(o => o.trim()).filter(o => o);
            }
            
            customFields[currentCustomFieldSection].push(field);
            saveCustomFields();
            renderCustomFieldsForSection(currentCustomFieldSection);
            closeCustomFieldModal();
            showNotification(`Custom field "${label}" added!`);
        }
        
        function removeCustomField(sectionName, fieldName) {
            if (!customFields[sectionName]) return;
            customFields[sectionName] = customFields[sectionName].filter(f => f.name !== fieldName);
            saveCustomFields();
            renderCustomFieldsForSection(sectionName);
            showNotification('Custom field removed');
        }
        
        function renderCustomFieldsForSection(sectionName) {
            const container = document.getElementById(`customFields_${sectionName}`);
            if (!container) return;
            
            const fields = customFields[sectionName] || [];
            
            if (fields.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = fields.map(field => `
                <div class="form-group custom-field-item" style="position: relative;">
                    <label class="form-label">${field.label}
                        <button type="button" onclick="removeCustomField('${sectionName}', '${field.name}')" 
                            class="remove-custom-field-btn" title="Remove field">√ó</button>
                    </label>
                    ${field.type === 'select' && field.options ? `
                        <select name="${field.name}" class="input-field w-full px-4 py-3">
                            <option value="">Select...</option>
                            ${field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                        </select>
                    ` : `
                        <input type="text" name="${field.name}" 
                            class="input-field w-full px-4 py-3" placeholder="Enter ${field.label.toLowerCase()}...">
                    `}
                </div>
            `).join('');
        }
        
        function renderAllCustomFields() {
            const sections = ['subject', 'people', 'era', 'environment', 'atmosphere', 'character', 'hair', 'face', 'accessories', 'technical', 'quality'];
            sections.forEach(section => renderCustomFieldsForSection(section));
        }

        // ==================== OBJECTS & RELATIONSHIPS ====================
        
        // Object categories for dropdown
        const OBJECT_CATEGORIES = [
            'Person', 'Body Part', 'Clothing', 'Accessory', 'Electronics', 
            'Furniture', 'Vehicle', 'Food/Drink', 'Plant', 'Animal', 
            'Building', 'Nature', 'Sports Equipment', 'Musical Instrument',
            'Art/Decor', 'Tool', 'Book/Document', 'Container', 'Other'
        ];
        
        // Object locations for dropdown
        const OBJECT_LOCATIONS = [
            'Center', 'Left', 'Right', 'Top', 'Bottom',
            'Top-Left', 'Top-Right', 'Bottom-Left', 'Bottom-Right',
            'Foreground', 'Mid-ground', 'Background'
        ];
        
        // Object prominence levels
        const OBJECT_PROMINENCE = [
            'Primary Focus', 'Secondary', 'Background Element', 'Detail/Accent'
        ];
        
        function addObject() {
            const newObject = {
                id: 'obj_' + Date.now(),
                label: '',
                category: '',
                location: '',
                prominence: '',
                color: '',
                texture: '',
                material: '',
                state: '',
                details: ''
            };
            sceneObjects.push(newObject);
            renderObjects();
        }
        
        function removeObject(index) {
            sceneObjects.splice(index, 1);
            renderObjects();
        }
        
        function updateObject(index, field, value) {
            if (sceneObjects[index]) {
                sceneObjects[index][field] = value;
            }
        }
        
        function renderObjects() {
            const container = document.getElementById('objectsContainer');
            if (!container) return;
            
            if (sceneObjects.length === 0) {
                container.innerHTML = '<p style="font-size: 12px; color: var(--text-secondary); font-style: italic;">No objects added yet.</p>';
                return;
            }
            
            container.innerHTML = sceneObjects.map((obj, idx) => `
                <div class="object-panel" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="font-weight: 600; font-size: 12px;">üéØ Object ${idx + 1}</span>
                        <button type="button" onclick="removeObject(${idx})" style="background: none; border: none; color: var(--danger); cursor: pointer; font-size: 16px;">√ó</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
                        <div class="form-group">
                            <label class="form-label" style="font-size: 10px;">Label *</label>
                            <input type="text" class="input-field w-full px-2 py-1" style="font-size: 11px;" 
                                placeholder="e.g., Coffee Cup" value="${obj.label || ''}"
                                onchange="updateObject(${idx}, 'label', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 10px;">Category</label>
                            <select class="input-field w-full px-2 py-1" style="font-size: 11px;"
                                onchange="updateObject(${idx}, 'category', this.value)">
                                <option value="">Select...</option>
                                ${OBJECT_CATEGORIES.map(cat => `<option value="${cat}" ${obj.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 10px;">Location</label>
                            <select class="input-field w-full px-2 py-1" style="font-size: 11px;"
                                onchange="updateObject(${idx}, 'location', this.value)">
                                <option value="">Select...</option>
                                ${OBJECT_LOCATIONS.map(loc => `<option value="${loc}" ${obj.location === loc ? 'selected' : ''}>${loc}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 10px;">Prominence</label>
                            <select class="input-field w-full px-2 py-1" style="font-size: 11px;"
                                onchange="updateObject(${idx}, 'prominence', this.value)">
                                <option value="">Select...</option>
                                ${OBJECT_PROMINENCE.map(p => `<option value="${p}" ${obj.prominence === p ? 'selected' : ''}>${p}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-2 mt-2">
                        <div class="form-group">
                            <label class="form-label" style="font-size: 10px;">Color</label>
                            <input type="text" class="input-field w-full px-2 py-1" style="font-size: 11px;" 
                                placeholder="e.g., White, Metallic" value="${obj.color || ''}"
                                onchange="updateObject(${idx}, 'color', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 10px;">Texture</label>
                            <input type="text" class="input-field w-full px-2 py-1" style="font-size: 11px;" 
                                placeholder="e.g., Smooth, Rough" value="${obj.texture || ''}"
                                onchange="updateObject(${idx}, 'texture', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 10px;">Material</label>
                            <input type="text" class="input-field w-full px-2 py-1" style="font-size: 11px;" 
                                placeholder="e.g., Ceramic, Metal" value="${obj.material || ''}"
                                onchange="updateObject(${idx}, 'material', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 10px;">State</label>
                            <input type="text" class="input-field w-full px-2 py-1" style="font-size: 11px;" 
                                placeholder="e.g., Hot, Worn, New" value="${obj.state || ''}"
                                onchange="updateObject(${idx}, 'state', this.value)">
                        </div>
                    </div>
                    <div class="form-group mt-2">
                        <label class="form-label" style="font-size: 10px;">Micro Details</label>
                        <input type="text" class="input-field w-full px-2 py-1" style="font-size: 11px;" 
                            placeholder="e.g., Steam rising, scratches on surface, brand logo visible" value="${obj.details || ''}"
                            onchange="updateObject(${idx}, 'details', this.value)">
                    </div>
                </div>
            `).join('');
        }
        
        // Relationships functions
        function normalizeSemanticRelationship(rel) {
            if (!rel) return '';
            if (typeof rel === 'string') return rel.trim();
            if (typeof rel === 'object') {
                const subject = (rel.subject || '').toString().trim();
                const action = (rel.action || '').toString().trim();
                const object = (rel.object || '').toString().trim();
                return [subject, action, object].filter(Boolean).join(' ').trim();
            }
            return '';
        }

        function addRelationship() {
            const input = document.getElementById('newRelationshipInput');
            const value = input.value.trim();
            if (value) {
                semanticRelationships.push(value);
                input.value = '';
                renderRelationships();
            }
        }
        
        function removeRelationship(index) {
            semanticRelationships.splice(index, 1);
            renderRelationships();
        }
        
        function renderRelationships() {
            const container = document.getElementById('relationshipsContainer');
            if (!container) return;
            
            if (semanticRelationships.length === 0) {
                container.innerHTML = '<p style="font-size: 12px; color: var(--text-secondary); font-style: italic;">No relationships defined yet.</p>';
                return;
            }
            
            container.innerHTML = semanticRelationships.map((rel, idx) => `
                <div style="display: flex; align-items: center; gap: 8px; padding: 6px 10px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; margin-bottom: 4px;">
                    <span style="flex: 1; font-size: 12px;">üîó ${rel}</span>
                    <button type="button" onclick="removeRelationship(${idx})" style="background: none; border: none; color: var(--danger); cursor: pointer; font-size: 14px;">√ó</button>
                </div>
            `).join('');
        }

        // ==================== MULTI-PERSON SUPPORT ====================
        
        // State for people inclusion
        let includePeople = false;
        let peopleType = 'specific'; // 'specific' or 'crowd'
        
        // Toggle people section visibility
        function togglePeopleSection() {
            const checkbox = document.getElementById('includePeopleCheckbox');
            const container = document.getElementById('peopleOptionsContainer');
            includePeople = checkbox.checked;
            
            container.style.display = includePeople ? 'block' : 'none';
            
            if (includePeople) {
                togglePeopleType();
                renderPersonPanels();
            }
            
            // Hide/show character-related sections based on people settings
            updateCharacterSectionsVisibility();
        }
        
        // Toggle between specific people and crowd
        function togglePeopleType() {
            const select = document.getElementById('peopleTypeSelect');
            peopleType = select.value;
            
            const specificContainer = document.getElementById('specificPeopleContainer');
            const crowdContainer = document.getElementById('crowdTypeContainer');
            
            if (peopleType === 'specific') {
                specificContainer.style.display = 'block';
                crowdContainer.style.display = 'none';
                renderPersonPanels();
            } else {
                specificContainer.style.display = 'none';
                crowdContainer.style.display = 'block';
            }
            
            // Update visibility of character sections
            updateCharacterSectionsVisibility();
        }
        
        // Hide Character, Hair, Face, Accessories sections when specific people are used
        function updateCharacterSectionsVisibility() {
            const sections = ['characterSection', 'hairSection', 'faceSection', 'accessoriesSection'];
            const shouldHide = includePeople && peopleType === 'specific';
            
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    if (shouldHide) {
                        section.style.display = 'none';
                    } else {
                        section.style.display = 'block';
                    }
                }
            });
        }
        
        // Person property fields to include in each person panel
        const PERSON_FIELDS = [
            { name: 'gender', label: 'Gender', options: 'gender' },
            { name: 'ethnicity', label: 'Ethnicity', options: 'ethnicity' },
            { name: 'age_group', label: 'Age Group', options: 'age_group' },
            { name: 'body_type', label: 'Body Type', options: 'body_type' },
            { name: 'hair_style', label: 'Hair Style', options: 'hair_style' },
            { name: 'hair_color', label: 'Hair Color', options: 'hair_color' },
            { name: 'hair_length', label: 'Hair Length', options: 'hair_length' },
            { name: 'expression', label: 'Expression', options: 'expression' },
            { name: 'pose', label: 'Pose', options: 'pose' },
            { name: 'skin_type', label: 'Skin Type', options: 'skin_type' },
            { name: 'makeup_style', label: 'Makeup', options: 'makeup_style' },
            { name: 'clothing_style', label: 'Clothing Style', options: 'clothing_style' },
            { name: 'clothing_type', label: 'Clothing Type', options: 'clothing_type' },
            { name: 'clothing_color', label: 'Clothing Color', options: 'clothing_color' },
            { name: 'eyewear', label: 'Eyewear', options: 'eyewear' },
            { name: 'earrings', label: 'Earrings', options: 'earrings' },
            { name: 'necklace', label: 'Necklace', options: 'necklace' },
            { name: 'headwear', label: 'Headwear', options: 'headwear' }
        ];
        
        // Set person count and rebuild panels
        function setPersonCount(count) {
            personCount = count;
            
            // Update buttons
            document.querySelectorAll('.person-count-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', idx + 1 === count || (count >= 4 && idx === 3));
            });
            
            // Adjust personsData array
            while (personsData.length < count) {
                personsData.push({});
            }
            while (personsData.length > count) {
                personsData.pop();
            }
            
            renderPersonPanels();
        }
        
        // Render all person panels
        function renderPersonPanels() {
            const container = document.getElementById('multiPersonContainer');
            if (!container) return;
            
            const personLabels = ['Person 1 (Main Subject)', 'Person 2', 'Person 3', 'Person 4'];
            
            const panelHTML = personsData.map((personData, idx) => `
                <div class="person-panel" data-person-index="${idx}">
                    <div class="person-panel-header">
                        <span class="person-panel-title">üë§ ${personLabels[idx] || 'Person ' + (idx + 1)}</span>
                        ${idx > 0 ? `<button type="button" class="remove-person-btn" onclick="removePerson(${idx})" title="Remove Person">√ó</button>` : ''}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        ${PERSON_FIELDS.map(field => `
                            <div class="form-group">
                                <label class="form-label" style="font-size: 11px;">${field.label}</label>
                                <select name="person_${idx}_${field.name}" class="input-field w-full px-3 py-2" style="font-size: 12px;" 
                                    data-person="${idx}" data-field="${field.name}" onchange="updatePersonData(${idx}, '${field.name}', this.value)">
                                    <option value="">Select...</option>
                                    ${(promptOptions[field.options] || []).map(opt => 
                                        `<option value="${opt}" ${personData[field.name] === opt ? 'selected' : ''}>${opt}</option>`
                                    ).join('')}
                                </select>
                                <input type="text" class="custom-input" style="font-size: 11px; margin-top: 4px;" 
                                    placeholder="or custom value..." 
                                    data-person="${idx}" data-field="${field.name}"
                                    value="${personData[field.name + '_custom'] || ''}"
                                    onchange="updatePersonData(${idx}, '${field.name}_custom', this.value)">
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = panelHTML;
        }
        
        // Update person data when field changes
        function updatePersonData(personIndex, fieldName, value) {
            if (!personsData[personIndex]) {
                personsData[personIndex] = {};
            }
            personsData[personIndex][fieldName] = value;
        }
        
        // Remove a person
        function removePerson(index) {
            if (index > 0 && personsData.length > 1) {
                personsData.splice(index, 1);
                personCount = personsData.length;
                
                // Update buttons
                document.querySelectorAll('.person-count-btn').forEach((btn, idx) => {
                    btn.classList.toggle('active', idx + 1 === personCount || (personCount >= 4 && idx === 3));
                });
                
                renderPersonPanels();
            }
        }
        
        // Get combined person descriptions for prompt
        function getPersonDescriptions() {
            if (personsData.length === 0 || Object.keys(personsData[0]).length === 0) {
                return '';
            }
            
            // Helper to get value (prefer custom if exists)
            const getValue = (person, field) => person[field + '_custom'] || person[field] || '';
            
            return personsData.map((person, idx) => {
                const parts = [];
                const label = idx === 0 ? 'first person' : idx === 1 ? 'second person' : `person ${idx + 1}`;
                
                const gender = getValue(person, 'gender');
                const ethnicity = getValue(person, 'ethnicity');
                const age_group = getValue(person, 'age_group');
                const body_type = getValue(person, 'body_type');
                
                if (gender) parts.push(gender);
                if (ethnicity) parts.push(ethnicity);
                if (age_group) parts.push(age_group);
                if (body_type) parts.push(`${body_type} build`);
                
                // Hair
                const hairParts = [];
                const hair_color = getValue(person, 'hair_color');
                const hair_length = getValue(person, 'hair_length');
                const hair_style = getValue(person, 'hair_style');
                if (hair_color) hairParts.push(hair_color);
                if (hair_length) hairParts.push(hair_length);
                if (hair_style) hairParts.push(hair_style);
                if (hairParts.length) parts.push(`${hairParts.join(' ')} hair`);
                
                const skin_type = getValue(person, 'skin_type');
                const expression = getValue(person, 'expression');
                const pose = getValue(person, 'pose');
                const makeup_style = getValue(person, 'makeup_style');
                
                if (skin_type) parts.push(`${skin_type} skin`);
                if (expression) parts.push(`${expression} expression`);
                if (pose) parts.push(`${pose} pose`);
                if (makeup_style && makeup_style !== 'no makeup') parts.push(`${makeup_style} makeup`);
                
                // Clothing
                const clothing_type = getValue(person, 'clothing_type');
                const clothing_color = getValue(person, 'clothing_color');
                const clothing_style = getValue(person, 'clothing_style');
                
                if (clothing_type) {
                    let clothingDesc = clothing_type;
                    if (clothing_color) clothingDesc = `${clothing_color} ${clothingDesc}`;
                    parts.push(`wearing ${clothingDesc}`);
                } else if (clothing_style) {
                    parts.push(`wearing ${clothing_style} clothing`);
                }
                
                // Accessories
                const accessories = [];
                const eyewear = getValue(person, 'eyewear');
                const earrings = getValue(person, 'earrings');
                const necklace = getValue(person, 'necklace');
                const headwear = getValue(person, 'headwear');
                if (eyewear && eyewear !== 'none') accessories.push(eyewear);
                if (earrings && earrings !== 'none') accessories.push(earrings);
                if (necklace && necklace !== 'none') accessories.push(necklace);
                if (headwear && headwear !== 'none') accessories.push(headwear);
                if (accessories.length) parts.push(`with ${accessories.join(', ')}`);
                
                if (parts.length === 0) return '';
                return `[${label}: ${parts.join(', ')}]`;
            }).filter(p => p).join(' ');
        }
        
        // ==================== DEFAULT PRESET GALLERY ====================
        
        let presetGalleryVisible = false;
        let currentPresetCategory = 'all';
        
        // Toggle preset gallery visibility
        function togglePresetGallery() {
            presetGalleryVisible = !presetGalleryVisible;
            const content = document.getElementById('presetGalleryContent');
            const btn = document.getElementById('toggleGalleryBtn');
            
            if (presetGalleryVisible) {
                content.style.display = 'block';
                btn.innerHTML = '‚ñ≤ <span data-i18n="hide_presets">Hide</span>';
                renderPresetGallery();
            } else {
                content.style.display = 'none';
                btn.innerHTML = '‚ñº <span data-i18n="show_presets">Show</span>';
            }
        }
        
        // Filter preset category
        function filterPresetCategory(category) {
            currentPresetCategory = category;
            
            // Update tab buttons
            document.querySelectorAll('.preset-category-tab').forEach(tab => {
                tab.classList.toggle('active', tab.textContent.toLowerCase().includes(category) || (category === 'all' && tab.textContent.includes('All')));
            });
            
            renderPresetGallery();
        }
        
        // Render preset gallery grid
        function renderPresetGallery() {
            const grid = document.getElementById('presetGrid');
            if (!grid || typeof DEFAULT_PRESETS === 'undefined') return;
            
            const filteredPresets = Object.entries(DEFAULT_PRESETS).filter(([key, preset]) => {
                if (currentPresetCategory === 'all') return true;
                return preset.category === currentPresetCategory;
            });
            
            grid.innerHTML = filteredPresets.map(([key, preset]) => `
                <div class="preset-card ${preset.category === 'trending' ? 'trending' : ''}" onclick="loadDefaultPreset('${key}')" title="${preset.credit || preset.description}">
                    <div class="preset-card-icon">${preset.icon}</div>
                    <div class="preset-card-name">${preset.name}</div>
                    <div class="preset-card-desc">${preset.description}</div>
                    ${preset.credit ? `<div class="preset-card-credit">üìå ${preset.credit}</div>` : ''}
                    ${preset.data.person_count > 1 ? `<div class="person-badge">üë• ${preset.data.person_count} people</div>` : ''}
                </div>
            `).join('');
        }
        
        // Load a default preset
        function loadDefaultPreset(presetKey) {
            if (typeof DEFAULT_PRESETS === 'undefined' || !DEFAULT_PRESETS[presetKey]) {
                console.error('Preset not found:', presetKey);
                return;
            }
            
            const preset = DEFAULT_PRESETS[presetKey];
            const data = preset.data;
            
            // Clear form first
            clearForm();
            
            // Load basic fields into multi-select state
            Object.entries(data).forEach(([key, value]) => {
                if (key === 'persons' || key === 'person_count') return;
                
                if (Array.isArray(value)) {
                    multiSelectState[key] = value;
                } else if (value) {
                    multiSelectState[key] = [value];
                }
            });
            
            // Handle multi-person data
            const checkbox = document.getElementById('includePeopleCheckbox');
            const peopleContainer = document.getElementById('peopleOptionsContainer');
            const peopleTypeSelect = document.getElementById('peopleTypeSelect');
            
            if (data.persons && data.persons.length > 0) {
                // Enable people section
                includePeople = true;
                checkbox.checked = true;
                peopleContainer.style.display = 'block';
                
                personCount = data.person_count || data.persons.length;
                personsData = data.persons.map(p => ({...p}));
                
                // Set to specific people mode
                peopleType = 'specific';
                peopleTypeSelect.value = 'specific';
                document.getElementById('specificPeopleContainer').style.display = 'block';
                document.getElementById('crowdTypeContainer').style.display = 'none';
                
                // Update person count buttons
                document.querySelectorAll('.person-count-btn').forEach((btn, idx) => {
                    btn.classList.toggle('active', idx + 1 === personCount || (personCount >= 4 && idx === 3));
                });
                
                // Render person panels
                setTimeout(() => renderPersonPanels(), 100);
            } else if (data.crowd) {
                // Enable people section with crowd mode
                includePeople = true;
                checkbox.checked = true;
                peopleContainer.style.display = 'block';
                
                peopleType = 'crowd';
                peopleTypeSelect.value = 'crowd';
                document.getElementById('specificPeopleContainer').style.display = 'none';
                document.getElementById('crowdTypeContainer').style.display = 'block';
            } else {
                // No people
                includePeople = false;
                checkbox.checked = false;
                peopleContainer.style.display = 'none';
                personCount = 1;
                personsData = [{}];
            }
            
            // Re-render multi-selects
            document.querySelectorAll('.multi-select-wrapper').forEach(wrapper => {
                const selectName = wrapper.dataset.multiselect;
                const optionKey = wrapper.dataset.options;
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
            });
            
            // Update contextual options
            updateContextualOptions();
            
            showNotification(`Preset loaded: ${preset.name}`);
        }

        // ==================== MULTI-SELECT DROPDOWN ====================
        
        // State for multi-select fields
        const multiSelectState = {};
        let activeDropdown = null;
        
        // Contextual fields mapping - which fields belong to which subject type
        const contextualFieldsMap = {
            'street': ['street_type', 'geographic_region'],
            'landscape': ['landscape_type', 'terrain', 'natural_elements'],
            'portrait': ['ethnicity', 'body_type', 'gender'],
            'architecture': ['building_type', 'arch_style', 'arch_era'],
            'food': ['cuisine_type', 'food_style', 'plating'],
            'fashion': ['fashion_category', 'fashion_season', 'fashion_brand_style'],
            'wildlife': ['animal_type', 'habitat', 'animal_behavior'],
            'product': ['product_type', 'product_material', 'product_background']
        };
        
        // Get all contextual field names
        const allContextualFields = Object.values(contextualFieldsMap).flat();
        
        // Initialize all multi-selects from select elements
        function initAllMultiSelects() {
            const t = translations[currentLang];
            
            document.querySelectorAll('select[data-options]').forEach(select => {
                const optionKey = select.dataset.options;
                const selectName = select.name;
                const options = promptOptions[optionKey] || [];
                const parentNode = select.parentNode;
                
                // Initialize state
                if (!multiSelectState[selectName]) {
                    multiSelectState[selectName] = [];
                }
                
                // Create wrapper
                const wrapper = document.createElement('div');
                wrapper.className = 'multi-select-wrapper';
                wrapper.dataset.multiselect = selectName;
                wrapper.dataset.options = optionKey;
                
                // Replace select with wrapper
                parentNode.replaceChild(wrapper, select);
                
                // Render multi-select
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
                
                // Add custom input field
                const customInputWrapper = document.createElement('div');
                customInputWrapper.className = 'custom-input-wrapper';
                customInputWrapper.innerHTML = `<input type="text" id="custom_${selectName}" name="${selectName}_custom" class="custom-input" placeholder="${t.custom_input_placeholder || 'or enter custom value...'}" data-i18n-placeholder="custom_input_placeholder">`;
                parentNode.appendChild(customInputWrapper);
            });
            
            // Also init existing data-multiselect containers
            document.querySelectorAll('[data-multiselect]:not(.multi-select-wrapper)').forEach(container => {
                const optionKey = container.dataset.multiselect;
                const parentNode = container.parentNode;
                
                if (!multiSelectState[optionKey]) {
                    multiSelectState[optionKey] = [];
                }
                
                const wrapper = document.createElement('div');
                wrapper.className = 'multi-select-wrapper';
                wrapper.dataset.multiselect = optionKey;
                wrapper.dataset.options = optionKey;
                parentNode.replaceChild(wrapper, container);
                renderMultiSelectDropdown(wrapper, optionKey, optionKey);
                
                // Add custom input field
                const customInputWrapper = document.createElement('div');
                customInputWrapper.className = 'custom-input-wrapper';
                customInputWrapper.innerHTML = `<input type="text" id="custom_${optionKey}" name="${optionKey}_custom" class="custom-input" placeholder="${t.custom_input_placeholder || 'or enter custom value...'}" data-i18n-placeholder="custom_input_placeholder">`;
                parentNode.appendChild(customInputWrapper);
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.multi-select-wrapper')) {
                    closeAllDropdowns();
                }
            });
        }
        
        function renderMultiSelectDropdown(wrapper, selectName, optionKey) {
            const selected = multiSelectState[selectName] || [];
            const options = promptOptions[optionKey] || [];
            const t = translations[currentLang];
            
            const triggerText = selected.length > 0 
                ? selected.map(v => getOptionLabel(v)).join(', ')
                : (t.select_placeholder || 'Se√ßiniz...');
            
            let optionsHtml = '';
            options.forEach((opt, idx) => {
                const isSelected = selected.includes(opt);
                const label = getOptionLabel(opt);
                const escapedOpt = opt.replace(/'/g, "\\'");
                optionsHtml += `
                    <div class="multi-select-item ${isSelected ? 'selected' : ''}" data-value="${opt}" onclick="toggleMultiSelectItem('${selectName}', '${escapedOpt}')">
                        <input type="checkbox" ${isSelected ? 'checked' : ''} onclick="event.stopPropagation(); toggleMultiSelectItem('${selectName}', '${escapedOpt}')">
                        <label>${label}</label>
                    </div>
                `;
            });
            
            wrapper.innerHTML = `
                <div class="multi-select-trigger" onclick="toggleDropdown('${selectName}')">
                    ${selected.length > 0 ? `<span class="multi-select-badge">${selected.length}</span>` : ''}
                    <span class="multi-select-trigger-text ${selected.length > 0 ? 'has-selection' : ''}">${triggerText}</span>
                    <span class="multi-select-trigger-arrow">‚ñº</span>
                </div>
                <div class="multi-select-dropdown" id="dropdown_${selectName}">
                    <div class="multi-select-search">
                        <input type="text" placeholder="üîç Search..." oninput="filterMultiSelectOptions('${selectName}', this.value)">
                    </div>
                    <div class="multi-select-options">
                        ${optionsHtml}
                    </div>
                    <div class="multi-select-actions">
                        <button type="button" onclick="selectAllMulti('${selectName}')">Select All</button>
                        <button type="button" onclick="clearMultiSelect('${selectName}')">Clear</button>
                    </div>
                </div>
            `;
        }
        
        function toggleDropdown(selectName) {
            const dropdown = document.getElementById(`dropdown_${selectName}`);
            const trigger = dropdown.previousElementSibling;
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                trigger.classList.remove('active');
                activeDropdown = null;
            } else {
                closeAllDropdowns();
                dropdown.classList.add('show');
                trigger.classList.add('active');
                activeDropdown = selectName;
                // Focus search input
                const searchInput = dropdown.querySelector('input[type="text"]');
                if (searchInput) setTimeout(() => searchInput.focus(), 100);
            }
        }
        
        function closeAllDropdowns() {
            document.querySelectorAll('.multi-select-dropdown.show').forEach(d => {
                d.classList.remove('show');
                d.previousElementSibling.classList.remove('active');
            });
            activeDropdown = null;
        }
        
        function filterMultiSelectOptions(selectName, searchTerm) {
            const dropdown = document.getElementById(`dropdown_${selectName}`);
            const items = dropdown.querySelectorAll('.multi-select-item');
            const term = searchTerm.toLowerCase();
            
            items.forEach(item => {
                const label = item.querySelector('label').textContent.toLowerCase();
                const value = item.dataset.value.toLowerCase();
                if (label.includes(term) || value.includes(term)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        }
        
        function toggleMultiSelectItem(selectName, value) {
            if (!multiSelectState[selectName]) {
                multiSelectState[selectName] = [];
            }
            
            const idx = multiSelectState[selectName].indexOf(value);
            if (idx > -1) {
                multiSelectState[selectName].splice(idx, 1);
            } else {
                multiSelectState[selectName].push(value);
            }
            
            // Re-render
            const wrapper = document.querySelector(`[data-multiselect="${selectName}"]`);
            if (wrapper) {
                const optionKey = wrapper.dataset.options;
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
                // Re-open dropdown
                const dropdown = document.getElementById(`dropdown_${selectName}`);
                const trigger = dropdown.previousElementSibling;
                dropdown.classList.add('show');
                trigger.classList.add('active');
            }
            
            // Update contextual options if subject_type changed
            if (selectName === 'subject_type') {
                updateContextualOptions();
            }
        }
        
        function selectAllMulti(selectName) {
            const wrapper = document.querySelector(`[data-multiselect="${selectName}"]`);
            if (wrapper) {
                const optionKey = wrapper.dataset.options;
                const options = promptOptions[optionKey] || [];
                multiSelectState[selectName] = [...options];
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
                // Re-open dropdown
                const dropdown = document.getElementById(`dropdown_${selectName}`);
                const trigger = dropdown.previousElementSibling;
                dropdown.classList.add('show');
                trigger.classList.add('active');
            }
        }
        
        function clearMultiSelect(selectName) {
            multiSelectState[selectName] = [];
            const wrapper = document.querySelector(`[data-multiselect="${selectName}"]`);
            if (wrapper) {
                const optionKey = wrapper.dataset.options;
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
            }
            
            // Update contextual options if subject_type cleared
            if (selectName === 'subject_type') {
                updateContextualOptions();
            }
        }
        
        function getMultiSelectValues(selectName) {
            return multiSelectState[selectName] || [];
        }
        
        // Legacy support
        function initMultiSelects() {
            // Now handled by initAllMultiSelects
        }

        // ==================== CONTEXTUAL OPTIONS ====================
        
        function updateContextualOptions() {
            // Get subject type from multi-select state (first selected value)
            const subjectTypes = multiSelectState['subject_type'] || [];
            const subjectType = subjectTypes[0] || '';
            const container = document.getElementById('contextualOptions');
            const allOptions = document.querySelectorAll('.context-option');
            
            // Process all contextual options
            allOptions.forEach(opt => {
                const optContext = opt.dataset.context;
                const isRelevant = subjectType && optContext === subjectType;
                
                if (isRelevant) {
                    // Show relevant options
                    opt.style.display = 'block';
                } else {
                    // Hide non-relevant options and clear their state
                    opt.style.display = 'none';
                    // Reset the select value when hiding
                    const select = opt.querySelector('select');
                    if (select) select.value = '';
                    // Clear multi-selects only for hidden options
                    const multiSelect = opt.querySelector('[data-multiselect]');
                    if (multiSelect) {
                        const key = multiSelect.dataset.multiselect;
                        multiSelectState[key] = [];
                    }
                    // Clear custom input values for hidden options
                    const customInput = opt.querySelector('.custom-input');
                    if (customInput) {
                        customInput.value = '';
                    }
                }
            });
            
            // Show/hide container based on subject type
            if (subjectType) {
                const relevantOptions = document.querySelectorAll(`.context-option[data-context="${subjectType}"]`);
                if (relevantOptions.length > 0) {
                    container.style.display = 'grid';
                    // Re-render multi-selects for visible options to show their current state
                    relevantOptions.forEach(opt => {
                        const wrapper = opt.querySelector('.multi-select-wrapper');
                        if (wrapper) {
                            const selectName = wrapper.dataset.multiselect;
                            const optionKey = wrapper.dataset.options;
                            renderMultiSelectDropdown(wrapper, selectName, optionKey);
                        }
                    });
                } else {
                    container.style.display = 'none';
                }
            } else {
                container.style.display = 'none';
            }
        }

        // ==================== FORMAT GENERATORS ====================
        
        /**
         * Generate TOON format (Token-Oriented Object Notation)
         * Based on: https://github.com/toon-format/toon
         * TOON uses YAML-like indentation with CSV-style tabular arrays
         */
        function generateToonFormat(data) {
            const lines = [];
            
            // Build prompt sections
            const subject = {};
            if (data.subject_type) subject.type = data.subject_type;
            if (data.subject_description) subject.description = data.subject_description;
            if (data.style) subject.style = data.style;
            // Contextual subject details
            if (data.street_type) subject.street_type = data.street_type;
            if (data.geographic_region) subject.region = data.geographic_region;
            if (data.landscape_type) subject.landscape = data.landscape_type;
            if (data.terrain) subject.terrain = data.terrain;
            if (data.natural_elements) subject.elements = data.natural_elements;
            if (data.ethnicity) subject.ethnicity = data.ethnicity;
            if (data.body_type) subject.body = data.body_type;
            if (data.gender) subject.gender = data.gender;
            if (data.building_type) subject.building = data.building_type;
            if (data.arch_style) subject.arch_style = data.arch_style;
            if (data.arch_era) subject.arch_era = data.arch_era;
            if (data.cuisine_type) subject.cuisine = data.cuisine_type;
            if (data.food_style) subject.food_style = data.food_style;
            if (data.plating) subject.plating = data.plating;
            if (data.fashion_category) subject.fashion_cat = data.fashion_category;
            if (data.fashion_season) subject.fashion_season = data.fashion_season;
            if (data.fashion_brand_style) subject.brand_style = data.fashion_brand_style;
            if (data.animal_type) subject.animal = data.animal_type;
            if (data.habitat) subject.habitat = data.habitat;
            if (data.animal_behavior) subject.behavior = data.animal_behavior;
            if (data.product_type) subject.product = data.product_type;
            if (data.product_material) subject.material = data.product_material;
            if (data.product_background) subject.background = data.product_background;
            
            const era = {};
            if (data.era) era.period = data.era;
            if (data.time_of_day) era.time = data.time_of_day;
            if (data.season) era.season = data.season;
            
            const environment = {};
            if (data.location) environment.location = data.location;
            if (data.setting) environment.setting = data.setting;
            if (data.crowd) environment.crowd = data.crowd;
            if (data.weather) environment.weather = data.weather;
            if (data.architecture) environment.architecture = data.architecture;
            
            const atmosphere = {};
            if (data.mood) atmosphere.mood = data.mood;
            if (data.color_palette) atmosphere.colors = data.color_palette;
            if (data.lighting) atmosphere.lighting = data.lighting;
            
            const character = {};
            if (data.clothing_type) character.clothing_type = data.clothing_type;
            if (data.clothing_color) character.clothing_color = data.clothing_color;
            if (data.clothing_material) character.clothing_material = data.clothing_material;
            if (data.clothing_style) character.clothing_style = data.clothing_style;
            if (data.clothing_era) character.clothing_era = data.clothing_era;
            if (data.age_group) character.age = data.age_group;
            if (data.expression) character.expression = data.expression;
            if (data.pose) character.pose = data.pose;
            
            const hair = {};
            if (data.hair_style) hair.style = data.hair_style;
            if (data.hair_color) hair.color = data.hair_color;
            if (data.hair_length) hair.length = data.hair_length;
            if (data.hair_effect) hair.effect = data.hair_effect;
            
            const face = {};
            if (data.skin_type) face.skin = data.skin_type;
            if (data.makeup_style) face.makeup = data.makeup_style;
            if (data.face_features) face.features = data.face_features;
            
            const expression = {};
            if (data.eye_look) expression.eye_look = data.eye_look;
            if (data.eye_energy) expression.eye_energy = data.eye_energy;
            if (data.eye_direction) expression.eye_direction = data.eye_direction;
            if (data.mouth_position) expression.mouth_position = data.mouth_position;
            if (data.mouth_energy) expression.mouth_energy = data.mouth_energy;
            
            const body = {};
            if (data.body_frame) body.frame = data.body_frame;
            if (data.body_definition) body.definition = data.body_definition;
            if (data.skin_visible_areas) body.visible_areas = data.skin_visible_areas;
            if (data.skin_tone) body.skin_tone = data.skin_tone;
            if (data.skin_texture) body.skin_texture = data.skin_texture;
            if (data.skin_lighting_effect) body.skin_lighting = data.skin_lighting_effect;
            
            const poseAdvanced = {};
            if (data.pose_position) poseAdvanced.position = data.pose_position;
            if (data.pose_base) poseAdvanced.base = data.pose_base;
            if (data.pose_energy) poseAdvanced.energy = data.pose_energy;
            
            const clothingAdvanced = {};
            if (data.clothing_effect) clothingAdvanced.effect = data.clothing_effect;
            if (data.clothing_details) clothingAdvanced.details = data.clothing_details;
            
            const device = {};
            if (data.device_type) device.type = data.device_type;
            if (data.device_details) device.details = data.device_details;
            if (data.prop_type) device.prop = data.prop_type;
            
            const opticalIllusion = {};
            if (data.illusion_type) opticalIllusion.type = data.illusion_type;
            if (data.illusion_device) opticalIllusion.device = data.illusion_device;
            
            const accessories = {};
            if (data.eyewear && data.eyewear !== 'none') accessories.eyewear = data.eyewear;
            if (data.earrings && data.earrings !== 'none') accessories.earrings = data.earrings;
            if (data.necklace && data.necklace !== 'none') accessories.necklace = data.necklace;
            if (data.bracelet && data.bracelet !== 'none') accessories.bracelet = data.bracelet;
            if (data.rings && data.rings !== 'none') accessories.rings = data.rings;
            if (data.headwear && data.headwear !== 'none') accessories.headwear = data.headwear;
            
            const technical = {};
            if (data.camera_type) technical.camera = data.camera_type;
            if (data.camera_angle) technical.angle = data.camera_angle;
            if (data.camera_settings) technical.settings = data.camera_settings;
            if (data.composition) technical.composition = data.composition;
            if (data.film_type) technical.film = data.film_type;
            if (data.aspect_ratio) technical.ratio = data.aspect_ratio;
            
            const photographyAdvanced = {};
            if (data.camera_style) photographyAdvanced.camera_style = data.camera_style;
            if (data.shot_type) photographyAdvanced.shot_type = data.shot_type;
            if (data.photo_texture) photographyAdvanced.texture = data.photo_texture;
            if (data.depth_of_field) photographyAdvanced.dof = data.depth_of_field;
            
            const backgroundAdvanced = {};
            if (data.background_elements) backgroundAdvanced.elements = data.background_elements;
            if (data.background_atmosphere) backgroundAdvanced.atmosphere = data.background_atmosphere;
            
            const theVibe = {};
            if (data.vibe_energy) theVibe.energy = data.vibe_energy;
            if (data.vibe_aesthetic) theVibe.aesthetic = data.vibe_aesthetic;
            if (data.vibe_authenticity) theVibe.authenticity = data.vibe_authenticity;
            if (data.vibe_intimacy) theVibe.intimacy = data.vibe_intimacy;
            
            const quality = {};
            if (data.quality_modifiers) quality.modifiers = data.quality_modifiers;
            if (data.render_style) quality.render = data.render_style;
            if (data.additional_details) quality.details = data.additional_details;
            
            // TOON format with indentation
            const escapeValue = (v) => v.includes(',') || v.includes(':') ? `"${v}"` : v;
            
            if (Object.keys(subject).length) {
                lines.push('subject:');
                Object.entries(subject).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(era).length) {
                lines.push('era:');
                Object.entries(era).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(environment).length) {
                lines.push('environment:');
                Object.entries(environment).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(atmosphere).length) {
                lines.push('atmosphere:');
                Object.entries(atmosphere).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(character).length) {
                lines.push('character:');
                Object.entries(character).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(hair).length) {
                lines.push('hair:');
                Object.entries(hair).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(face).length) {
                lines.push('face:');
                Object.entries(face).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(expression).length) {
                lines.push('expression:');
                Object.entries(expression).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(body).length) {
                lines.push('body:');
                Object.entries(body).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(poseAdvanced).length) {
                lines.push('pose_advanced:');
                Object.entries(poseAdvanced).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(clothingAdvanced).length) {
                lines.push('clothing_advanced:');
                Object.entries(clothingAdvanced).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(accessories).length) {
                lines.push('accessories:');
                Object.entries(accessories).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(device).length) {
                lines.push('device:');
                Object.entries(device).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(opticalIllusion).length) {
                lines.push('optical_illusion:');
                Object.entries(opticalIllusion).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(technical).length) {
                lines.push('technical:');
                Object.entries(technical).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(photographyAdvanced).length) {
                lines.push('photography_advanced:');
                Object.entries(photographyAdvanced).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(backgroundAdvanced).length) {
                lines.push('background_advanced:');
                Object.entries(backgroundAdvanced).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(theVibe).length) {
                lines.push('the_vibe:');
                Object.entries(theVibe).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            if (Object.keys(quality).length) {
                lines.push('quality:');
                Object.entries(quality).forEach(([k, v]) => lines.push(`  ${k}: ${escapeValue(v)}`));
            }
            
            // Objects in scene
            if (sceneObjects.length > 0) {
                lines.push('objects:');
                sceneObjects.forEach((obj, idx) => {
                    const objParts = [];
                    if (obj.label) objParts.push(`label: ${escapeValue(obj.label)}`);
                    if (obj.category) objParts.push(`category: ${escapeValue(obj.category)}`);
                    if (obj.location) objParts.push(`location: ${escapeValue(obj.location)}`);
                    if (obj.prominence) objParts.push(`prominence: ${escapeValue(obj.prominence)}`);
                    if (obj.color) objParts.push(`color: ${escapeValue(obj.color)}`);
                    if (obj.texture) objParts.push(`texture: ${escapeValue(obj.texture)}`);
                    if (obj.material) objParts.push(`material: ${escapeValue(obj.material)}`);
                    if (obj.state) objParts.push(`state: ${escapeValue(obj.state)}`);
                    if (obj.details) objParts.push(`details: ${escapeValue(obj.details)}`);
                    if (objParts.length > 0) {
                        lines.push(`  - ${objParts.join(', ')}`);
                    }
                });
            }
            
            // Semantic relationships
            if (semanticRelationships.length > 0) {
                lines.push('relationships:');
                semanticRelationships.forEach(rel => {
                    if (rel.subject && rel.action && rel.object) {
                        lines.push(`  - ${escapeValue(rel.subject)} ${escapeValue(rel.action)} ${escapeValue(rel.object)}`);
                    }
                });
            }
            
            // Negative prompt as array
            const negativeItems = getSelectedNegativePrompts();
            lines.push(`negative[${negativeItems.length}]: ${negativeItems.join(',')}`);
            
            // Add metadata
            lines.push('metadata{3}:');
            lines.push('  format_version:str, generator:str, credit:str');
            lines.push('  "3.0", "PhotoPrompt Generator by @niyoverse", "' + (data.current_preset_credit || '') + '"');
            
            return lines.join('\n');
        }

        /**
         * Generate TONL format (Token-Optimized Notation Language)
         * Based on: https://github.com/tonl-dev/tonl
         * TONL uses schema-aware compact serialization
         */
        function generateTonlFormat(data) {
            const lines = [];
            lines.push('#version 1.0');
            
            // Helper to add field
            const addField = (fields, values, key, value, quoted = false) => {
                if (value) {
                    fields.push(`${key}:str`);
                    values.push(quoted ? `"${value}"` : value);
                }
            };
            
            const fields = [], values = [];
            addField(fields, values, 'type', data.subject_type);
            addField(fields, values, 'subject', data.subject_description, true);
            addField(fields, values, 'style', data.style);
            // Contextual fields
            addField(fields, values, 'street_type', data.street_type);
            addField(fields, values, 'region', data.geographic_region);
            addField(fields, values, 'landscape', data.landscape_type);
            addField(fields, values, 'terrain', data.terrain);
            addField(fields, values, 'elements', data.natural_elements);
            addField(fields, values, 'ethnicity', data.ethnicity);
            addField(fields, values, 'body', data.body_type);
            addField(fields, values, 'gender', data.gender);
            addField(fields, values, 'building', data.building_type);
            addField(fields, values, 'arch_style', data.arch_style);
            addField(fields, values, 'arch_era', data.arch_era);
            addField(fields, values, 'cuisine', data.cuisine_type);
            addField(fields, values, 'food_style', data.food_style);
            addField(fields, values, 'plating', data.plating);
            addField(fields, values, 'fashion_cat', data.fashion_category);
            addField(fields, values, 'fashion_season', data.fashion_season);
            addField(fields, values, 'brand_style', data.fashion_brand_style);
            addField(fields, values, 'animal', data.animal_type);
            addField(fields, values, 'habitat', data.habitat);
            addField(fields, values, 'behavior', data.animal_behavior);
            addField(fields, values, 'product', data.product_type);
            addField(fields, values, 'material', data.product_material);
            addField(fields, values, 'bg', data.product_background);
            // Era & Time
            addField(fields, values, 'era', data.era);
            addField(fields, values, 'time', data.time_of_day);
            addField(fields, values, 'season', data.season);
            addField(fields, values, 'location', data.location);
            addField(fields, values, 'setting', data.setting);
            addField(fields, values, 'crowd', data.crowd);
            addField(fields, values, 'weather', data.weather);
            addField(fields, values, 'architecture', data.architecture);
            addField(fields, values, 'mood', data.mood);
            addField(fields, values, 'colors', data.color_palette);
            addField(fields, values, 'lighting', data.lighting);
            // Character & Clothing
            addField(fields, values, 'clothing_type', data.clothing_type);
            addField(fields, values, 'clothing_color', data.clothing_color);
            addField(fields, values, 'clothing_material', data.clothing_material);
            addField(fields, values, 'clothing_style', data.clothing_style);
            addField(fields, values, 'clothing_era', data.clothing_era);
            addField(fields, values, 'age', data.age_group);
            addField(fields, values, 'expression', data.expression);
            addField(fields, values, 'pose', data.pose);
            // Hair
            addField(fields, values, 'hair_style', data.hair_style);
            addField(fields, values, 'hair_color', data.hair_color);
            addField(fields, values, 'hair_length', data.hair_length);
            addField(fields, values, 'hair_effect', data.hair_effect);
            // Face & Makeup
            addField(fields, values, 'skin_type', data.skin_type);
            addField(fields, values, 'makeup', data.makeup_style);
            addField(fields, values, 'face_features', data.face_features);
            // Advanced Expression
            addField(fields, values, 'eye_look', data.eye_look);
            addField(fields, values, 'eye_energy', data.eye_energy);
            addField(fields, values, 'eye_direction', data.eye_direction);
            addField(fields, values, 'mouth_position', data.mouth_position);
            addField(fields, values, 'mouth_energy', data.mouth_energy);
            // Advanced Body
            addField(fields, values, 'body_frame', data.body_frame);
            addField(fields, values, 'body_definition', data.body_definition);
            addField(fields, values, 'skin_visible_areas', data.skin_visible_areas);
            addField(fields, values, 'skin_tone', data.skin_tone);
            addField(fields, values, 'skin_texture', data.skin_texture);
            addField(fields, values, 'skin_lighting', data.skin_lighting_effect);
            // Advanced Pose
            addField(fields, values, 'pose_position', data.pose_position);
            addField(fields, values, 'pose_base', data.pose_base);
            addField(fields, values, 'pose_energy', data.pose_energy);
            // Advanced Clothing
            addField(fields, values, 'clothing_effect', data.clothing_effect);
            addField(fields, values, 'clothing_details', data.clothing_details);
            // Device & Props
            addField(fields, values, 'device_type', data.device_type);
            addField(fields, values, 'device_details', data.device_details);
            addField(fields, values, 'prop_type', data.prop_type);
            // Optical Illusion
            addField(fields, values, 'illusion_type', data.illusion_type);
            addField(fields, values, 'illusion_device', data.illusion_device);
            // Accessories
            addField(fields, values, 'eyewear', data.eyewear);
            addField(fields, values, 'earrings', data.earrings);
            addField(fields, values, 'necklace', data.necklace);
            addField(fields, values, 'bracelet', data.bracelet);
            addField(fields, values, 'rings', data.rings);
            addField(fields, values, 'headwear', data.headwear);
            addField(fields, values, 'camera', data.camera_type);
            addField(fields, values, 'angle', data.camera_angle);
            addField(fields, values, 'settings', data.camera_settings);
            addField(fields, values, 'composition', data.composition);
            addField(fields, values, 'film', data.film_type);
            addField(fields, values, 'ratio', data.aspect_ratio);
            // Photography Advanced
            addField(fields, values, 'camera_style', data.camera_style);
            addField(fields, values, 'shot_type', data.shot_type);
            addField(fields, values, 'photo_texture', data.photo_texture);
            addField(fields, values, 'dof', data.depth_of_field);
            // Background Advanced
            addField(fields, values, 'bg_elements', data.background_elements);
            addField(fields, values, 'bg_atmosphere', data.background_atmosphere);
            // The Vibe
            addField(fields, values, 'vibe_energy', data.vibe_energy);
            addField(fields, values, 'vibe_aesthetic', data.vibe_aesthetic);
            addField(fields, values, 'vibe_authenticity', data.vibe_authenticity);
            addField(fields, values, 'vibe_intimacy', data.vibe_intimacy);
            // Quality
            addField(fields, values, 'quality', data.quality_modifiers);
            addField(fields, values, 'render', data.render_style);
            addField(fields, values, 'details', data.additional_details, true);
            
            if (fields.length > 0) {
                lines.push(`prompt{${fields.join(',')}}:`);
                lines.push(`  ${values.join(', ')}`);
            }
            
            // Objects in scene for TONL
            if (sceneObjects.length > 0) {
                const objFields = ['label:str', 'cat:str', 'loc:str', 'prom:str', 'color:str', 'tex:str', 'mat:str', 'state:str', 'det:str'];
                lines.push(`objects[${sceneObjects.length}]{${objFields.join(',')}}:`);
                sceneObjects.forEach(obj => {
                    const objValues = [];
                    objValues.push(obj.label ? `"${obj.label}"` : '""');
                    objValues.push(obj.category || '-');
                    objValues.push(obj.location || '-');
                    objValues.push(obj.prominence || '-');
                    objValues.push(obj.color || '-');
                    objValues.push(obj.texture || '-');
                    objValues.push(obj.material || '-');
                    objValues.push(obj.state || '-');
                    objValues.push(obj.details ? `"${obj.details}"` : '""');
                    lines.push(`  ${objValues.join(', ')}`);
                });
            }
            
            // Semantic relationships for TONL
            if (semanticRelationships.length > 0) {
                lines.push(`relations[${semanticRelationships.length}]:`);
                semanticRelationships.forEach(rel => {
                    if (rel.subject && rel.action && rel.object) {
                        lines.push(`  "${rel.subject}" ${rel.action} "${rel.object}"`);
                    }
                });
            }
            
            const negativeItems = getSelectedNegativePrompts();
            lines.push(`negative[${negativeItems.length}]: ${negativeItems.join(', ')}`);
            
            // Add metadata
            lines.push('metadata:');
            lines.push('  format_version: 2.0');
            lines.push('  generator: PhotoPrompt Generator by @niyoverse');
            if (data.current_preset_credit) {
                lines.push(`  credit: ${escapeValue(data.current_preset_credit)}`);
            }
            
            return lines.join('\n');
        }

        /**
         * Generate JSON format
         */
        function generateJsonFormat(data) {
            const cleanObj = (obj) => {
                const cleaned = {};
                Object.entries(obj).forEach(([k, v]) => {
                    if (v && v !== '') cleaned[k] = v;
                });
                return Object.keys(cleaned).length ? cleaned : null;
            };
            
            // Helper to get custom fields for a section
            const getCustomFieldsForSection = (sectionName) => {
                const fields = customFields[sectionName] || [];
                const result = {};
                fields.forEach(field => {
                    if (data[field.name]) {
                        result[field.name] = data[field.name];
                    }
                });
                return result;
            };
            
            const promptData = {
                prompt: {
                    subject: cleanObj({
                        type: data.subject_type,
                        description: data.subject_description,
                        style: data.style,
                        // Contextual details based on subject type
                        street_type: data.street_type,
                        geographic_region: data.geographic_region,
                        landscape_type: data.landscape_type,
                        terrain: data.terrain,
                        natural_elements: data.natural_elements,
                        ethnicity: data.ethnicity,
                        body_type: data.body_type,
                        gender: data.gender,
                        building_type: data.building_type,
                        arch_style: data.arch_style,
                        arch_era: data.arch_era,
                        cuisine_type: data.cuisine_type,
                        food_style: data.food_style,
                        plating: data.plating,
                        fashion_category: data.fashion_category,
                        fashion_season: data.fashion_season,
                        fashion_brand_style: data.fashion_brand_style,
                        animal_type: data.animal_type,
                        habitat: data.habitat,
                        animal_behavior: data.animal_behavior,
                        product_type: data.product_type,
                        product_material: data.product_material,
                        product_background: data.product_background,
                        ...getCustomFieldsForSection('subject')
                    }),
                    era: cleanObj({
                        period: data.era,
                        time_of_day: data.time_of_day,
                        season: data.season,
                        ...getCustomFieldsForSection('era')
                    }),
                    environment: cleanObj({
                        location: data.location,
                        setting: data.setting,
                        crowd: data.crowd,
                        weather: data.weather,
                        architecture: data.architecture,
                        ...getCustomFieldsForSection('environment')
                    }),
                    atmosphere: cleanObj({
                        mood: data.mood,
                        color_palette: data.color_palette,
                        lighting: data.lighting,
                        ...getCustomFieldsForSection('atmosphere')
                    }),
                    character: cleanObj({
                        clothing_type: data.clothing_type,
                        clothing_color: data.clothing_color,
                        clothing_material: data.clothing_material,
                        clothing_style: data.clothing_style,
                        clothing_era: data.clothing_era,
                        age_group: data.age_group,
                        expression: data.expression,
                        pose: data.pose,
                        ...getCustomFieldsForSection('character')
                    }),
                    hair: cleanObj({
                        style: data.hair_style,
                        color: data.hair_color,
                        length: data.hair_length,
                        effect: data.hair_effect,
                        ...getCustomFieldsForSection('hair')
                    }),
                    face: cleanObj({
                        skin_type: data.skin_type,
                        makeup_style: data.makeup_style,
                        features: data.face_features,
                        ...getCustomFieldsForSection('face')
                    }),
                    expression: cleanObj({
                        eye_look: data.eye_look,
                        eye_energy: data.eye_energy,
                        eye_direction: data.eye_direction,
                        mouth_position: data.mouth_position,
                        mouth_energy: data.mouth_energy
                    }),
                    body: cleanObj({
                        frame: data.body_frame,
                        definition: data.body_definition,
                        skin_visible_areas: data.skin_visible_areas,
                        skin_tone: data.skin_tone,
                        skin_texture: data.skin_texture,
                        skin_lighting_effect: data.skin_lighting_effect
                    }),
                    pose: cleanObj({
                        position: data.pose_position,
                        base: data.pose_base,
                        energy: data.pose_energy
                    }),
                    clothing_advanced: cleanObj({
                        effect: data.clothing_effect,
                        details: data.clothing_details
                    }),
                    device: cleanObj({
                        type: data.device_type,
                        details: data.device_details,
                        prop_type: data.prop_type
                    }),
                    optical_illusion: cleanObj({
                        type: data.illusion_type,
                        device: data.illusion_device
                    }),
                    // Multi-person data with custom fields
                    persons: data.persons && data.persons.length > 0 ? data.persons.map((p, idx) => {
                        const personData = {};
                        Object.entries(p).forEach(([k, v]) => {
                            if (v && v !== '') personData[k] = v;
                        });
                        // Add people section custom fields to each person
                        const peopleCustom = getCustomFieldsForSection('people');
                        Object.assign(personData, peopleCustom);
                        return Object.keys(personData).length > 0 ? { person: idx + 1, ...personData } : null;
                    }).filter(p => p) : undefined,
                    person_count: data.person_count > 1 ? data.person_count : undefined,
                    accessories: cleanObj({
                        eyewear: data.eyewear,
                        earrings: data.earrings,
                        necklace: data.necklace,
                        bracelet: data.bracelet,
                        rings: data.rings,
                        headwear: data.headwear,
                        ...getCustomFieldsForSection('accessories')
                    }),
                    technical: cleanObj({
                        camera: data.camera_type,
                        angle: data.camera_angle,
                        settings: data.camera_settings,
                        composition: data.composition,
                        film_type: data.film_type,
                        aspect_ratio: data.aspect_ratio,
                        ...getCustomFieldsForSection('technical')
                    }),
                    photography_advanced: cleanObj({
                        camera_style: data.camera_style,
                        shot_type: data.shot_type,
                        photo_texture: data.photo_texture,
                        depth_of_field: data.depth_of_field
                    }),
                    background_advanced: cleanObj({
                        elements: data.background_elements,
                        atmosphere: data.background_atmosphere
                    }),
                    the_vibe: cleanObj({
                        energy: data.vibe_energy,
                        aesthetic: data.vibe_aesthetic,
                        authenticity: data.vibe_authenticity,
                        intimacy: data.vibe_intimacy
                    }),
                    quality: cleanObj({
                        modifiers: data.quality_modifiers,
                        render_style: data.render_style,
                        additional_details: data.additional_details,
                        ...getCustomFieldsForSection('quality')
                    })
                },
                // Objects in scene
                objects: sceneObjects.length > 0 ? sceneObjects.map(obj => {
                    const cleanObj = {};
                    if (obj.label) cleanObj.label = obj.label;
                    if (obj.category) cleanObj.category = obj.category;
                    if (obj.location) cleanObj.location = obj.location;
                    if (obj.prominence) cleanObj.prominence = obj.prominence;
                    if (obj.color || obj.texture || obj.material || obj.state) {
                        cleanObj.visual_attributes = {};
                        if (obj.color) cleanObj.visual_attributes.color = obj.color;
                        if (obj.texture) cleanObj.visual_attributes.texture = obj.texture;
                        if (obj.material) cleanObj.visual_attributes.material = obj.material;
                        if (obj.state) cleanObj.visual_attributes.state = obj.state;
                    }
                    if (obj.details) cleanObj.micro_details = obj.details.split(',').map(d => d.trim()).filter(d => d);
                    return cleanObj;
                }) : undefined,
                // Semantic relationships
                semantic_relationships: semanticRelationships.length > 0 ? semanticRelationships : undefined,
                negative_prompt: getSelectedNegativePrompts(),
                metadata: {
                    format_version: "3.0",
                    generator: "PhotoPrompt Generator by @niyoverse",
                    ...(data.current_preset_credit ? { credit: data.current_preset_credit } : {})
                }
            };
            
            // Remove null sections
            Object.keys(promptData.prompt).forEach(k => {
                if (!promptData.prompt[k]) delete promptData.prompt[k];
            });
            
            return JSON.stringify(promptData, null, 2);
        }

        /**
         * Generate Natural language prompt
         */
        function generateNaturalPrompt(data) {
            const parts = [];
            
            // Subject & Style
            if (data.subject_description) parts.push(data.subject_description);
            if (data.style) parts.push(`${data.style} style`);
            if (data.subject_type) parts.push(`${data.subject_type} photography`);
            
            // Multi-person descriptions (if available)
            if (data.person_descriptions) {
                parts.push(data.person_descriptions);
            }
            
            // Contextual details
            if (data.street_type) parts.push(`in ${data.street_type}`);
            if (data.geographic_region) parts.push(`${data.geographic_region}`);
            if (data.landscape_type) parts.push(`${data.landscape_type}`);
            if (data.terrain) parts.push(`${data.terrain} terrain`);
            if (data.natural_elements) parts.push(`with ${data.natural_elements}`);
            if (data.ethnicity) parts.push(`${data.ethnicity}`);
            if (data.body_type) parts.push(`${data.body_type} build`);
            if (data.gender) parts.push(`${data.gender}`);
            if (data.building_type) parts.push(`${data.building_type}`);
            if (data.arch_style) parts.push(`${data.arch_style} style architecture`);
            if (data.arch_era) parts.push(`${data.arch_era} period`);
            if (data.cuisine_type) parts.push(`${data.cuisine_type} cuisine`);
            if (data.food_style) parts.push(`${data.food_style}`);
            if (data.plating) parts.push(`${data.plating}`);
            if (data.fashion_category) parts.push(`${data.fashion_category}`);
            if (data.fashion_season) parts.push(`${data.fashion_season} collection`);
            if (data.fashion_brand_style) parts.push(`${data.fashion_brand_style}`);
            if (data.animal_type) parts.push(`${data.animal_type}`);
            if (data.habitat) parts.push(`in ${data.habitat}`);
            if (data.animal_behavior) parts.push(`${data.animal_behavior}`);
            if (data.product_type) parts.push(`${data.product_type}`);
            if (data.product_material) parts.push(`${data.product_material} material`);
            if (data.product_background) parts.push(`${data.product_background} background`);
            
            // Era & Time
            if (data.era) parts.push(`${data.era} era`);
            if (data.time_of_day) parts.push(`during ${data.time_of_day}`);
            if (data.season) parts.push(`in ${data.season}`);
            
            // Environment
            if (data.location) parts.push(`${data.location} location`);
            if (data.setting) parts.push(`${data.setting} setting`);
            if (data.crowd) parts.push(`${data.crowd} scene`);
            if (data.weather) parts.push(`${data.weather}`);
            if (data.architecture) parts.push(`${data.architecture} architecture`);
            
            // Atmosphere
            if (data.mood) parts.push(`${data.mood} atmosphere`);
            if (data.color_palette) parts.push(`${data.color_palette} color palette`);
            if (data.lighting) parts.push(`${data.lighting} lighting`);
            
            // Character & Clothing
            if (data.clothing_type) {
                let clothingDesc = data.clothing_type;
                if (data.clothing_color) clothingDesc = `${data.clothing_color} ${clothingDesc}`;
                if (data.clothing_material) clothingDesc += ` made of ${data.clothing_material}`;
                parts.push(`wearing ${clothingDesc}`);
            } else if (data.clothing_style) {
                parts.push(`wearing ${data.clothing_style} clothing`);
            }
            if (data.clothing_era) parts.push(`${data.clothing_era} fashion`);
            if (data.age_group) parts.push(`${data.age_group}`);
            if (data.expression) parts.push(`${data.expression} expression`);
            if (data.pose) parts.push(`${data.pose} pose`);
            
            // Hair
            if (data.hair_style || data.hair_color || data.hair_length) {
                let hairDesc = [];
                if (data.hair_color) hairDesc.push(data.hair_color);
                if (data.hair_length) hairDesc.push(data.hair_length);
                if (data.hair_style) hairDesc.push(data.hair_style);
                if (hairDesc.length) parts.push(`${hairDesc.join(' ')} hair`);
            }
            
            // Face & Makeup
            if (data.skin_type) parts.push(`${data.skin_type} skin`);
            if (data.makeup_style) parts.push(`${data.makeup_style} makeup`);
            if (data.face_features) parts.push(`${data.face_features}`);
            
            // Advanced Expression
            if (data.eye_look) parts.push(`${data.eye_look} eyes`);
            if (data.eye_energy) parts.push(`${data.eye_energy} eye energy`);
            if (data.eye_direction) parts.push(`${data.eye_direction}`);
            if (data.mouth_position) parts.push(`${data.mouth_position}`);
            if (data.mouth_energy) parts.push(`${data.mouth_energy} expression`);
            
            // Hair Effect
            if (data.hair_effect) parts.push(`${data.hair_effect} hair effect`);
            
            // Advanced Body & Skin
            if (data.body_frame) parts.push(`${data.body_frame} frame`);
            if (data.body_definition) parts.push(`${data.body_definition}`);
            if (data.skin_visible_areas) parts.push(`${data.skin_visible_areas} visible`);
            if (data.skin_tone) parts.push(`${data.skin_tone} skin tone`);
            if (data.skin_texture) parts.push(`${data.skin_texture} skin texture`);
            if (data.skin_lighting_effect) parts.push(`${data.skin_lighting_effect}`);
            
            // Advanced Pose
            if (data.pose_position) parts.push(`${data.pose_position} position`);
            if (data.pose_base) parts.push(`${data.pose_base} pose`);
            if (data.pose_energy) parts.push(`${data.pose_energy} energy`);
            
            // Advanced Clothing
            if (data.clothing_effect) parts.push(`${data.clothing_effect}`);
            if (data.clothing_details) parts.push(`${data.clothing_details}`);
            
            // Accessories
            const accessories = [];
            if (data.eyewear && data.eyewear !== 'none') accessories.push(data.eyewear);
            if (data.earrings && data.earrings !== 'none') accessories.push(data.earrings);
            if (data.necklace && data.necklace !== 'none') accessories.push(data.necklace);
            if (data.bracelet && data.bracelet !== 'none') accessories.push(data.bracelet);
            if (data.rings && data.rings !== 'none') accessories.push(data.rings);
            if (data.headwear && data.headwear !== 'none') accessories.push(data.headwear);
            if (accessories.length) parts.push(`wearing ${accessories.join(', ')}`);
            
            // Device & Props
            if (data.device_type) parts.push(`${data.device_type}`);
            if (data.device_details) parts.push(`${data.device_details}`);
            if (data.prop_type) parts.push(`${data.prop_type}`);
            
            // Optical Illusion
            if (data.illusion_type) parts.push(`${data.illusion_type}`);
            if (data.illusion_device) parts.push(`${data.illusion_device}`);
            
            // Technical
            if (data.camera_type) parts.push(`shot with ${data.camera_type}`);
            if (data.camera_angle) parts.push(`${data.camera_angle} angle`);
            if (data.camera_settings) parts.push(data.camera_settings);
            if (data.composition) parts.push(`${data.composition} composition`);
            if (data.film_type) parts.push(`${data.film_type}`);
            if (data.aspect_ratio) parts.push(`${data.aspect_ratio}`);
            
            // Advanced Photography
            if (data.camera_style) parts.push(`${data.camera_style}`);
            if (data.shot_type) parts.push(`${data.shot_type}`);
            if (data.photo_texture) parts.push(`${data.photo_texture}`);
            if (data.depth_of_field) parts.push(`${data.depth_of_field}`);
            
            // Background Advanced
            if (data.background_elements) parts.push(`${data.background_elements}`);
            if (data.background_atmosphere) parts.push(`${data.background_atmosphere} atmosphere`);
            
            // Vibe & Aesthetic
            if (data.vibe_energy) parts.push(`${data.vibe_energy} vibe`);
            if (data.vibe_aesthetic) parts.push(`${data.vibe_aesthetic}`);
            if (data.vibe_authenticity) parts.push(`${data.vibe_authenticity}`);
            if (data.vibe_intimacy) parts.push(`${data.vibe_intimacy} perspective`);
            
            // Quality
            if (data.quality_modifiers) parts.push(data.quality_modifiers);
            if (data.render_style) parts.push(data.render_style);
            if (data.additional_details) parts.push(data.additional_details);
            
            // Style modifiers (for trending presets)
            if (data.style_modifiers) parts.push(data.style_modifiers);
            
            // Custom fields
            Object.keys(customFields).forEach(section => {
                customFields[section].forEach(field => {
                    if (data[field.name]) {
                        parts.push(data[field.name]);
                    }
                });
            });
            
            // Objects in scene
            if (sceneObjects.length > 0) {
                const objDescriptions = sceneObjects.map(obj => {
                    const desc = [];
                    if (obj.color) desc.push(obj.color);
                    if (obj.material) desc.push(obj.material);
                    if (obj.label) desc.push(obj.label);
                    if (obj.location) desc.push(`in the ${obj.location.toLowerCase()}`);
                    return desc.join(' ');
                }).filter(d => d);
                if (objDescriptions.length) {
                    parts.push(`with ${objDescriptions.join(', ')}`);
                }
            }
            
            // Semantic relationships
            if (semanticRelationships.length > 0) {
                parts.push(semanticRelationships.join(', '));
            }
            
            const prompt = parts.join(', ');
            const negative = getSelectedNegativePrompts().join(', ');
            
            return `${prompt}\n\n--negative--\n${negative}`;
        }

        // ==================== UI FUNCTIONS ====================
        
        function getOptionLabel(value) {
            const t = translations[currentLang];
            return t.options && t.options[value] ? t.options[value] : value.charAt(0).toUpperCase() + value.slice(1);
        }

        function populateSelects() {
            const t = translations[currentLang];
            document.querySelectorAll('select[data-options]').forEach(select => {
                const optionKey = select.dataset.options;
                const options = promptOptions[optionKey] || [];
                const selectName = select.name;
                
                select.innerHTML = `<option value="">${t.select_placeholder}</option>`;
                options.forEach(opt => {
                    const label = getOptionLabel(opt);
                    select.innerHTML += `<option value="${opt}">${label}</option>`;
                });
                
                // Add custom input field if it doesn't exist
                const customInputId = `custom_${selectName}`;
                let customInput = document.getElementById(customInputId);
                
                if (!customInput) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'custom-input-wrapper';
                    wrapper.innerHTML = `<input type="text" id="${customInputId}" name="${selectName}_custom" class="custom-input" placeholder="${t.custom_input_placeholder}" data-i18n-placeholder="custom_input_placeholder">`;
                    select.parentNode.appendChild(wrapper);
                } else {
                    // Update placeholder for language change
                    customInput.placeholder = t.custom_input_placeholder;
                }
            });
        }

        function updateUILanguage() {
            const t = translations[currentLang];
            
            // Update all data-i18n elements
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if (t[key]) el.textContent = t[key];
            });
            
            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.dataset.i18nPlaceholder;
                if (t[key]) el.placeholder = t[key];
            });
            
            // Update lang buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === currentLang);
            });
            
            // Update HTML lang
            document.documentElement.lang = currentLang;
            
            // Re-render all multi-selects with new language labels
            document.querySelectorAll('.multi-select-wrapper').forEach(wrapper => {
                const selectName = wrapper.dataset.multiselect;
                const optionKey = wrapper.dataset.options;
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
            });
            
            // Update custom input placeholders
            document.querySelectorAll('.custom-input').forEach(input => {
                input.placeholder = t.custom_input_placeholder || 'or enter custom value...';
            });
        }

        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            updateUILanguage();
        }

        function copyToClipboard(type) {
            const text = document.getElementById(`text-${type}`).textContent;
            const t = translations[currentLang];
            const btn = document.querySelector(`#output-${type} .copy-btn`);
            
            navigator.clipboard.writeText(text).then(() => {
                btn.classList.add('copied');
                btn.querySelector('.copy-text').textContent = t.copied_btn || 'Copied!';
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.querySelector('.copy-text').textContent = t.copy_btn || 'Copy';
                }, 2000);
            });
        }

        // Global variable to track current loaded preset
        let currentPreset = null;

        // Make presets global for access
        window.presets = {
            cinematic: {
                subject_type: 'portrait',
                style: 'cinematic',
                lighting: 'dramatic',
                mood: 'epic',
                color_palette: 'high contrast',
                camera_angle: 'low angle',
                camera_settings: 'shallow depth of field',
                composition: 'rule of thirds',
                quality_modifiers: 'ultra detailed'
            },
            portrait: {
                subject_type: 'portrait',
                style: 'photorealistic',
                lighting: 'soft',
                mood: 'peaceful',
                color_palette: 'warm tones',
                camera_angle: 'eye level',
                camera_settings: 'bokeh',
                composition: 'centered',
                quality_modifiers: 'professional'
            }
        };

        function loadPreset(name) {
            const preset = presets[name];
            
            // Store current preset for credit info
            currentPreset = preset;
            
            // Set credit in hidden field
            const creditField = document.getElementById('currentPresetCredit');
            if (creditField) {
                creditField.value = preset.credit || '';
            }
            
            // Complete reset of all fields first
            resetAllFields();
            
            // Load preset values into multi-select state and form fields
            Object.keys(preset).forEach(key => {
                const value = preset[key];
                
                // Check if this is a multi-select field
                const wrapper = document.querySelector(`[data-multiselect="${key}"]`);
                if (wrapper) {
                    multiSelectState[key] = Array.isArray(value) ? value : [value];
                    return;
                }
                
                // Check if this is a regular select element
                const selectElement = document.querySelector(`select[name="${key}"]`);
                if (selectElement) {
                    // Set the value in multiSelectState for prompt generation
                    multiSelectState[key] = Array.isArray(value) ? value : [value];
                    // Also set the select element value for display
                    selectElement.value = value;
                    return;
                }
                
                // For text inputs and textareas
                const textElement = document.querySelector(`textarea[name="${key}"], input[type="text"][name="${key}"]`);
                if (textElement) {
                    textElement.value = value;
                }
            });
            
            // Re-render all multi-selects
            document.querySelectorAll('.multi-select-wrapper').forEach(wrapper => {
                const selectName = wrapper.dataset.multiselect;
                const optionKey = wrapper.dataset.options;
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
            });
            
            // Update contextual options based on loaded subject_type
            updateContextualOptions();
        }

        function randomizeAll() {
            // Helper to get random items from array
            const getRandomItems = (arr, min = 1, max = 2) => {
                if (!arr || arr.length === 0) return [];
                const count = Math.floor(Math.random() * (max - min + 1)) + min;
                const shuffled = [...arr].sort(() => Math.random() - 0.5);
                return shuffled.slice(0, Math.min(count, arr.length));
            };
            
            // Helper to get single random item
            const getRandomItem = (arr) => {
                if (!arr || arr.length === 0) return null;
                return arr[Math.floor(Math.random() * arr.length)];
            };
            
            // Complete reset of all fields first
            resetAllFields();
            
            // Randomly select subject type first (single selection)
            const subjectType = getRandomItem(promptOptions.subject_type);
            if (subjectType) {
                multiSelectState['subject_type'] = [subjectType];
            }
            
            // Main fields to randomize (1-2 selections each)
            const mainFields = ['style', 'era', 'time_of_day', 'season', 'location', 'setting', 
                               'mood', 'color_palette', 'lighting', 'camera_type', 'camera_angle',
                               'composition', 'quality_modifiers'];
            
            mainFields.forEach(field => {
                if (promptOptions[field]) {
                    multiSelectState[field] = getRandomItems(promptOptions[field], 1, 2);
                }
            });
            
            // Character fields (randomly include some)
            if (Math.random() > 0.3) {
                const characterFields = ['clothing_type', 'clothing_color', 'clothing_style', 
                                        'age_group', 'expression', 'pose'];
                characterFields.forEach(field => {
                    if (promptOptions[field] && Math.random() > 0.4) {
                        multiSelectState[field] = getRandomItems(promptOptions[field], 1, 1);
                    }
                });
            }
            
            // Hair fields (randomly include)
            if (Math.random() > 0.5) {
                ['hair_style', 'hair_color', 'hair_length'].forEach(field => {
                    if (promptOptions[field] && Math.random() > 0.4) {
                        multiSelectState[field] = getRandomItems(promptOptions[field], 1, 1);
                    }
                });
            }
            
            // Accessories (randomly include 0-2)
            const accessoryFields = ['eyewear', 'earrings', 'necklace', 'headwear'];
            const accessoryCount = Math.floor(Math.random() * 3);
            const shuffledAccessories = [...accessoryFields].sort(() => Math.random() - 0.5);
            shuffledAccessories.slice(0, accessoryCount).forEach(field => {
                if (promptOptions[field]) {
                    const options = promptOptions[field].filter(o => o !== 'none');
                    if (options.length > 0) {
                        multiSelectState[field] = [getRandomItem(options)];
                    }
                }
            });
            
            // Clear all contextual fields first, then set relevant ones
            allContextualFields.forEach(field => {
                multiSelectState[field] = [];
            });
            
            // Set contextual fields based on subject type
            if (subjectType && contextualFieldsMap[subjectType]) {
                contextualFieldsMap[subjectType].forEach(field => {
                    if (promptOptions[field]) {
                        multiSelectState[field] = getRandomItems(promptOptions[field], 1, 2);
                    }
                });
            }
            
            // Re-render all multi-selects
            document.querySelectorAll('.multi-select-wrapper').forEach(wrapper => {
                const selectName = wrapper.dataset.multiselect;
                const optionKey = wrapper.dataset.options;
                renderMultiSelectDropdown(wrapper, selectName, optionKey);
            });
            
            // Update contextual options
            updateContextualOptions();
            
            // Auto-submit to show the result
            document.getElementById('promptForm').dispatchEvent(new Event('submit'));
        }

        function clearForm() {
            document.getElementById('promptForm').reset();
            // Clear custom input fields
            document.querySelectorAll('.custom-input').forEach(input => {
                input.value = '';
            });
            // Reset negative prompts to defaults
            negativePrompts = {};
            DEFAULT_NEGATIVE_TAGS.forEach(tag => {
                negativePrompts[tag] = { selected: true, isCustom: false };
            });
            saveNegativePrompts();
            renderNegativeTags();
            // Clear all multi-selects and re-render
            Object.keys(multiSelectState).forEach(key => {
                multiSelectState[key] = [];
                const wrapper = document.querySelector(`[data-multiselect="${key}"]`);
                if (wrapper) {
                    const optionKey = wrapper.dataset.options;
                    renderMultiSelectDropdown(wrapper, key, optionKey);
                }
            });
            
            // Reset people section
            includePeople = false;
            peopleType = 'specific';
            personCount = 1;
            personsData = [{}];
            const checkbox = document.getElementById('includePeopleCheckbox');
            if (checkbox) checkbox.checked = false;
            const peopleContainer = document.getElementById('peopleOptionsContainer');
            if (peopleContainer) peopleContainer.style.display = 'none';
            const multiPersonContainer = document.getElementById('multiPersonContainer');
            if (multiPersonContainer) multiPersonContainer.innerHTML = '';
            
            // Hide contextual options
            updateContextualOptions();
        }

        // ==================== MODE SWITCH ====================
        
        let currentAppMode = 'photo'; // 'photo' or 'llm'
        
        function switchMode(mode) {
            currentAppMode = mode;
            
            document.getElementById('modePhotoBtn').classList.toggle('active', mode === 'photo');
            document.getElementById('modeLlmBtn').classList.toggle('active', mode === 'llm');
            
            document.getElementById('photoModePanel').style.display = mode === 'photo' ? 'grid' : 'none';
            document.getElementById('llmModePanel').style.display = mode === 'llm' ? 'grid' : 'none';
            
            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            if (mode === 'photo') {
                pageTitle.innerHTML = 'üì∏ <span data-i18n="page_title">Photo Prompt Generator</span>';
            } else {
                pageTitle.innerHTML = 'üöÄ <span>Project Builder for AI Agents</span>';
            }
        }

        // ==================== LLM AGENT FUNCTIONS ====================
        
        function clearLlmForm() {
            document.getElementById('llmPromptForm').reset();
            document.getElementById('llmOutputText').textContent = 'Fill out the form to generate a comprehensive project brief for your AI coding agent...';
        }
        
        function generateLlmPrompt(data) {
            const platformLabels = {
                'web_app': 'Web Application (SPA/SSR)',
                'mobile_native': 'Native Mobile App',
                'mobile_hybrid': 'Hybrid Mobile App',
                'desktop': 'Desktop Application',
                'api_backend': 'API/Backend Service',
                'browser_extension': 'Browser Extension',
                'cli_tool': 'CLI Tool',
                'full_stack': 'Full-Stack Application'
            };
            
            const revenueLabels = {
                'freemium': 'Freemium',
                'subscription': 'Subscription',
                'one_time': 'One-time Purchase',
                'usage_based': 'Usage-based',
                'marketplace': 'Marketplace',
                'advertising': 'Ad-supported',
                'enterprise': 'Enterprise Sales',
                'open_source': 'Open Source',
                'hybrid': 'Hybrid Model'
            };
            
            let prompt = '';
            
            // Project Header
            prompt += `# PROJECT BRIEF: ${data.project_name || 'Untitled Project'}\n\n`;
            
            if (data.project_tagline) {
                prompt += `> ${data.project_tagline}\n\n`;
            }
            
            // Problem & Solution
            prompt += `## üéØ Problem & Solution\n\n`;
            if (data.problem_statement) {
                prompt += `**Problem:** ${data.problem_statement}\n\n`;
            }
            if (data.proposed_solution) {
                prompt += `**Solution:** ${data.proposed_solution}\n\n`;
            }
            
            // Target Market
            if (data.target_users || data.market_size || data.competitors || data.unique_value) {
                prompt += `## üë• Target Market\n\n`;
                if (data.target_users) prompt += `- **Target Users:** ${data.target_users}\n`;
                if (data.market_size) prompt += `- **Market Size:** ${data.market_size}\n`;
                if (data.competitors) prompt += `- **Competitors:** ${data.competitors}\n`;
                if (data.unique_value) prompt += `- **Unique Value:** ${data.unique_value}\n`;
                prompt += `\n`;
            }
            
            // Technical Stack
            prompt += `## ‚öôÔ∏è Technical Stack\n\n`;
            if (data.platform_type) prompt += `- **Platform:** ${platformLabels[data.platform_type] || data.platform_type}\n`;
            if (data.frontend_framework) prompt += `- **Frontend:** ${data.frontend_framework}\n`;
            if (data.backend_framework) prompt += `- **Backend:** ${data.backend_framework}\n`;
            if (data.database) prompt += `- **Database:** ${data.database}\n`;
            if (data.additional_tech) prompt += `- **Additional Tech:** ${data.additional_tech}\n`;
            if (data.deployment) prompt += `- **Deployment:** ${data.deployment}\n`;
            prompt += `\n`;
            
            // Core Features (PRD)
            if (data.mvp_features || data.future_features) {
                prompt += `## üéØ Product Requirements (PRD)\n\n`;
                if (data.mvp_features) {
                    prompt += `### MVP Features (v1.0)\n${data.mvp_features}\n\n`;
                }
                if (data.future_features) {
                    prompt += `### Future Features (v2.0+)\n${data.future_features}\n\n`;
                }
            }
            
            // User Flow
            if (data.onboarding_flow || data.user_journey) {
                prompt += `## üîÑ User Flow\n\n`;
                if (data.onboarding_flow) {
                    prompt += `### Onboarding\n${data.onboarding_flow}\n\n`;
                }
                if (data.user_journey) {
                    prompt += `### Core Journey\n${data.user_journey}\n\n`;
                }
            }
            
            // Business Model
            if (data.revenue_model || data.pricing_tiers || data.key_metrics) {
                prompt += `## üí∞ Business Model\n\n`;
                if (data.revenue_model) prompt += `- **Revenue Model:** ${revenueLabels[data.revenue_model] || data.revenue_model}\n`;
                if (data.pricing_tiers) prompt += `- **Pricing:** ${data.pricing_tiers}\n`;
                if (data.key_metrics) prompt += `- **Key Metrics:** ${data.key_metrics}\n`;
                prompt += `\n`;
            }
            
            // Design & UX
            if (data.ui_style || data.ui_library || data.accessibility) {
                prompt += `## üé® Design Requirements\n\n`;
                if (data.ui_style) prompt += `- **UI Style:** ${data.ui_style}\n`;
                if (data.ui_library) prompt += `- **Component Library:** ${data.ui_library}\n`;
                if (data.accessibility) prompt += `- **Accessibility:** ${data.accessibility}\n`;
                prompt += `\n`;
            }
            
            // Testing & QA
            if (data.test_strategy || data.test_coverage || data.testing_tools) {
                prompt += `## üß™ Testing & QA\n\n`;
                if (data.test_strategy) prompt += `- **Strategy:** ${data.test_strategy}\n`;
                if (data.test_coverage) prompt += `- **Coverage:** ${data.test_coverage}\n`;
                if (data.testing_tools) prompt += `- **Tools:** ${data.testing_tools}\n`;
                prompt += `\n`;
            }
            
            // Security
            if (data.auth_method || data.security_measures || data.compliance) {
                prompt += `## üîí Security\n\n`;
                if (data.auth_method) prompt += `- **Authentication:** ${data.auth_method}\n`;
                if (data.security_measures) prompt += `- **Security Measures:** ${data.security_measures}\n`;
                if (data.compliance) prompt += `- **Compliance:** ${data.compliance}\n`;
                prompt += `\n`;
            }
            
            // Additional Context
            if (data.constraints || data.references || data.additional_notes) {
                prompt += `## üìù Additional Context\n\n`;
                if (data.constraints) prompt += `**Constraints:** ${data.constraints}\n\n`;
                if (data.references) prompt += `**References:** ${data.references}\n\n`;
                if (data.additional_notes) prompt += `**Notes:** ${data.additional_notes}\n\n`;
            }
            
            // Custom Fields
            const customFields = getCustomFields();
            if (customFields.length > 0) {
                prompt += `## ‚úèÔ∏è Custom Requirements\n\n`;
                customFields.forEach(field => {
                    prompt += `- **${field.label}:** ${field.value}\n`;
                });
                prompt += `\n`;
            }
            
            // Instructions for AI
            prompt += `---\n\n`;
            prompt += `## ü§ñ Instructions for AI Developer\n\n`;
            prompt += `Please help me build this project step by step:\n`;
            prompt += `1. Review the requirements above and ask clarifying questions if needed\n`;
            prompt += `2. Create a detailed technical architecture\n`;
            prompt += `3. Set up the project structure with the specified tech stack\n`;
            prompt += `4. Implement features incrementally, starting with MVP\n`;
            prompt += `5. Follow best practices for code quality, security, and performance\n`;
            
            return prompt;
        }
        
        // Format conversion functions
        function formatAsNatural(data) {
            return generateLlmPrompt(data);
        }
        
        function formatAsMarkdown(data) {
            return generateLlmPrompt(data);
        }
        
        function formatAsTOON(data) {
            let toon = `[PROJECT_BRIEF]\n`;
            toon += `name=${data.project_name || 'Untitled'}\n`;
            if (data.project_tagline) toon += `tagline=${data.project_tagline}\n`;
            if (data.problem_statement) toon += `problem=${data.problem_statement}\n`;
            if (data.proposed_solution) toon += `solution=${data.proposed_solution}\n`;
            
            toon += `\n[MARKET]\n`;
            if (data.target_users) toon += `users=${data.target_users}\n`;
            if (data.market_size) toon += `size=${data.market_size}\n`;
            if (data.competitors) toon += `competitors=${data.competitors}\n`;
            
            toon += `\n[TECH_STACK]\n`;
            if (data.platform_type) toon += `platform=${data.platform_type}\n`;
            if (data.frontend_framework) toon += `frontend=${data.frontend_framework}\n`;
            if (data.backend_framework) toon += `backend=${data.backend_framework}\n`;
            if (data.database) toon += `database=${data.database}\n`;
            
            toon += `\n[FEATURES]\n`;
            if (data.mvp_features) toon += `mvp=${data.mvp_features.replace(/\n/g, '; ')}\n`;
            if (data.future_features) toon += `future=${data.future_features.replace(/\n/g, '; ')}\n`;
            
            toon += `\n[BUSINESS]\n`;
            if (data.revenue_model) toon += `revenue=${data.revenue_model}\n`;
            if (data.pricing_tiers) toon += `pricing=${data.pricing_tiers}\n`;
            
            toon += `\n[SECURITY]\n`;
            if (data.auth_method) toon += `auth=${data.auth_method}\n`;
            if (data.security_measures) toon += `measures=${data.security_measures}\n`;
            
            return toon;
        }
        
        function formatAsTONL(data) {
            let tonl = `@project {\n`;
            tonl += `  name: "${data.project_name || 'Untitled'}"\n`;
            if (data.project_tagline) tonl += `  tagline: "${data.project_tagline}"\n`;
            if (data.problem_statement) tonl += `  problem: "${data.problem_statement}"\n`;
            if (data.proposed_solution) tonl += `  solution: "${data.proposed_solution}"\n`;
            tonl += `}\n\n`;
            
            tonl += `@market {\n`;
            if (data.target_users) tonl += `  target_users: "${data.target_users}"\n`;
            if (data.market_size) tonl += `  size: "${data.market_size}"\n`;
            if (data.competitors) tonl += `  competitors: ["${data.competitors}"]\n`;
            tonl += `}\n\n`;
            
            tonl += `@tech_stack {\n`;
            if (data.platform_type) tonl += `  platform: "${data.platform_type}"\n`;
            if (data.frontend_framework) tonl += `  frontend: "${data.frontend_framework}"\n`;
            if (data.backend_framework) tonl += `  backend: "${data.backend_framework}"\n`;
            if (data.database) tonl += `  database: "${data.database}"\n`;
            tonl += `}\n\n`;
            
            tonl += `@features {\n`;
            if (data.mvp_features) tonl += `  mvp: [\n    "${data.mvp_features.split('\n').join('",\n    "')}"\n  ]\n`;
            tonl += `}\n\n`;
            
            tonl += `@business {\n`;
            if (data.revenue_model) tonl += `  revenue_model: "${data.revenue_model}"\n`;
            if (data.pricing_tiers) tonl += `  pricing: "${data.pricing_tiers}"\n`;
            tonl += `}\n`;
            
            return tonl;
        }
        
        function formatAsJSON(data) {
            const customFields = getCustomFields();
            const projectData = {
                project: {
                    name: data.project_name || 'Untitled',
                    tagline: data.project_tagline || '',
                    problem: data.problem_statement || '',
                    solution: data.proposed_solution || ''
                },
                market: {
                    target_users: data.target_users || '',
                    market_size: data.market_size || '',
                    competitors: data.competitors || '',
                    unique_value: data.unique_value || ''
                },
                tech_stack: {
                    platform: data.platform_type || '',
                    frontend: data.frontend_framework || '',
                    backend: data.backend_framework || '',
                    database: data.database || '',
                    additional: data.additional_tech || '',
                    deployment: data.deployment || ''
                },
                features: {
                    mvp: data.mvp_features ? data.mvp_features.split('\n').filter(f => f.trim()) : [],
                    future: data.future_features ? data.future_features.split('\n').filter(f => f.trim()) : []
                },
                user_flow: {
                    onboarding: data.onboarding_flow || '',
                    core_journey: data.user_journey || ''
                },
                business: {
                    revenue_model: data.revenue_model || '',
                    pricing: data.pricing_tiers || '',
                    metrics: data.key_metrics || ''
                },
                design: {
                    ui_style: data.ui_style || '',
                    component_library: data.ui_library || '',
                    accessibility: data.accessibility || ''
                },
                testing: {
                    strategy: data.test_strategy || '',
                    coverage: data.test_coverage || '',
                    tools: data.testing_tools || ''
                },
                security: {
                    auth_method: data.auth_method || '',
                    measures: data.security_measures || '',
                    compliance: data.compliance || ''
                },
                context: {
                    constraints: data.constraints || '',
                    references: data.references || '',
                    notes: data.additional_notes || ''
                },
                custom_fields: customFields
            };
            return JSON.stringify(projectData, null, 2);
        }
        
        let currentProjectFormat = 'natural';
        
        function setProjectOutputFormat(format) {
            currentProjectFormat = format;
            document.getElementById('projectOutputFormat').value = format;
            document.querySelectorAll('#llmModePanel [data-format]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.format === format);
            });
        }
        
        // Custom Fields
        let customFieldCounter = 0;
        
        function addCustomField() {
            customFieldCounter++;
            const container = document.getElementById('customFieldsContainer');
            const fieldHtml = `
                <div class="custom-field-row flex gap-2 items-start" id="customField${customFieldCounter}">
                    <input type="text" name="custom_label_${customFieldCounter}" class="input-field flex-1" placeholder="Field label...">
                    <input type="text" name="custom_value_${customFieldCounter}" class="input-field flex-2" placeholder="Field value...">
                    <button type="button" onclick="removeCustomField(${customFieldCounter})" class="text-red-400 hover:text-red-300 p-2">‚úï</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', fieldHtml);
        }
        
        function removeCustomField(id) {
            const field = document.getElementById(`customField${id}`);
            if (field) field.remove();
        }
        
        function getCustomFields() {
            const fields = [];
            document.querySelectorAll('#customFieldsContainer .custom-field-row').forEach(row => {
                const labelInput = row.querySelector('input[name^="custom_label"]');
                const valueInput = row.querySelector('input[name^="custom_value"]');
                if (labelInput && valueInput && labelInput.value.trim() && valueInput.value.trim()) {
                    fields.push({ label: labelInput.value.trim(), value: valueInput.value.trim() });
                }
            });
            return fields;
        }
        
        // Project Presets
        function saveProjectPreset() {
            const form = document.getElementById('llmPromptForm');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                if (value && value.trim()) data[key] = value.trim();
            });
            data.custom_fields = getCustomFields();
            
            const name = prompt('Enter preset name:');
            if (!name) return;
            
            const presets = JSON.parse(localStorage.getItem('projectPresets') || '{}');
            presets[name] = data;
            localStorage.setItem('projectPresets', JSON.stringify(presets));
            showNotification('Preset saved!');
        }
        
        function loadProjectPreset() {
            const presets = JSON.parse(localStorage.getItem('projectPresets') || '{}');
            const names = Object.keys(presets);
            
            if (names.length === 0) {
                showNotification('No presets saved yet');
                return;
            }
            
            const name = prompt('Enter preset name to load:\\n\\nAvailable: ' + names.join(', '));
            if (!name || !presets[name]) {
                showNotification('Preset not found');
                return;
            }
            
            const data = presets[name];
            const form = document.getElementById('llmPromptForm');
            
            // Clear form first
            form.reset();
            document.getElementById('customFieldsContainer').innerHTML = '';
            
            // Fill form fields
            Object.keys(data).forEach(key => {
                if (key === 'custom_fields') return;
                const input = form.querySelector(`[name="${key}"]`);
                if (input) input.value = data[key];
            });
            
            // Add custom fields
            if (data.custom_fields) {
                data.custom_fields.forEach(field => {
                    addCustomField();
                    const rows = document.querySelectorAll('#customFieldsContainer .custom-field-row');
                    const lastRow = rows[rows.length - 1];
                    lastRow.querySelector('input[name^="custom_label"]').value = field.label;
                    lastRow.querySelector('input[name^="custom_value"]').value = field.value;
                });
            }
            
            showNotification('Preset loaded!');
        }
        
        function exportProjectPreset() {
            const form = document.getElementById('llmPromptForm');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                if (value && value.trim()) data[key] = value.trim();
            });
            data.custom_fields = getCustomFields();
            
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `project-preset-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function importProjectPreset() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        const form = document.getElementById('llmPromptForm');
                        
                        form.reset();
                        document.getElementById('customFieldsContainer').innerHTML = '';
                        
                        Object.keys(data).forEach(key => {
                            if (key === 'custom_fields') return;
                            const input = form.querySelector(`[name="${key}"]`);
                            if (input) input.value = data[key];
                        });
                        
                        if (data.custom_fields) {
                            data.custom_fields.forEach(field => {
                                addCustomField();
                                const rows = document.querySelectorAll('#customFieldsContainer .custom-field-row');
                                const lastRow = rows[rows.length - 1];
                                lastRow.querySelector('input[name^="custom_label"]').value = field.label;
                                lastRow.querySelector('input[name^="custom_value"]').value = field.value;
                            });
                        }
                        
                        showNotification('Preset imported!');
                    } catch (err) {
                        showNotification('Invalid preset file');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function copyLlmOutput() {
            const text = document.getElementById('llmOutputText').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('copyLlmBtn');
                btn.textContent = '‚úÖ Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'üìã Copy';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }
        
        // LLM Form submission handler
        document.addEventListener('DOMContentLoaded', () => {
            const llmForm = document.getElementById('llmPromptForm');
            if (llmForm) {
                llmForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const formData = new FormData(e.target);
                    const data = {};
                    formData.forEach((value, key) => {
                        if (value && value.trim()) {
                            data[key] = value.trim();
                        }
                    });
                    
                    // Generate output based on selected format
                    let output;
                    switch (currentProjectFormat) {
                        case 'toon':
                            output = formatAsTOON(data);
                            break;
                        case 'tonl':
                            output = formatAsTONL(data);
                            break;
                        case 'json':
                            output = formatAsJSON(data);
                            break;
                        case 'markdown':
                        case 'natural':
                        default:
                            output = generateLlmPrompt(data);
                    }
                    
                    document.getElementById('llmOutputText').textContent = output;
                    
                    // Send to backend - all prompts go to gallery
                    sendLlmToBackend({
                        ...data,
                        mode: 'llm',
                        prompt_text: output,
                        output_format: currentProjectFormat
                    });
                });
            }
        });
        
        async function sendLlmToBackend(data) {
            // All prompts go to gallery, login users can choose public/private
            const publicToggle = document.getElementById('publicPromptToggle');
            if (publicToggle) {
                data.is_public = publicToggle.checked;
            } else {
                // Not logged in = public by default
                data.is_public = true;
            }
            
            try {
                const response = await fetch('/api/prompts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    console.log('Project brief saved to gallery');
                }
            } catch (error) {
                console.log('Backend not available:', error.message);
            }
        }

        // ==================== AUTH CHECK ====================
        
        let currentUser = null;
        
        async function checkAuth() {
            try {
                const res = await fetch('/api/auth/me', { credentials: 'include' });
                const data = await res.json();
                currentUser = data.user;
                updateUserHeader();
            } catch (e) {
                console.error('Auth check failed:', e);
            }
        }
        
        function updateUserHeader() {
            const headerRight = document.querySelector('header .flex.items-center.gap-3');
            if (headerRight) {
                if (currentUser) {
                    const userHtml = `
                        <label style="display: flex; align-items: center; gap: 6px; font-size: 13px; color: var(--text-secondary); cursor: pointer; background: var(--bg-input); padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border);">
                            <input type="checkbox" id="publicPromptToggle" checked style="accent-color: var(--primary);">
                            <span>üåç Public</span>
                        </label>
                        <a href="/gallery" class="text-sm hover:underline" style="color: var(--primary);">üìÅ Gallery</a>
                        <span style="color: var(--text-secondary); font-size: 13px;">üëã ${currentUser.name}</span>
                        <button onclick="handleLogout()" style="background: transparent; border: 1px solid var(--border); border-radius: 6px; padding: 6px 12px; font-size: 12px; color: var(--text-secondary); cursor: pointer;">Logout</button>
                    `;
                    headerRight.innerHTML = userHtml;
                } else {
                    const loginHtml = `
                        <a href="/login" class="text-sm" style="background: var(--primary); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none;">üîê Sign In</a>
                    `;
                    headerRight.innerHTML = loginHtml;
                }
            }
        }
        
        async function handleLogout() {
            await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
            currentUser = null;
            updateUserHeader();
        }

        // ==================== INITIALIZATION ====================
        
        // Load prompt from gallery (Use button)
        function loadPromptFromGallery() {
            const urlParams = new URLSearchParams(window.location.search);
            if (!urlParams.has('use')) return;
            
            const promptData = sessionStorage.getItem('usePromptData');
            const promptMode = sessionStorage.getItem('usePromptMode');
            
            if (!promptData) return;
            
            try {
                const data = JSON.parse(promptData);
                
                // Switch to correct mode
                if (promptMode === 'llm') {
                    switchMode('llm');
                    // Fill LLM form
                    const llmForm = document.getElementById('llmPromptForm');
                    if (llmForm) {
                        Object.keys(data).forEach(key => {
                            const input = llmForm.querySelector(`[name="${key}"]`);
                            if (input) input.value = data[key] || '';
                        });
                    }
                } else {
                    switchMode('photo');
                    // Fill photo form fields
                    fillPhotoForm(data);
                }
                
                // Clear sessionStorage
                sessionStorage.removeItem('usePromptData');
                sessionStorage.removeItem('usePromptMode');
                
                showNotification('Prompt loaded! Edit and regenerate.');
            } catch (e) {
                console.error('Failed to load prompt:', e);
            }
        }
        
        function fillPhotoForm(data) {
            // Fill ALL form fields from data - iterate through all keys
            Object.keys(data).forEach(key => {
                // Skip internal/special fields
                if (key.startsWith('_') || key.endsWith('_format') || key === 'natural_prompt' || 
                    key === 'is_public' || key === 'metadata') return;
                
                // Skip array versions (we'll use the main field)
                if (key.endsWith('_array')) return;
                
                const value = data[key];
                if (!value || typeof value === 'object') return;
                
                // Try to find input by name
                const input = document.querySelector(`[name="${key}"]`);
                if (input) {
                    if (input.tagName === 'SELECT') {
                        // For selects, try to set the value
                        const optionExists = Array.from(input.options).some(opt => opt.value === value);
                        if (optionExists) {
                            input.value = value;
                        }
                    } else {
                        input.value = value;
                    }
                    // Trigger change event for dynamic UI updates
                    input.dispatchEvent(new Event('change', { bubbles: true }));
                }
            });
            
            // Handle multi-select arrays
            Object.keys(data).forEach(key => {
                if (key.endsWith('_array') && Array.isArray(data[key])) {
                    const baseName = key.replace('_array', '');
                    if (multiSelectState[baseName]) {
                        multiSelectState[baseName] = data[key];
                    }
                }
            });
            
            // Handle scene objects
            if (data._sceneObjects && Array.isArray(data._sceneObjects)) {
                sceneObjects = data._sceneObjects;
                renderObjects();
            }
            
            // Handle semantic relationships
            if (data._semanticRelationships_array && Array.isArray(data._semanticRelationships_array)) {
                semanticRelationships = data._semanticRelationships_array;
                renderRelationships();
            }
            
            // Re-render multi-selects
            initAllMultiSelects();
            
            // Trigger subject type change to show contextual options
            const subjectType = document.querySelector('[name="subject_type"]');
            if (subjectType && subjectType.value) {
                subjectType.dispatchEvent(new Event('change', { bubbles: true }));
            }
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            // Check auth (non-blocking)
            checkAuth();
            
            // Initialize all multi-select dropdowns (converts all selects)
            initAllMultiSelects();
            
            // Load prompt from gallery if redirected with ?use parameter
            setTimeout(loadPromptFromGallery, 100);
            
            // Initialize language
            updateUILanguage();
            
            // Initialize negative tags
            renderNegativeTags();
            
            // Initialize custom presets
            renderCustomPresets();
            
            // Initialize custom fields
            renderAllCustomFields();
            
            // Initialize objects and relationships
            renderObjects();
            renderRelationships();
            
            // Initialize multi-person panels (will render when portrait is selected)
            // Ensure personsData has at least one entry
            if (personsData.length === 0) {
                personsData = [{}];
            }
            
            // Enter key to add tag
            document.getElementById('newTagInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addCustomTag();
                }
            });
            
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.output-content').forEach(c => c.classList.add('hidden'));
                    
                    btn.classList.add('active');
                    const tab = btn.dataset.tab;
                    document.getElementById(`output-${tab}`).classList.remove('hidden');
                });
            });

            // Form submission
            document.getElementById('promptForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                // Collect data from multi-select state
                const data = {};
                
                // Get current subject type to filter contextual fields
                const currentSubjectTypes = multiSelectState['subject_type'] || [];
                const currentSubjectType = currentSubjectTypes[0] || '';
                const relevantContextFields = contextualFieldsMap[currentSubjectType] || [];
                
                // Get all multi-select values, filtering out irrelevant contextual fields
                Object.keys(multiSelectState).forEach(key => {
                    const values = multiSelectState[key];
                    if (values && values.length > 0) {
                        // Skip contextual fields that don't belong to current subject type
                        if (allContextualFields.includes(key) && !relevantContextFields.includes(key)) {
                            return; // Skip this field
                        }
                        data[key] = values.join(', ');
                        data[key + '_array'] = values; // Keep array version too
                    }
                });
                
                // Collect values from regular select elements (new advanced fields)
                document.querySelectorAll('select[data-options]').forEach(select => {
                    const key = select.name;
                    const value = select.value;
                    if (value && value.trim() && !data[key]) {
                        data[key] = value.trim();
                    }
                });
                
                // Get text inputs (subject_description, additional_details)
                const formData = new FormData(e.target);
                formData.forEach((value, key) => {
                    if (value && value.trim() && !key.endsWith('_custom')) {
                        // Only add if not already set by multi-select or it's a text field
                        if (!data[key] || document.querySelector(`textarea[name="${key}"]`) || document.querySelector(`input[type="text"][name="${key}"]`)) {
                            data[key] = value.trim();
                        }
                    }
                });
                
                // Add credit info if available
                const creditField = document.getElementById('currentPresetCredit');
                if (creditField && creditField.value && creditField.value.trim()) {
                    data.current_preset_credit = creditField.value.trim();
                }
                
                // Process custom input values - they append to multi-select values
                // Filter out custom inputs for irrelevant contextual fields
                document.querySelectorAll('.custom-input').forEach(input => {
                    if (input.value.trim()) {
                        const baseKey = input.name.replace('_custom', '');
                        const customValue = input.value.trim();
                        
                        // Skip custom inputs for contextual fields that don't belong to current subject type
                        if (allContextualFields.includes(baseKey) && !relevantContextFields.includes(baseKey)) {
                            return; // Skip this custom input
                        }
                        
                        if (!data[baseKey] || data[baseKey] === '') {
                            data[baseKey] = customValue;
                        } else {
                            data[baseKey] = data[baseKey] + ', ' + customValue;
                        }
                    }
                });
                
                // Collect custom fields values
                Object.keys(customFields).forEach(section => {
                    customFields[section].forEach(field => {
                        const element = document.querySelector(`[name="${field.name}"]`);
                        if (element && element.value && element.value.trim()) {
                            data[field.name] = element.value.trim();
                        }
                    });
                });
                
                // Add multi-person data only if people are included
                if (includePeople) {
                    if (peopleType === 'specific' && personsData.length > 0 && Object.keys(personsData[0]).length > 0) {
                        data.person_count = personCount;
                        data.persons = personsData;
                        data.person_descriptions = getPersonDescriptions();
                    }
                    // Crowd data is already collected from form inputs
                }
                
                // Add scene objects if any
                if (sceneObjects.length > 0) {
                    data._sceneObjects = sceneObjects;
                }
                
                // Add semantic relationships if any
                if (semanticRelationships.length > 0) {
                    data._semanticRelationships = semanticRelationships;
                }
                
                // Add custom fields config if any
                if (Object.keys(customFields).some(k => customFields[k].length > 0)) {
                    data._customFieldsConfig = customFields;
                }

                // Generate all formats
                const naturalPrompt = generateNaturalPrompt(data);
                const toonFormat = generateToonFormat(data);
                const tonlFormat = generateTonlFormat(data);
                const jsonFormat = generateJsonFormat(data);
                
                document.getElementById('text-natural').textContent = naturalPrompt;
                document.getElementById('text-toon').textContent = toonFormat;
                document.getElementById('text-tonl').textContent = tonlFormat;
                document.getElementById('text-json').textContent = jsonFormat;
                
                // Send to backend (if available)
                sendToBackend({
                    ...data,
                    natural_prompt: naturalPrompt,
                    toon_format: toonFormat,
                    tonl_format: tonlFormat,
                    json_format: jsonFormat
                });
                
                // Add animation
                document.querySelectorAll('.output-box').forEach(box => {
                    box.classList.add('animate-fade-in');
                    setTimeout(() => box.classList.remove('animate-fade-in'), 500);
                });
            });
        });
        
        // Backend API URL (empty for same-host deployment)
        const BACKEND_URL = '';
        
        // Spam protection - rate limiting
        const SUBMISSION_COOLDOWN = 5000; // 5 seconds between submissions
        let lastSubmissionTime = 0;
        let submissionCount = 0;
        const MAX_SUBMISSIONS_PER_MINUTE = 10;
        let submissionResetTime = Date.now();
        
        function canSubmit() {
            const now = Date.now();
            
            // Reset counter every minute
            if (now - submissionResetTime > 60000) {
                submissionCount = 0;
                submissionResetTime = now;
            }
            
            // Check rate limit
            if (submissionCount >= MAX_SUBMISSIONS_PER_MINUTE) {
                showNotification('Too many submissions. Please wait a minute.');
                return false;
            }
            
            // Check cooldown
            if (now - lastSubmissionTime < SUBMISSION_COOLDOWN) {
                const waitTime = Math.ceil((SUBMISSION_COOLDOWN - (now - lastSubmissionTime)) / 1000);
                showNotification(`Please wait ${waitTime} seconds before generating again.`);
                return false;
            }
            
            return true;
        }
        
        function recordSubmission() {
            lastSubmissionTime = Date.now();
            submissionCount++;
        }
        
        // Send prompt data to backend
        async function sendToBackend(data) {
            // Check if submission is allowed
            if (!canSubmit()) {
                return;
            }
            
            // All prompts go to gallery, logged-in users can choose public/private
            const publicToggle = document.getElementById('publicPromptToggle');
            if (publicToggle) {
                data.is_public = publicToggle.checked;
            } else {
                // Not logged in = public by default
                data.is_public = true;
            }
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/prompts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Prompt saved to gallery:', result);
                    updateBackendStatus(true);
                    recordSubmission();
                } else if (response.status === 429) {
                    console.warn('Rate limited by server');
                    showNotification('Too many requests. Please slow down.');
                } else {
                    console.warn('Backend response not ok:', response.status);
                    updateBackendStatus(false);
                }
            } catch (error) {
                console.log('Backend not available:', error.message);
                updateBackendStatus(false);
            }
        }
        
        // Update backend connection status in footer
        function updateBackendStatus(connected) {
            const statusEl = document.getElementById('backendStatus');
            if (statusEl) {
                if (connected) {
                    statusEl.innerHTML = '<span style="color: #10b981;">‚óè Connected</span>';
                } else {
                    statusEl.innerHTML = '<span style="color: #ef4444;">‚óè Not Connected</span>';
                }
            }
        }
        
        // Check backend status on load
        async function checkBackendStatus() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/stats`);
                updateBackendStatus(response.ok);
            } catch {
                updateBackendStatus(false);
            }
        }
        
        // Check backend status periodically
        checkBackendStatus();
        setInterval(checkBackendStatus, 30000);
    </script>
</body>
</html>
